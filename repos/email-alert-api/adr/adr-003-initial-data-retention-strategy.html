

<!doctype html>
<html lang="en" class="govuk-template govuk-template--rebranded no-js">
  <head>
    
    

    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>email-alert-api: Decision Record: Initial Data Retention Strategy - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/repos/email-alert-api/adr/adr-003-initial-data-retention-strategy.html">
      <link rel="icon" sizes="48x48" href="/assets/govuk/assets/rebrand/images/favicon.ico">
      <link rel="icon" sizes="any" href="/assets/govuk/assets/rebrand/images/favicon.svg" type="image/svg+xml">
      <link rel="mask-icon" href="/assets/govuk/assets/rebrand/images/govuk-icon-mask.svg" color="#0b0c0c">
      <link rel="apple-touch-icon" href="/assets/govuk/assets/rebrand/images/govuk-icon-180.png">
      <link rel="manifest" href="/assets/govuk/assets/rebrand/manifest.json">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.publishing.service.gov.uk/assets/govuk/assets/rebrand/images/govuk-opengraph-image.png" />
      <meta name="twitter:title" content="email-alert-api: Decision Record: Initial Data Retention Strategy - GOV.UK Developer Documentation" />
      <meta name="twitter:url" content="https://docs.publishing.service.gov.uk/repos/email-alert-api/adr/adr-003-initial-data-retention-strategy.html" />

      <meta property="og:image" content="https://docs.publishing.service.gov.uk/assets/govuk/assets/rebrand/images/govuk-opengraph-image.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="email-alert-api: Decision Record: Initial Data Retention Strategy" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/repos/email-alert-api/adr/adr-003-initial-data-retention-strategy.html" />

      <script>
  document.addEventListener('DOMContentLoaded', function () {
    var markup = `<div id="global-cookie-message" data-module="cookie-banner" data-nosnippet="" aria-label="Can we store analytics cookies on your device?" class="gem-c-cookie-banner govuk-clearfix govuk-cookie-banner js-banner-wrapper" role="region" hidden="hidden" title="Can we store analytics cookies on your device?"> <div class="govuk-cookie-banner__message govuk-width-container"> <div class="govuk-grid-row"> <div class="govuk-grid-column-two-thirds"> <h2 class="govuk-cookie-banner__heading govuk-heading-m">Can we store analytics cookies on your device?</h2> <div tabindex="-1" class="govuk-cookie-banner__content gem-c-cookie-banner__confirmation"> <div class="gem-c-cookie-banner__content"><p class='govuk-body'>We’d like to set some cookies to understand how you use this site and remember your settings.</p><p class='govuk-body'>We also use cookies set by other sites to help us deliver content from their services.</p></div> <p class="gem-c-cookie-banner__confirmation-message--accepted govuk-body" hidden data-ga4-cookie-banner data-module="ga4-link-tracker" data-ga4-track-links-only data-ga4-set-indexes data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;cookie banner&quot;,&quot;section&quot;:&quot;You have accepted additional cookies&quot;}" >You have accepted additional cookies. <span class="gem-c-cookie-banner__confirmation-message">You can <a class="govuk-link" href="/cookies.html">change your cookie settings</a> at any time.</span></p> <p class="gem-c-cookie-banner__confirmation-message--rejected govuk-body" hidden>You have rejected additional cookies. <span class="gem-c-cookie-banner__confirmation-message">You can <a class="govuk-link" href="/cookies.html">change your cookie settings</a> at any time.</span></p> </div> </div> </div> <div class="js-confirmation-buttons govuk-button-group"> <button class="gem-c-button govuk-button" type="submit" data-accept-cookies="true" data-cookie-types="all">Accept additional cookies</button> <button class="gem-c-button govuk-button" type="submit" data-reject-cookies="true">Reject additional cookies</button> <a class="govuk-link" href="/cookies.html">View cookies</a> </div> <div hidden class="js-hide-button govuk-button-group"> <button class="gem-c-cookie-banner__hide-button govuk-button" data-hide-cookie-banner="true" data-module="ga4-event-tracker" data-ga4-event="{&quot;event_name&quot;:&quot;select_content&quot;,&quot;type&quot;:&quot;cookie banner&quot;,&quot;action&quot;:&quot;closed&quot;,&quot;section&quot;:&quot;You have accepted additional cookies&quot;}" > Hide cookie message </button> </div> </div> </div>`;
    var banner = document.createElement('div');
    banner.innerHTML = markup;
    document.body.prepend(banner);
  })
</script>


  </head>

  <body class="govuk-template__body">
    <script>document.body.className += ' js-enabled' + ('noModule' in HTMLScriptElement.prototype ? ' govuk-frontend-supported' : '');</script>

    <div class="app-pane">
      
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <svg
          focusable="false"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 324 60"
          height="30"
          width="162"
          fill="currentcolor"
          class="govuk-header__logotype"
          aria-label="GOV.UK">
          <title>GOV.UK</title>
          <g>
            <circle cx="20" cy="17.6" r="3.7"></circle>
            <circle cx="10.2" cy="23.5" r="3.7"></circle>
            <circle cx="3.7" cy="33.2" r="3.7"></circle>
            <circle cx="31.7" cy="30.6" r="3.7"></circle>
            <circle cx="43.3" cy="17.6" r="3.7"></circle>
            <circle cx="53.2" cy="23.5" r="3.7"></circle>
            <circle cx="59.7" cy="33.2" r="3.7"></circle>
            <circle cx="31.7" cy="30.6" r="3.7"></circle>
            <path d="M33.1,9.8c.2-.1.3-.3.5-.5l4.6,2.4v-6.8l-4.6,1.5c-.1-.2-.3-.3-.5-.5l1.9-5.9h-6.7l1.9,5.9c-.2.1-.3.3-.5.5l-4.6-1.5v6.8l4.6-2.4c.1.2.3.3.5.5l-2.6,8c-.9,2.8,1.2,5.7,4.1,5.7h0c3,0,5.1-2.9,4.1-5.7l-2.6-8ZM37,37.9s-3.4,3.8-4.1,6.1c2.2,0,4.2-.5,6.4-2.8l-.7,8.5c-2-2.8-4.4-4.1-5.7-3.8.1,3.1.5,6.7,5.8,7.2,3.7.3,6.7-1.5,7-3.8.4-2.6-2-4.3-3.7-1.6-1.4-4.5,2.4-6.1,4.9-3.2-1.9-4.5-1.8-7.7,2.4-10.9,3,4,2.6,7.3-1.2,11.1,2.4-1.3,6.2,0,4,4.6-1.2-2.8-3.7-2.2-4.2.2-.3,1.7.7,3.7,3,4.2,1.9.3,4.7-.9,7-5.9-1.3,0-2.4.7-3.9,1.7l2.4-8c.6,2.3,1.4,3.7,2.2,4.5.6-1.6.5-2.8,0-5.3l5,1.8c-2.6,3.6-5.2,8.7-7.3,17.5-7.4-1.1-15.7-1.7-24.5-1.7h0c-8.8,0-17.1.6-24.5,1.7-2.1-8.9-4.7-13.9-7.3-17.5l5-1.8c-.5,2.5-.6,3.7,0,5.3.8-.8,1.6-2.3,2.2-4.5l2.4,8c-1.5-1-2.6-1.7-3.9-1.7,2.3,5,5.2,6.2,7,5.9,2.3-.4,3.3-2.4,3-4.2-.5-2.4-3-3.1-4.2-.2-2.2-4.6,1.6-6,4-4.6-3.7-3.7-4.2-7.1-1.2-11.1,4.2,3.2,4.3,6.4,2.4,10.9,2.5-2.8,6.3-1.3,4.9,3.2-1.8-2.7-4.1-1-3.7,1.6.3,2.3,3.3,4.1,7,3.8,5.4-.5,5.7-4.2,5.8-7.2-1.3-.2-3.7,1-5.7,3.8l-.7-8.5c2.2,2.3,4.2,2.7,6.4,2.8-.7-2.3-4.1-6.1-4.1-6.1h10.6,0Z"></path>
          </g>
          <circle class="govuk-logo-dot" cx="226" cy="36" r="7.3"/>
          <path d="M93.94 41.25c.4 1.81 1.2 3.21 2.21 4.62 1 1.4 2.21 2.41 3.61 3.21s3.21 1.2 5.22 1.2 3.61-.4 4.82-1c1.4-.6 2.41-1.4 3.21-2.41.8-1 1.4-2.01 1.61-3.01s.4-2.01.4-3.01v.14h-10.86v-7.02h20.07v24.08h-8.03v-5.56c-.6.8-1.38 1.61-2.19 2.41-.8.8-1.81 1.2-2.81 1.81-1 .4-2.21.8-3.41 1.2s-2.41.4-3.81.4a18.56 18.56 0 0 1-14.65-6.63c-1.6-2.01-3.01-4.41-3.81-7.02s-1.4-5.62-1.4-8.83.4-6.02 1.4-8.83a20.45 20.45 0 0 1 19.46-13.65c3.21 0 4.01.2 5.82.8 1.81.4 3.61 1.2 5.02 2.01 1.61.8 2.81 2.01 4.01 3.21s2.21 2.61 2.81 4.21l-7.63 4.41c-.4-1-1-1.81-1.61-2.61-.6-.8-1.4-1.4-2.21-2.01-.8-.6-1.81-1-2.81-1.4-1-.4-2.21-.4-3.61-.4-2.01 0-3.81.4-5.22 1.2-1.4.8-2.61 1.81-3.61 3.21s-1.61 2.81-2.21 4.62c-.4 1.81-.6 3.71-.6 5.42s.8 5.22.8 5.22Zm57.8-27.9c3.21 0 6.22.6 8.63 1.81 2.41 1.2 4.82 2.81 6.62 4.82S170.2 24.39 171 27s1.4 5.62 1.4 8.83-.4 6.02-1.4 8.83-2.41 5.02-4.01 7.02-4.01 3.61-6.62 4.82-5.42 1.81-8.63 1.81-6.22-.6-8.63-1.81-4.82-2.81-6.42-4.82-3.21-4.41-4.01-7.02-1.4-5.62-1.4-8.83.4-6.02 1.4-8.83 2.41-5.02 4.01-7.02 4.01-3.61 6.42-4.82 5.42-1.81 8.63-1.81Zm0 36.73c1.81 0 3.61-.4 5.02-1s2.61-1.81 3.61-3.01 1.81-2.81 2.21-4.41c.4-1.81.8-3.61.8-5.62 0-2.21-.2-4.21-.8-6.02s-1.2-3.21-2.21-4.62c-1-1.2-2.21-2.21-3.61-3.01s-3.21-1-5.02-1-3.61.4-5.02 1c-1.4.8-2.61 1.81-3.61 3.01s-1.81 2.81-2.21 4.62c-.4 1.81-.8 3.61-.8 5.62 0 2.41.2 4.21.8 6.02.4 1.81 1.2 3.21 2.21 4.41s2.21 2.21 3.61 3.01c1.4.8 3.21 1 5.02 1Zm36.32 7.96-12.24-44.15h9.83l8.43 32.77h.4l8.23-32.77h9.83L200.3 58.04h-12.24Zm74.14-7.96c2.18 0 3.51-.6 3.51-.6 1.2-.6 2.01-1 2.81-1.81s1.4-1.81 1.81-2.81a13 13 0 0 0 .8-4.01V13.9h8.63v28.15c0 2.41-.4 4.62-1.4 6.62-.8 2.01-2.21 3.61-3.61 5.02s-3.41 2.41-5.62 3.21-4.62 1.2-7.02 1.2-5.02-.4-7.02-1.2c-2.21-.8-4.01-1.81-5.62-3.21s-2.81-3.01-3.61-5.02-1.4-4.21-1.4-6.62V13.9h8.63v26.95c0 1.61.2 3.01.8 4.01.4 1.2 1.2 2.21 2.01 2.81.8.8 1.81 1.4 2.81 1.81 0 0 1.34.6 3.51.6Zm34.22-36.18v18.92l15.65-18.92h10.82l-15.03 17.32 16.03 26.83h-10.21l-11.44-20.21-5.62 6.22v13.99h-8.83V13.9"/>
        </svg>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" hidden>Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/kubernetes/">Kubernetes</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/apps.html" aria-current="page">Apps</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/repos.html">Repos</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/mobile/">Mobile</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1">
              <div class="search" data-module="search" data-path-to-site-root="/">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input
      type="search"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <ul>
    <li>
      <a href="/repos/email-alert-api.html" rel="noopener" class="govuk-link">email-alert-api</a>
    </li>
    <li>
      <ul>
            <li><a href="/repos/email-alert-api/alert_check_scheduled_jobs.html" rel="noopener" class="govuk-link">Alert Check Scheduled Jobs</a></li>
    <li><a href="/repos/email-alert-api/analytics.html" rel="noopener" class="govuk-link">Analytics</a></li>
    <li><a href="/repos/email-alert-api/api.html" rel="noopener" class="govuk-link">Available endpoints</a></li>
    <li><a href="/repos/email-alert-api/bulk-email.html" rel="noopener" class="govuk-link">Send a bulk email</a></li>
    <li><a href="/repos/email-alert-api/data-cleanup-mechanisms.html" rel="noopener" class="govuk-link">Data cleanup mechanisms</a></li>
    <li><a href="/repos/email-alert-api/env-vars.html" rel="noopener" class="govuk-link">ENV vars</a></li>
    <li><a href="/repos/email-alert-api/load-test-email-alert-api.html" rel="noopener" class="govuk-link">Load test Email Alert API</a></li>
    <li><a href="/repos/email-alert-api/matching-content-to-subscriber-lists.html" rel="noopener" class="govuk-link">Matching content to subscriber lists</a></li>
    <li><a href="/repos/email-alert-api/receiving-emails-from-email-alert-api-in-integration-and-staging.html" rel="noopener" class="govuk-link">Receive emails from Email Alert API in Integration and Staging</a></li>
    <li><a href="/repos/email-alert-api/sidekiq-web.html" rel="noopener" class="govuk-link"># Viewing the Sidekiq UI for Email Alert API</a></li>
    <li><a href="/repos/email-alert-api/subscriber-list-audit.html" rel="noopener" class="govuk-link">Subscriber List Audit</a></li>
    <li><a href="/repos/email-alert-api/support-tasks.html" rel="noopener" class="govuk-link">Support tasks</a></li>
    <li class="subdir__heading">adr</li>
    <ul class="subdir__menu">
          <li><a href="/repos/email-alert-api/adr/adr-001-notify-integration.html" rel="noopener" class="govuk-link">Decision Record: Initial architecture for Notify integration</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-002-digest-mvp.html" rel="noopener" class="govuk-link">Decision Record: MVP implementation of Digests</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-003-initial-data-retention-strategy.html" rel="noopener" class="govuk-link">Decision Record: Initial Data Retention Strategy</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-004-message-concept.html" rel="noopener" class="govuk-link">Decision Record: Message Concept</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-005-record-architecture-decisions.html" rel="noopener" class="govuk-link">5. Record architecture decisions</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-006-email-delivery-responsibilities.html" rel="noopener" class="govuk-link">6. Email Delivery Responsibilities</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-007-retain-data-for-up-to-one-year.html" rel="noopener" class="govuk-link">7. Retain data for up to one year</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-008-monitoring-and-alerting.html" rel="noopener" class="govuk-link">8. Monitoring and alerting</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-009-sidekiq-lost-job-recovery.html" rel="noopener" class="govuk-link">9. Sidekiq Lost Job Recovery</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-010-send-unpublish-emails-for-single-pages.html" rel="noopener" class="govuk-link">Decision record: reinstate unpublish emails for single page subscriptions</a></li>

    </ul>

      </ul>
    </li>
  </ul>

              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled" aria-label="Content">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              
<script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "name": "Home",
        "@id": "http://www.dev.gov.uk/"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "name": "Apps",
        "@id": "http://www.dev.gov.uk/apps.html"
      }
    },
    {
      "@type": "ListItem",
      "position": 3,
      "item": {
        "name": "email-alert-api",
        "@id": "http://www.dev.gov.uk/repos/email-alert-api.html"
      }
    }
  ]
}
</script>

<nav data-module="ga4-link-tracker" aria-label="Breadcrumb" class="gem-c-breadcrumbs govuk-breadcrumbs">
  <ol class="govuk-breadcrumbs__list">
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;1&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/">Home</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;2&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/apps.html">Apps</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;3&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/repos/email-alert-api.html">email-alert-api</a>
        </li>
  </ol>
</nav>
  <div class="govuk-!-font-size-16 govuk-!-margin-top-6">
    <div class="govuk-warning-text">
      <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
      <strong class="govuk-warning-text__text">
        <span class="govuk-warning-text__assistive">Warning</span>
        This document has not been updated for a while now. It may be out of date.
      </strong>
    </div>

  Last updated: <a href="https://github.com/alphagov/email-alert-api/commit/dbc714dbd14b11ac82aee193cc0d0ab277aaddab">19 Nov 2020</a>
</div>

  <h1 class="page-title">email-alert-api: Decision Record: Initial Data Retention Strategy</h1>

  
<blockquote>
<p><strong>Note</strong>
The data retention strategy was revisited in <a href="https://github.com/alphagov/email-alert-api/blob/master/docs/adr/adr-007-retain-data-for-up-to-one-year.md">ADR-7</a> which supersedes this decision.</p>
</blockquote>
<h2 id="introduction">Introduction</h2>
<p>In February 2018, prior to switching from Govdelivery to Notify we wished to
consider our approach to data retention in such a way to enable data driven
decisions in the future.</p>
<p>The aim in this work is to make suggestions that enable a comparable amount of
data to what is currently used by Govdelivery and for that data to be
flexible. This is balanced against the constraint that Email Alert API does
produce a lot of data and this should be culled regularly to not use too much
disk space without justification. It also intends to do this with respect to
the constraints of GDPR by not storing personally identifiable data for
longer than is needed.</p>
<p>The goal being that we can complete this prior to the change to Notify so that
we avoid a data black hole where we do not have the data to answer common
data queries.</p>
<h2 id="specifics">Specifics</h2>
<h3 id="common-data-use-scenarios">Common data use scenarios</h3>
<p>Based on a chat with Paul (our performance analyst) we were demonstrated to a
number of scenarios of data look ups and usage. As this was only a short session
this list is likely incomplete.</p>
<h4 id="data-that-is-currently-looked-up">Data that is currently looked up</h4>
<ul>
<li>Number of people subscribed to list
<ul>
<li>Given a date range: how many people subscribed in that range; how many
unscribed; total number of subscribers during that time period.</li>
</ul>
</li>
<li>Activity Level of list
<ul>
<li>Given a date range: how many emails were sent out to that list; how many
bulletins a list has associated with it; how many emails a list has
genertaed; whether lists have never produced an email.</li>
</ul>
</li>
<li>Overall totals
<ul>
<li>Counts of how many emails we have sent over a specific period of time or
total (mostly used internally)</li>
</ul>
</li>
</ul>
<h4 id="support-queries">Support queries</h4>
<ul>
<li>People have been unsubscribed and don’t know why (Govdelivery tracks a user
unsubscribed but not which lists)</li>
<li>Why a user was unsubscribed - this can happen automatically or a user
performs the action.</li>
<li>Occasional need to check email. Reason this can happen is that we get a query
because the link may not be working, so we would look at what was sent.</li>
</ul>
<h4 id="things-that-would-be-useful">Things that would be useful</h4>
<ul>
<li>Knowing difference between users who subscribed by themselves or were
imported (our initial data import will leave us with inconsistent stats)</li>
<li>Ability to recreate subscriptions when people have unsubscribed.</li>
</ul>
<h3 id="suggested-changes">Suggested Changes</h3>
<p>This is a summary of a collection of changes to the data architecture to enable
most statistical data to be retained at a relatively low level of pain of
implementation and should enable future decisions to be made about usage and
storage with a relatively full set of data.</p>
<h4 id="email-and-deliveryattempt">Email and DeliveryAttempt</h4>
<p>The largest source of data is the Email table which has a relationship with
DeliveryAttempt. This is the most pressing problem to resolve in terms of
data retention as this quickly builds up a substantial quantity of data.</p>
<p>The suggested approach to dealing with this is to have two separate
processes which can both be adjusted as we learn more about the system.</p>
<p>The first of these processes is an archiving one which should happen within
24 hours of an email reaching a final state (either sent or failed). When this
has occurred the row should be marked that as archived (suggestion is for a
<code>archived_at</code> timestamp) so it not as archived again and is known to be safe
to delete later.</p>
<p>The archiving would not involve any personally identifiable data and would
only include the subject field from the email. As an example:</p>
<pre><code>{
  "id": "5c59b695-dbaa-4291-9e25-5024dcbfb45d",
  "subject": "Test email",
  "subscriber_id": 43, // or null
  "content_change": { // or null
    subscription_ids: [45], // array of subscriptions this email is associated with
    content_change_ids: [32], // array of content_changes this email is associated with
    digest_id: 10 // or null
  },
  created_at: date,
  completed_at: date,
  final_status: "sent",
  // maybe include delivery attempt information
}
</code></pre>
<p>Ideally this data would be stored in S3, but as an interim the suggestion is to
store this in an <code>email_archives</code> database table which can then be exported to
S3 when we have the time/resources available to configure that association.</p>
<p>The second process would be the deletion of the emails (which would also remove
the related delivery attempts). This would be removed after a period of 14 days
after the email process completed. This period is determined thus to allow
sufficient time for a support ticket to come in and a small investigation to
occur.</p>
<p>Since the deletion process is decoupled from the archive one the time can
be adjusted based on data needs.</p>
<p>An additional change to these tables will be to replace their ids with uuid
datatypes. This will allow us to remove the reference field of
<code>delivery_attempt</code> - which seems to be created as a psuedo uuid value
combining a database id and a timestamp. The reason for changing email to be a
uuid is to have this as a value that is globally unique and can be used as a
further reference without revealing system information.</p>
<h4 id="subscriptioncontent">SubscriptionContent</h4>
<p>SubscriptionContent is currently the glue that holds together the association
between a ContentChange, a Subscription, a resulting Email and a
DigestRunSubscriber. Currently when an email is deleted there is a cascade
to set the value to SubscriptionContent to null. This is incorrect as the value
of null here indicates an email is scheduled to be generated. Instead this
foreign key should be set to have an on delete cascade association with Email
so that when an email is removed from the system the proceeding
SubscriptionContent values are also deleted.</p>
<p>This will mean that over time the data in the SubscriptionContent will be
culled routinely as part of the Email deletion process.</p>
<h4 id="digestrun-and-digestrunsubscriber">DigestRun and DigestRunSubscriber</h4>
<p>Currently we store each DigestRun and an association to each subscriber. If we
want to know how many subscribers were due to be emailed about a digest we can
count the number of DigestRunSubscibers associated.</p>
<p>As the number of subscribers related with a digest is something that is known
at the point of digest creation we can store this as a count on
DigestRun. This can alleviate the need for storing each DigestRunSubscriber
(which can be removed at approximately the same interval as Emails).</p>
<p>As DigestRuns are low on data usage they can effectively be stored indefinitely
or at least until we determine an approach to archiving them.</p>
<h4 id="contentchange-and-subscriptionlist">ContentChange and SubscriptionList</h4>
<p>Both ContentChange and SubscriptionList should not require changes to them in
order to allow us to build up a full analytics picture. However they would
require an intention not to delete either of them.</p>
<p>Despite this a small change is suggested for ContentChange to switch the
primary key type from being an auto-incrementing number to a uuid. This is to
allow this to be sent out as part of analytics tracking without revealing state
or ordering information of the underlying system.</p>
<p>As a SubscriberList can be updated the only way we can determine the historical
number of ContentChanges with accuracy is to have the ContentChanges
available (to perform the look up between them).</p>
<p>It is likely that over time ContentChanges may reach an infeasible number and
it will then need to be looked at as to what value storing them maintains, but
hopefully by that point (expected to be a couple of years away) we'll have a
much firmer understanding of the analytics usage and needs.</p>
<p>SubscriptionLists don't currently have the ability to be deleted by apps, and
it's likely if they gained that ability that would need to be some form of
archiving so it could still be communicated to users that the list they had a
subscription to is no longer available.</p>
<h4 id="subscriber-and-subscription">Subscriber and Subscription</h4>
<p>Previously when a subscription ended they would be deleted and when the last
subscription was removed the subscriber would have an address nullified. This
was later iterated to using a temporary soft delete on subscriptions to not
remove them while we worked out whether they have a long term value.</p>
<p>By looking at the use cases and support queries we've been able to determine
that is useful to store both sets of data indefinitely and that it would be
useful for support queries to not remove the email address until after a
reasonable support window for diagnostic purposes.</p>
<p>A field would be added to subscriber of <code>deactivated_at</code> which would be used to
determine whether a subscriber is activated. Once a Subscriber has been
deactivated for 28 days any personal information will be removed from the
account. Any additional activity on the account will cause the account to be
reactivated.</p>
<p><em>Aside: The <code>deactivated_at</code> field may not be required it could be determined
by the lack of any active subscriptions. It just might be useful to have this
as queries regarding end of a subscriber would be complex without it.</em></p>
<p>This 28 day window is intended to provide us with sufficient time that we can
deal with any support queries that occur due to account issues (as this is a
reasonably regular occurance).</p>
<p>With subscriptions the intention is to use this as an append only table and
any change to a subscription (starting, ending, change of frequency) creates
a new entry into this table. There will however be an active flag which can be
used as part of the unique index on this to ensure a user can only have one
active subscription at a time. This exception would not make it fully append
anly.</p>
<p>An additional change will be to rename the <code>deleted_at</code> field to <code>ended_at</code>, as
it is used to record the time that the subscription ended at. The purpose of
this field is to enable queries which determine the number of subscriptions at
particular time periods. Additionally the suggestion is to include fields of
the source of creating the subscription and to include the reason the
subscription was ended.</p>
<p>Finally we have a uuid field stored on subscription, it would likely be better
for us to have a primary key that is the uuid and then not have a second
numerical id.</p>
<h3 id="summary-of-database-changes">Summary of database changes</h3>
<h4 id="email">Email</h4>
<ul>
<li>Change the id type from a serial to a uuid</li>
<li>Add an archived_at timestamp</li>
<li>Would be removed from database after 14 days</li>
</ul>
<h4 id="emailarchive">EmailArchive</h4>
<ul>
<li>A table which is store abridged Email data with the intention of this moving
to S3 (or a different data analytics storage)
<ul>
<li>On this store information such as id, subject, subscriber_id,
content_changes (see example above)</li>
<li>Store no personally identifiable information</li>
</ul>
</li>
</ul>
<h4 id="deliveryattempt">DeliveryAttempt</h4>
<ul>
<li>Change id to a uuid</li>
<li>Drop reference field and use uuid instead</li>
<li>Would be removed (as part of a cascade with Email) after 14 days</li>
</ul>
<h4 id="subscribtioncontent">SubscribtionContent</h4>
<ul>
<li>Would be deleted automatically when the corresponding Email is deleted</li>
</ul>
<h4 id="contentchange">ContentChange</h4>
<ul>
<li>Primary key should change to a uuid</li>
<li>Should not be deleted, as part of analytics picture</li>
</ul>
<h4 id="subscriberlist">SubscriberList</h4>
<ul>
<li>Should not be deleted, as part of analytics picture</li>
</ul>
<h4 id="subscriber">Subscriber</h4>
<ul>
<li>Add a <code>deactivated_at</code> timestamp field</li>
<li>Should not be deleted, as part of analytics picture</li>
</ul>
<h4 id="subscription">Subscription</h4>
<ul>
<li>Change primary key to be a uuid</li>
<li>Drop existing <code>uuid</code> field</li>
<li>Replace the <code>deleted_at</code> field with an <code>ended_at</code> field.</li>
<li>Create an enum field for source (ideas are imported, user_signup,
frequency_change)</li>
<li>Create an enum field for end (ideas are user_unsubscribe, non_existent_email,
frequency_change)</li>
<li>Create an active boolean field</li>
<li>Drop the current unique key and replace it with one that incorporates active</li>
<li>Relationship to Subscriber has an ON_DELETE of restrict to try ensure these
can't be lost in the system</li>
<li>Should not be deleted, as part of analytics picture</li>
</ul>
<h3 id="plans-for-future">Plans for future</h3>
<p>The intention is that this strategy provides us with sufficient data stored
that we have a lot of flexibility going forward as we determine the analytics
need of Email Alert API.</p>
<p>The most pressing concern following implementation of this would be moving
the EmailArchive data out of the databse as that would still build up
relatively fast as a significant quantity of data (but still much lower than
Email produces)</p>
<p>Following this the simplest way likely to query this data would be with <a href="https://aws.amazon.com/athena/">Amazon
Athena</a> (assuming it's in S3). So our queries for data could either be
to our db or a combination of data from our db and Athena.</p>
<p>It is likely that as the database grows though that some queries will become
slow so this strategy will require iteration once we're closer to producing
analytics and the usage of a tool such as <a href="https://aws.amazon.com/redshift/">Amazon Red Shift</a> may be
more approriate.</p>

  <script>
    /*
      Manually trigger the styling of the 'current page' in the sidebar,
      as it does not happen automatically because we are still technically
      in single page mode.
    */
    (function () {
        'use strict'
        /*
          Cannot use `$(document).ready` on next line as jQuery has not loaded
          yet. But we can use jQuery in the callback.
        */
        window.addEventListener('load', function () {
            try {
                new GOVUK.Modules.InPageNavigation().start($("html"));
            }
            catch (error) {
                /* Fail without causing other JS in the page to break */
                console.log("Error calling GOVUK's InPageNavigation module", error);
            }
        })
    }());
</script>


            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/email-alert-api/blob/main/docs/adr/adr-003-initial-data-retention-strategy.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?body=Problem+with+%27%27+%28https%3A%2F%2Fdocs.publishing.service.gov.uk%2Frepos%2Femail-alert-api%2Fadr%2Fadr-003-initial-data-retention-strategy.html%29&amp;labels=bug&amp;title=Re%3A+%27%27">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <svg focusable="false" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 60" height="30" width="32" fill="currentcolor" class="govuk-footer__crown">
    <g>
      <circle cx="20" cy="17.6" r="3.7"></circle>
      <circle cx="10.2" cy="23.5" r="3.7"></circle>
      <circle cx="3.7" cy="33.2" r="3.7"></circle>
      <circle cx="31.7" cy="30.6" r="3.7"></circle>
      <circle cx="43.3" cy="17.6" r="3.7"></circle>
      <circle cx="53.2" cy="23.5" r="3.7"></circle>
      <circle cx="59.7" cy="33.2" r="3.7"></circle>
      <circle cx="31.7" cy="30.6" r="3.7"></circle>
      <path d="M33.1,9.8c.2-.1.3-.3.5-.5l4.6,2.4v-6.8l-4.6,1.5c-.1-.2-.3-.3-.5-.5l1.9-5.9h-6.7l1.9,5.9c-.2.1-.3.3-.5.5l-4.6-1.5v6.8l4.6-2.4c.1.2.3.3.5.5l-2.6,8c-.9,2.8,1.2,5.7,4.1,5.7h0c3,0,5.1-2.9,4.1-5.7l-2.6-8ZM37,37.9s-3.4,3.8-4.1,6.1c2.2,0,4.2-.5,6.4-2.8l-.7,8.5c-2-2.8-4.4-4.1-5.7-3.8.1,3.1.5,6.7,5.8,7.2,3.7.3,6.7-1.5,7-3.8.4-2.6-2-4.3-3.7-1.6-1.4-4.5,2.4-6.1,4.9-3.2-1.9-4.5-1.8-7.7,2.4-10.9,3,4,2.6,7.3-1.2,11.1,2.4-1.3,6.2,0,4,4.6-1.2-2.8-3.7-2.2-4.2.2-.3,1.7.7,3.7,3,4.2,1.9.3,4.7-.9,7-5.9-1.3,0-2.4.7-3.9,1.7l2.4-8c.6,2.3,1.4,3.7,2.2,4.5.6-1.6.5-2.8,0-5.3l5,1.8c-2.6,3.6-5.2,8.7-7.3,17.5-7.4-1.1-15.7-1.7-24.5-1.7h0c-8.8,0-17.1.6-24.5,1.7-2.1-8.9-4.7-13.9-7.3-17.5l5-1.8c-.5,2.5-.6,3.7,0,5.3.8-.8,1.6-2.3,2.2-4.5l2.4,8c-1.5-1-2.6-1.7-3.9-1.7,2.3,5,5.2,6.2,7,5.9,2.3-.4,3.3-2.4,3-4.2-.5-2.4-3-3.1-4.2-.2-2.2-4.6,1.6-6,4-4.6-3.7-3.7-4.2-7.1-1.2-11.1,4.2,3.2,4.3,6.4,2.4,10.9,2.5-2.8,6.3-1.3,4.9,3.2-1.8-2.7-4.1-1-3.7,1.6.3,2.3,3.3,4.1,7,3.8,5.4-.5,5.7-4.2,5.8-7.2-1.3-.2-3.7,1-5.7,3.8l-.7-8.5c2.2,2.3,4.2,2.7,6.4,2.8-.7-2.3-4.1-6.1-4.1-6.1h10.6,0Z"></path>
    </g>
  </svg>
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Accessibility</a>
            </li>
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/cookies.html">Cookies</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/govuk_frontend.js" type="module"></script>
    <script src="/javascripts/application.js"></script>
  </body>
</html>
