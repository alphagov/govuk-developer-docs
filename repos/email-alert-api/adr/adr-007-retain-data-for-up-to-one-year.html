

<!doctype html>
<html lang="en" class="govuk-template govuk-template--rebranded no-js">
  <head>
    

    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>email-alert-api: 7. Retain data for up to one year - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/repos/email-alert-api/adr/adr-007-retain-data-for-up-to-one-year.html">
      <link rel="icon" sizes="48x48" href="/assets/govuk/assets/rebrand/images/favicon.ico">
      <link rel="icon" sizes="any" href="/assets/govuk/assets/rebrand/images/favicon.svg" type="image/svg+xml">
      <link rel="mask-icon" href="/assets/govuk/assets/rebrand/images/govuk-icon-mask.svg" color="#0b0c0c">
      <link rel="apple-touch-icon" href="/assets/govuk/assets/rebrand/images/govuk-icon-180.png">
      <link rel="manifest" href="/assets/govuk/assets/rebrand/manifest.json">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.publishing.service.gov.uk/assets/govuk/assets/rebrand/images/govuk-opengraph-image.png" />
      <meta name="twitter:title" content="email-alert-api: 7. Retain data for up to one year - GOV.UK Developer Documentation" />
      <meta name="twitter:url" content="https://docs.publishing.service.gov.uk/repos/email-alert-api/adr/adr-007-retain-data-for-up-to-one-year.html" />

      <meta property="og:image" content="https://docs.publishing.service.gov.uk/assets/govuk/assets/rebrand/images/govuk-opengraph-image.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="email-alert-api: 7. Retain data for up to one year" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/repos/email-alert-api/adr/adr-007-retain-data-for-up-to-one-year.html" />

      <script>
  document.addEventListener('DOMContentLoaded', function () {
    var markup = `<div id="global-cookie-message" data-module="cookie-banner" data-nosnippet="" aria-label="Can we store analytics cookies on your device?" class="gem-c-cookie-banner govuk-clearfix govuk-cookie-banner js-banner-wrapper" role="region" hidden="hidden" title="Can we store analytics cookies on your device?"> <div class="govuk-cookie-banner__message govuk-width-container"> <div class="govuk-grid-row"> <div class="govuk-grid-column-two-thirds"> <h2 class="govuk-cookie-banner__heading govuk-heading-m">Can we store analytics cookies on your device?</h2> <div tabindex="-1" class="govuk-cookie-banner__content gem-c-cookie-banner__confirmation"> <div class="gem-c-cookie-banner__content"><p class='govuk-body'>Weâ€™d like to set some cookies to understand how you use this site and remember your settings.</p><p class='govuk-body'>We also use cookies set by other sites to help us deliver content from their services.</p></div> <p class="gem-c-cookie-banner__confirmation-message--accepted govuk-body" hidden data-ga4-cookie-banner data-module="ga4-link-tracker" data-ga4-track-links-only data-ga4-set-indexes data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;cookie banner&quot;,&quot;section&quot;:&quot;You have accepted additional cookies&quot;}" >You have accepted additional cookies. <span class="gem-c-cookie-banner__confirmation-message">You can <a class="govuk-link" href="/cookies.html">change your cookie settings</a> at any time.</span></p> <p class="gem-c-cookie-banner__confirmation-message--rejected govuk-body" hidden>You have rejected additional cookies. <span class="gem-c-cookie-banner__confirmation-message">You can <a class="govuk-link" href="/cookies.html">change your cookie settings</a> at any time.</span></p> </div> </div> </div> <div class="js-confirmation-buttons govuk-button-group"> <button class="gem-c-button govuk-button" type="submit" data-accept-cookies="true" data-cookie-types="all">Accept additional cookies</button> <button class="gem-c-button govuk-button" type="submit" data-reject-cookies="true">Reject additional cookies</button> <a class="govuk-link" href="/cookies.html">View cookies</a> </div> <div hidden class="js-hide-button govuk-button-group"> <button class="gem-c-cookie-banner__hide-button govuk-button" data-hide-cookie-banner="true" data-module="ga4-event-tracker" data-ga4-event="{&quot;event_name&quot;:&quot;select_content&quot;,&quot;type&quot;:&quot;cookie banner&quot;,&quot;action&quot;:&quot;closed&quot;,&quot;section&quot;:&quot;You have accepted additional cookies&quot;}" > Hide cookie message </button> </div> </div> </div>`;
    var banner = document.createElement('div');
    banner.innerHTML = markup;
    document.body.prepend(banner);
  })
</script>


  </head>

  <body class="govuk-template__body">
    <script>document.body.className += ' js-enabled' + ('noModule' in HTMLScriptElement.prototype ? ' govuk-frontend-supported' : '');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <svg
          focusable="false"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 324 60"
          height="30"
          width="162"
          fill="currentcolor"
          class="govuk-header__logotype"
          aria-label="GOV.UK">
          <title>GOV.UK</title>
          <g>
            <circle cx="20" cy="17.6" r="3.7"></circle>
            <circle cx="10.2" cy="23.5" r="3.7"></circle>
            <circle cx="3.7" cy="33.2" r="3.7"></circle>
            <circle cx="31.7" cy="30.6" r="3.7"></circle>
            <circle cx="43.3" cy="17.6" r="3.7"></circle>
            <circle cx="53.2" cy="23.5" r="3.7"></circle>
            <circle cx="59.7" cy="33.2" r="3.7"></circle>
            <circle cx="31.7" cy="30.6" r="3.7"></circle>
            <path d="M33.1,9.8c.2-.1.3-.3.5-.5l4.6,2.4v-6.8l-4.6,1.5c-.1-.2-.3-.3-.5-.5l1.9-5.9h-6.7l1.9,5.9c-.2.1-.3.3-.5.5l-4.6-1.5v6.8l4.6-2.4c.1.2.3.3.5.5l-2.6,8c-.9,2.8,1.2,5.7,4.1,5.7h0c3,0,5.1-2.9,4.1-5.7l-2.6-8ZM37,37.9s-3.4,3.8-4.1,6.1c2.2,0,4.2-.5,6.4-2.8l-.7,8.5c-2-2.8-4.4-4.1-5.7-3.8.1,3.1.5,6.7,5.8,7.2,3.7.3,6.7-1.5,7-3.8.4-2.6-2-4.3-3.7-1.6-1.4-4.5,2.4-6.1,4.9-3.2-1.9-4.5-1.8-7.7,2.4-10.9,3,4,2.6,7.3-1.2,11.1,2.4-1.3,6.2,0,4,4.6-1.2-2.8-3.7-2.2-4.2.2-.3,1.7.7,3.7,3,4.2,1.9.3,4.7-.9,7-5.9-1.3,0-2.4.7-3.9,1.7l2.4-8c.6,2.3,1.4,3.7,2.2,4.5.6-1.6.5-2.8,0-5.3l5,1.8c-2.6,3.6-5.2,8.7-7.3,17.5-7.4-1.1-15.7-1.7-24.5-1.7h0c-8.8,0-17.1.6-24.5,1.7-2.1-8.9-4.7-13.9-7.3-17.5l5-1.8c-.5,2.5-.6,3.7,0,5.3.8-.8,1.6-2.3,2.2-4.5l2.4,8c-1.5-1-2.6-1.7-3.9-1.7,2.3,5,5.2,6.2,7,5.9,2.3-.4,3.3-2.4,3-4.2-.5-2.4-3-3.1-4.2-.2-2.2-4.6,1.6-6,4-4.6-3.7-3.7-4.2-7.1-1.2-11.1,4.2,3.2,4.3,6.4,2.4,10.9,2.5-2.8,6.3-1.3,4.9,3.2-1.8-2.7-4.1-1-3.7,1.6.3,2.3,3.3,4.1,7,3.8,5.4-.5,5.7-4.2,5.8-7.2-1.3-.2-3.7,1-5.7,3.8l-.7-8.5c2.2,2.3,4.2,2.7,6.4,2.8-.7-2.3-4.1-6.1-4.1-6.1h10.6,0Z"></path>
          </g>
          <circle class="govuk-logo-dot" cx="226" cy="36" r="7.3"/>
          <path d="M93.94 41.25c.4 1.81 1.2 3.21 2.21 4.62 1 1.4 2.21 2.41 3.61 3.21s3.21 1.2 5.22 1.2 3.61-.4 4.82-1c1.4-.6 2.41-1.4 3.21-2.41.8-1 1.4-2.01 1.61-3.01s.4-2.01.4-3.01v.14h-10.86v-7.02h20.07v24.08h-8.03v-5.56c-.6.8-1.38 1.61-2.19 2.41-.8.8-1.81 1.2-2.81 1.81-1 .4-2.21.8-3.41 1.2s-2.41.4-3.81.4a18.56 18.56 0 0 1-14.65-6.63c-1.6-2.01-3.01-4.41-3.81-7.02s-1.4-5.62-1.4-8.83.4-6.02 1.4-8.83a20.45 20.45 0 0 1 19.46-13.65c3.21 0 4.01.2 5.82.8 1.81.4 3.61 1.2 5.02 2.01 1.61.8 2.81 2.01 4.01 3.21s2.21 2.61 2.81 4.21l-7.63 4.41c-.4-1-1-1.81-1.61-2.61-.6-.8-1.4-1.4-2.21-2.01-.8-.6-1.81-1-2.81-1.4-1-.4-2.21-.4-3.61-.4-2.01 0-3.81.4-5.22 1.2-1.4.8-2.61 1.81-3.61 3.21s-1.61 2.81-2.21 4.62c-.4 1.81-.6 3.71-.6 5.42s.8 5.22.8 5.22Zm57.8-27.9c3.21 0 6.22.6 8.63 1.81 2.41 1.2 4.82 2.81 6.62 4.82S170.2 24.39 171 27s1.4 5.62 1.4 8.83-.4 6.02-1.4 8.83-2.41 5.02-4.01 7.02-4.01 3.61-6.62 4.82-5.42 1.81-8.63 1.81-6.22-.6-8.63-1.81-4.82-2.81-6.42-4.82-3.21-4.41-4.01-7.02-1.4-5.62-1.4-8.83.4-6.02 1.4-8.83 2.41-5.02 4.01-7.02 4.01-3.61 6.42-4.82 5.42-1.81 8.63-1.81Zm0 36.73c1.81 0 3.61-.4 5.02-1s2.61-1.81 3.61-3.01 1.81-2.81 2.21-4.41c.4-1.81.8-3.61.8-5.62 0-2.21-.2-4.21-.8-6.02s-1.2-3.21-2.21-4.62c-1-1.2-2.21-2.21-3.61-3.01s-3.21-1-5.02-1-3.61.4-5.02 1c-1.4.8-2.61 1.81-3.61 3.01s-1.81 2.81-2.21 4.62c-.4 1.81-.8 3.61-.8 5.62 0 2.41.2 4.21.8 6.02.4 1.81 1.2 3.21 2.21 4.41s2.21 2.21 3.61 3.01c1.4.8 3.21 1 5.02 1Zm36.32 7.96-12.24-44.15h9.83l8.43 32.77h.4l8.23-32.77h9.83L200.3 58.04h-12.24Zm74.14-7.96c2.18 0 3.51-.6 3.51-.6 1.2-.6 2.01-1 2.81-1.81s1.4-1.81 1.81-2.81a13 13 0 0 0 .8-4.01V13.9h8.63v28.15c0 2.41-.4 4.62-1.4 6.62-.8 2.01-2.21 3.61-3.61 5.02s-3.41 2.41-5.62 3.21-4.62 1.2-7.02 1.2-5.02-.4-7.02-1.2c-2.21-.8-4.01-1.81-5.62-3.21s-2.81-3.01-3.61-5.02-1.4-4.21-1.4-6.62V13.9h8.63v26.95c0 1.61.2 3.01.8 4.01.4 1.2 1.2 2.21 2.01 2.81.8.8 1.81 1.4 2.81 1.81 0 0 1.34.6 3.51.6Zm34.22-36.18v18.92l15.65-18.92h10.82l-15.03 17.32 16.03 26.83h-10.21l-11.44-20.21-5.62 6.22v13.99h-8.83V13.9"/>
        </svg>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" hidden>Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/kubernetes/">Kubernetes</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/apps.html" aria-current="page">Apps</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/repos.html">Repos</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/mobile/">Mobile</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1">
              <div class="search" data-module="search" data-path-to-site-root="/">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input
      type="search"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <ul>
    <li>
      <a href="/repos/email-alert-api.html" rel="noopener" class="govuk-link">email-alert-api</a>
    </li>
    <li>
      <ul>
            <li><a href="/repos/email-alert-api/alert_check_scheduled_jobs.html" rel="noopener" class="govuk-link">Alert Check Scheduled Jobs</a></li>
    <li><a href="/repos/email-alert-api/analytics.html" rel="noopener" class="govuk-link">Analytics</a></li>
    <li><a href="/repos/email-alert-api/api.html" rel="noopener" class="govuk-link">Available endpoints</a></li>
    <li><a href="/repos/email-alert-api/bulk-email.html" rel="noopener" class="govuk-link">Send a bulk email</a></li>
    <li><a href="/repos/email-alert-api/data-cleanup-mechanisms.html" rel="noopener" class="govuk-link">Data cleanup mechanisms</a></li>
    <li><a href="/repos/email-alert-api/env-vars.html" rel="noopener" class="govuk-link">ENV vars</a></li>
    <li><a href="/repos/email-alert-api/load-test-email-alert-api.html" rel="noopener" class="govuk-link">Load test Email Alert API</a></li>
    <li><a href="/repos/email-alert-api/matching-content-to-subscriber-lists.html" rel="noopener" class="govuk-link">Matching content to subscriber lists</a></li>
    <li><a href="/repos/email-alert-api/receiving-emails-from-email-alert-api-in-integration-and-staging.html" rel="noopener" class="govuk-link">Receive emails from Email Alert API in Integration and Staging</a></li>
    <li><a href="/repos/email-alert-api/sidekiq-web.html" rel="noopener" class="govuk-link"># Viewing the Sidekiq UI for Email Alert API</a></li>
    <li><a href="/repos/email-alert-api/subscriber-list-audit.html" rel="noopener" class="govuk-link">Subscriber List Audit</a></li>
    <li><a href="/repos/email-alert-api/support-tasks.html" rel="noopener" class="govuk-link">Support tasks</a></li>
    <li class="subdir__heading">adr</li>
    <ul class="subdir__menu">
          <li><a href="/repos/email-alert-api/adr/adr-001-notify-integration.html" rel="noopener" class="govuk-link">Decision Record: Initial architecture for Notify integration</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-002-digest-mvp.html" rel="noopener" class="govuk-link">Decision Record: MVP implementation of Digests</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-003-initial-data-retention-strategy.html" rel="noopener" class="govuk-link">Decision Record: Initial Data Retention Strategy</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-004-message-concept.html" rel="noopener" class="govuk-link">Decision Record: Message Concept</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-005-record-architecture-decisions.html" rel="noopener" class="govuk-link">5. Record architecture decisions</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-006-email-delivery-responsibilities.html" rel="noopener" class="govuk-link">6. Email Delivery Responsibilities</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-007-retain-data-for-up-to-one-year.html" rel="noopener" class="govuk-link">7. Retain data for up to one year</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-008-monitoring-and-alerting.html" rel="noopener" class="govuk-link">8. Monitoring and alerting</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-009-sidekiq-lost-job-recovery.html" rel="noopener" class="govuk-link">9. Sidekiq Lost Job Recovery</a></li>
    <li><a href="/repos/email-alert-api/adr/adr-010-send-unpublish-emails-for-single-pages.html" rel="noopener" class="govuk-link">Decision record: reinstate unpublish emails for single page subscriptions</a></li>

    </ul>

      </ul>
    </li>
  </ul>

              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled" aria-label="Content">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              
<script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "name": "Home",
        "@id": "http://www.dev.gov.uk/"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "name": "Apps",
        "@id": "http://www.dev.gov.uk/apps.html"
      }
    },
    {
      "@type": "ListItem",
      "position": 3,
      "item": {
        "name": "email-alert-api",
        "@id": "http://www.dev.gov.uk/repos/email-alert-api.html"
      }
    }
  ]
}
</script>

<nav data-module="ga4-link-tracker" aria-label="Breadcrumb" class="gem-c-breadcrumbs govuk-breadcrumbs">
  <ol class="govuk-breadcrumbs__list">
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;1&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/">Home</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;2&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/apps.html">Apps</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;3&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/repos/email-alert-api.html">email-alert-api</a>
        </li>
  </ol>
</nav>
  <div class="govuk-!-font-size-16 govuk-!-margin-top-6">
    <div class="govuk-warning-text">
      <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
      <strong class="govuk-warning-text__text">
        <span class="govuk-warning-text__assistive">Warning</span>
        This document has not been updated for a while now. It may be out of date.
      </strong>
    </div>

  Last updated: <a href="https://github.com/alphagov/email-alert-api/commit/db9997e567f41929e07171591413454e7e1d4c95">20 Nov 2020</a>
</div>

  <h1 class="page-title">email-alert-api: 7. Retain data for up to one year</h1>

  
<p>Date: 2020-11-19</p>
<h2 id="context">Context</h2>
<p>The original ADR concerning data retention resides <a href="https://github.com/alphagov/email-alert-api/blob/master/docs/adr/adr-003-data-retention.md">here</a> and
outlines our approach from February 2018. At that point in time it was decided
we should retain all data in Email Alert Api with the exception of
emails which are <a href="https://github.com/alphagov/email-alert-api/blob/master/app/workers/email_archive_worker.rb">archived</a> to S3 &amp; <a href="https://github.com/alphagov/email-alert-api/blob/master/app/workers/email_deletion_worker.rb">deleted</a> after a week.</p>
<p>Since then we've come to realise that a revision of our data retention policy
is needed as we're generating more data that will never be used again - by us,
or the system.</p>
<p>This was initially prompted by recent work to <a href="https://github.com/alphagov/email-alert-api/pull/1352">migrate subscribers to daily
digest emails</a> which lead to an increase in the amount of unmanaged data we
produce and store locally in Email Alert Api. Consequently, this provoked worries
that perpetually keeping data could result in capacity issues due to the rapid
increase in data being stored. An example being we now generate ~430,000
<code>DigestRunSubscriber</code> records each day which is about eight times the amount
compared to that of ten months ago.</p>
<p>We've also gained more insight into what data we're not using for analytics.
The original plan documented in the previous retention policy was to retain as
much data as possible to enable us to do as much analysis as needed in the
future. However, much of this data is never used for analysis and so doesn't
serve a purpose in the email system.</p>
<p>Contrary to what was previously thought, storing lots of unused data
indefinitely actually complicates and pollutes our auditing and analysis. An
example of this can be seen if we look at subscriber lists. We have over
~73,000 lists with active subscribers but in the last week alone, we've
accumulated 1139 lists which don't have any subscriptions at all (ended or
active). These unused lists prevent us from doing simple auditing tasks
easily, like finding which lists to report on.</p>
<p>Knowing the above, we thought about how we could clean-up this unused data to
keep Email Alert Api's database manageable going forward. There are a couple of
different approaches to consider, including storing unused data in cloud
storage away from the system's database (like we do when archiving emails) and
subsequently deleting the data locally. Or, setting up a means of removing the
data we don't use from the system entirely.</p>
<h2 id="decision">Decision</h2>
<p>We decided that historic, unused data should be removed periodically from the
system entirely. It was concluded that the data the system no longer uses
should only exist for a maximum of 1 year before removal. We sometimes
analyse historic data from up to a year ago but we have no evidence of needing
this data for analytics beyond a year.</p>
<p>The following list documents our approach to the decision for different data
in the system.</p>
<ul>
<li>
<p><strong>ContentChange, Message &amp; DigestRun</strong>. Remove once their <code>created_at</code> value is
over a year old.</p>
</li>
<li>
<p><strong>MatchedContentChange, MatchedMessage &amp; DigestRunSubscriber</strong>. Removed
automatically when their parent ContentChange/Message/DigestRun is
deleted.</p>
</li>
<li>
<p><strong>Subscription</strong>. Remove subscriptions when they've been ended for over a
year, based on their <code>ended_at</code> value. Once a subscription is ended it <a href="https://github.com/alphagov/email-alert-api/blob/master/docs/adr/adr-003-data-retention.md#subscriber-and-subscription">can't
currently be made active again</a> and so can be deleted.</p>
</li>
<li>
<p><strong>Previously subscribed to SubscriberList</strong>. Remove lists when they have no
active subscriptions and their latest, ended subscription is over a year old.
It is possible for a list we deem as historic to be subscribed to again,
however this seems unlikely due to the list not having any active
subscriptions for over a year.  If this was to happen, after the list has
been deleted then a new <code>SubscriberList</code> record will be generated.</p>
</li>
<li>
<p><strong>Unused SubscriberList</strong>. Remove lists which have never had any
subscriptions and are over 7 days old. A scenario of when this can happen is
when a user quits their signup journey midway through. 7 days was the chosen
retention period to allow users to complete their signup journey as they have
a <a href="https://github.com/alphagov/email-alert-api/blob/f0c61539f7244bdb52db54d277a46412b728d642/app/services/auth_token_generator_service.rb#L7">7 day limit</a> to confirm their subscription. As mentioned in the context
section, unused subscriber lists pollute our analytics and so we should
remove them regularly.</p>
</li>
<li>
<p><strong>Subscriber</strong>. Remove subscribers once their <code>created_at</code> is over a year old
and they don't have any subscriptions (active or ended). Subscribers should
only be without subscriptions when their historic subscriptions have been
deleted. This means we should be able to delete all subscribers (under a year
old too) that don't have any subscriptions. However, we don't delete these
subscribers to prevent us from removing new subscribers that lack
subscriptions, due to flaws in our code.  Some examples of where it was
unintentionally possible to end up with subscribers with no subscriptions can
be found <a href="https://github.com/alphagov/email-alert-api/pull/1462/commits/053859c5962eef104256661f28727b08a43e3d31">here</a> and <a href="https://github.com/alphagov/email-alert-api/pull/1462/commits/a4b3e82801d79abd3989b1dd60ffd499e7ce82ba">here</a>.</p>
</li>
</ul>
<p>Emails (and their associated SubscriptionContents) are the one place where we
already manage retention - these are held locally for 7 days, and also
archived to Athena indefinitely. We still need this low retention for Emails in
order to manage the size of the table. However, the archiving to Athena is
inconsistent with the above decision to delete unused data entirely. While we
originally thought Athena might serve as a data source for analytics, this has
not happened in practice, so the archive data stored there is entirely unused.
We therefore decided to remove the archiving mechanism for Emails, since it has
no value.</p>
<h2 id="status">Status</h2>
<p>Accepted</p>
<h2 id="consequences">Consequences</h2>
<h3 id="historic-deletion-worker">Historic deletion worker</h3>
<p>We implemented a <a href="https://github.com/alphagov/email-alert-api/blob/a62abc85453b723d683c2dc13f3bf0065fb86d5f/app/workers/historical_data_deletion_worker.rb">worker</a> which runs periodically every day at <a href="https://github.com/alphagov/email-alert-api/blob/master/config/sidekiq.yml#L23-L25">midday</a>.
Removing this data was deemed as non urgent and so deleting once a day, in
hours, seemed sufficient.</p>
<h3 id="the-first-historic-deletion-run">The first historic deletion run</h3>
<p>On the first run of the worker which handles deleting historical data we
removed over 33 million records. A breakdown of the amount of deletions per
model can be found below:</p>
<ul>
<li>
<p>ContentChange - 148,617</p>
</li>
<li>
<p>MatchedContentChange - 1,825,983</p>
</li>
<li>
<p>Message - 15</p>
</li>
<li>
<p>MatchedMessage - 16,099</p>
</li>
<li>
<p>DigestRun - 677</p>
</li>
<li>
<p>DigestRunSubscriber - 30,858,770</p>
</li>
<li>
<p>Subscription - 1,046,576</p>
</li>
<li>
<p>SubscriberList - 11,470</p>
</li>
<li>
<p>Subscriber - 196,376</p>
</li>
</ul>
<h3 id="restrict-analytics-to-1-year-of-unused-data">Restrict analytics to 1 year of unused data</h3>
<p>We now restrict our unused data for analytics to a period of at most 1 year.
This means any queries looking for this data (e.g. ended subscriptions over a
year old) will be met with no results. We don't expect this to be an issue due
to our current expectation of the data we'll need for future analytics.</p>
<h3 id="modify-the-nullify-process-and-retire-the-deactivated-concept">Modify the nullify process and retire the deactivated concept</h3>
<p>When documenting our data retention policy as described in this ADR, we found
it difficult to understand and document the tangential concept of <a href="https://github.com/alphagov/email-alert-api/blob/master/docs/adr/adr-003-data-retention.md#subscriber-and-subscription">deactivating
and nullifying</a> subscribers.</p>
<p>To give some context on these concepts:</p>
<ul>
<li>
<p>Nullifying subscribers means to update the <code>address</code> of <code>Subscriber</code> records
to <code>nil</code> which have been unsubscribed from all subscriptions, for more than
28 days.</p>
</li>
<li>
<p>Deactivating subscribers is a concept that revolves around the
<code>deactivated_at</code> field on the subscriber model. This field is populated when
a subscriber unsubscribes from their last active subscription. It is used as
a means to determine when a subscriber can be nullified.</p>
</li>
</ul>
<p>We can however obtain the information held within <code>deactivated_at</code> through the
<code>ended_at</code> field of the most recent ended subscription of an unsubscribed
user, meaning the deactivated concept is superfluous.</p>
<p>Subsequently we didn't want to spend energy documenting a process that didn't
make much sense to begin with so it was decided that it would be easier (and
beneficial as a whole) to just <a href="https://github.com/alphagov/email-alert-api/pull/1462">remove</a> the deactivated concept completely.</p>
<p>In removing the deactivated concept we <a href="https://github.com/alphagov/email-alert-api/pull/1462/commits/cefdfa76b13915ea96b131490fd3186b6d52cf05">modified the nullify process</a> to use
<code>ended_at</code>, as described above, instead of <code>deactivated_at</code>. We also updated
the process to nullify subscribers which have no subscriptions (active or
ended) and are older than 28 days. This prevents the system from storing user's
personal data longer than needed, if for whatever reason, a subscriber is
created without any subscriptions. See examples of where this happened
<a href="https://github.com/alphagov/email-alert-api/pull/1462/commits/053859c5962eef104256661f28727b08a43e3d31">here</a> and <a href="https://github.com/alphagov/email-alert-api/pull/1462/commits/a4b3e82801d79abd3989b1dd60ffd499e7ce82ba">here</a>.</p>
<h3 id="deprecate-archiving-email-to-athena">Deprecate archiving Email to Athena</h3>
<p>We have planned work to remove it in the future. In the meantime, we consider
archiving to Athena to be deprecated, and have updated <a href="https://github.com/alphagov/email-alert-api/blob/1a25d44126709bf8a98955d7609ced439095dd9c/docs/analytics.md">the documentation around
it</a> to reflect this status.</p>

  <script>
    /*
      Manually trigger the styling of the 'current page' in the sidebar,
      as it does not happen automatically because we are still technically
      in single page mode.
    */
    (function () {
        'use strict'
        /*
          Cannot use `$(document).ready` on next line as jQuery has not loaded
          yet. But we can use jQuery in the callback.
        */
        window.addEventListener('load', function () {
            try {
                new GOVUK.Modules.InPageNavigation().start($("html"));
            }
            catch (error) {
                /* Fail without causing other JS in the page to break */
                console.log("Error calling GOVUK's InPageNavigation module", error);
            }
        })
    }());
</script>


            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/email-alert-api/blob/main/docs/adr/adr-007-retain-data-for-up-to-one-year.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?body=Problem+with+%27%27+%28https%3A%2F%2Fdocs.publishing.service.gov.uk%2Frepos%2Femail-alert-api%2Fadr%2Fadr-007-retain-data-for-up-to-one-year.html%29&amp;labels=bug&amp;title=Re%3A+%27%27">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <svg focusable="false" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 60" height="30" width="32" fill="currentcolor" class="govuk-footer__crown">
    <g>
      <circle cx="20" cy="17.6" r="3.7"></circle>
      <circle cx="10.2" cy="23.5" r="3.7"></circle>
      <circle cx="3.7" cy="33.2" r="3.7"></circle>
      <circle cx="31.7" cy="30.6" r="3.7"></circle>
      <circle cx="43.3" cy="17.6" r="3.7"></circle>
      <circle cx="53.2" cy="23.5" r="3.7"></circle>
      <circle cx="59.7" cy="33.2" r="3.7"></circle>
      <circle cx="31.7" cy="30.6" r="3.7"></circle>
      <path d="M33.1,9.8c.2-.1.3-.3.5-.5l4.6,2.4v-6.8l-4.6,1.5c-.1-.2-.3-.3-.5-.5l1.9-5.9h-6.7l1.9,5.9c-.2.1-.3.3-.5.5l-4.6-1.5v6.8l4.6-2.4c.1.2.3.3.5.5l-2.6,8c-.9,2.8,1.2,5.7,4.1,5.7h0c3,0,5.1-2.9,4.1-5.7l-2.6-8ZM37,37.9s-3.4,3.8-4.1,6.1c2.2,0,4.2-.5,6.4-2.8l-.7,8.5c-2-2.8-4.4-4.1-5.7-3.8.1,3.1.5,6.7,5.8,7.2,3.7.3,6.7-1.5,7-3.8.4-2.6-2-4.3-3.7-1.6-1.4-4.5,2.4-6.1,4.9-3.2-1.9-4.5-1.8-7.7,2.4-10.9,3,4,2.6,7.3-1.2,11.1,2.4-1.3,6.2,0,4,4.6-1.2-2.8-3.7-2.2-4.2.2-.3,1.7.7,3.7,3,4.2,1.9.3,4.7-.9,7-5.9-1.3,0-2.4.7-3.9,1.7l2.4-8c.6,2.3,1.4,3.7,2.2,4.5.6-1.6.5-2.8,0-5.3l5,1.8c-2.6,3.6-5.2,8.7-7.3,17.5-7.4-1.1-15.7-1.7-24.5-1.7h0c-8.8,0-17.1.6-24.5,1.7-2.1-8.9-4.7-13.9-7.3-17.5l5-1.8c-.5,2.5-.6,3.7,0,5.3.8-.8,1.6-2.3,2.2-4.5l2.4,8c-1.5-1-2.6-1.7-3.9-1.7,2.3,5,5.2,6.2,7,5.9,2.3-.4,3.3-2.4,3-4.2-.5-2.4-3-3.1-4.2-.2-2.2-4.6,1.6-6,4-4.6-3.7-3.7-4.2-7.1-1.2-11.1,4.2,3.2,4.3,6.4,2.4,10.9,2.5-2.8,6.3-1.3,4.9,3.2-1.8-2.7-4.1-1-3.7,1.6.3,2.3,3.3,4.1,7,3.8,5.4-.5,5.7-4.2,5.8-7.2-1.3-.2-3.7,1-5.7,3.8l-.7-8.5c2.2,2.3,4.2,2.7,6.4,2.8-.7-2.3-4.1-6.1-4.1-6.1h10.6,0Z"></path>
    </g>
  </svg>
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Accessibility</a>
            </li>
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/cookies.html">Cookies</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/govuk_frontend.js" type="module"></script>
    <script src="/javascripts/application.js"></script>
  </body>
</html>
