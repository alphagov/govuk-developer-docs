

<!doctype html>
<html lang="en" class="govuk-template govuk-template--rebranded no-js">
  <head>
    
    

    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>govuk-infrastructure: 19. Restructure CI/CD - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/repos/govuk-infrastructure/architecture/decisions/0019-restructure-cicd.html">
      <link rel="icon" sizes="48x48" href="/assets/govuk/assets/rebrand/images/favicon.ico">
      <link rel="icon" sizes="any" href="/assets/govuk/assets/rebrand/images/favicon.svg" type="image/svg+xml">
      <link rel="mask-icon" href="/assets/govuk/assets/rebrand/images/govuk-icon-mask.svg" color="#0b0c0c">
      <link rel="apple-touch-icon" href="/assets/govuk/assets/rebrand/images/govuk-icon-180.png">
      <link rel="manifest" href="/assets/govuk/assets/rebrand/manifest.json">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.publishing.service.gov.uk/assets/govuk/assets/rebrand/images/govuk-opengraph-image.png" />
      <meta name="twitter:title" content="govuk-infrastructure: 19. Restructure CI/CD - GOV.UK Developer Documentation" />
      <meta name="twitter:url" content="https://docs.publishing.service.gov.uk/repos/govuk-infrastructure/architecture/decisions/0019-restructure-cicd.html" />

      <meta property="og:image" content="https://docs.publishing.service.gov.uk/assets/govuk/assets/rebrand/images/govuk-opengraph-image.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="govuk-infrastructure: 19. Restructure CI/CD" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/repos/govuk-infrastructure/architecture/decisions/0019-restructure-cicd.html" />

      <script>
  document.addEventListener('DOMContentLoaded', function () {
    var markup = `<div id="global-cookie-message" data-module="cookie-banner" data-nosnippet="" aria-label="Can we store analytics cookies on your device?" class="gem-c-cookie-banner govuk-clearfix govuk-cookie-banner js-banner-wrapper" role="region" hidden="hidden" title="Can we store analytics cookies on your device?"> <div class="govuk-cookie-banner__message govuk-width-container"> <div class="govuk-grid-row"> <div class="govuk-grid-column-two-thirds"> <h2 class="govuk-cookie-banner__heading govuk-heading-m">Can we store analytics cookies on your device?</h2> <div tabindex="-1" class="govuk-cookie-banner__content gem-c-cookie-banner__confirmation"> <div class="gem-c-cookie-banner__content"><p class='govuk-body'>We’d like to set some cookies to understand how you use this site and remember your settings.</p><p class='govuk-body'>We also use cookies set by other sites to help us deliver content from their services.</p></div> <p class="gem-c-cookie-banner__confirmation-message--accepted govuk-body" hidden data-ga4-cookie-banner data-module="ga4-link-tracker" data-ga4-track-links-only data-ga4-set-indexes data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;cookie banner&quot;,&quot;section&quot;:&quot;You have accepted additional cookies&quot;}" >You have accepted additional cookies. <span class="gem-c-cookie-banner__confirmation-message">You can <a class="govuk-link" href="/cookies.html">change your cookie settings</a> at any time.</span></p> <p class="gem-c-cookie-banner__confirmation-message--rejected govuk-body" hidden>You have rejected additional cookies. <span class="gem-c-cookie-banner__confirmation-message">You can <a class="govuk-link" href="/cookies.html">change your cookie settings</a> at any time.</span></p> </div> </div> </div> <div class="js-confirmation-buttons govuk-button-group"> <button class="gem-c-button govuk-button" type="submit" data-accept-cookies="true" data-cookie-types="all">Accept additional cookies</button> <button class="gem-c-button govuk-button" type="submit" data-reject-cookies="true">Reject additional cookies</button> <a class="govuk-link" href="/cookies.html">View cookies</a> </div> <div hidden class="js-hide-button govuk-button-group"> <button class="gem-c-cookie-banner__hide-button govuk-button" data-hide-cookie-banner="true" data-module="ga4-event-tracker" data-ga4-event="{&quot;event_name&quot;:&quot;select_content&quot;,&quot;type&quot;:&quot;cookie banner&quot;,&quot;action&quot;:&quot;closed&quot;,&quot;section&quot;:&quot;You have accepted additional cookies&quot;}" > Hide cookie message </button> </div> </div> </div>`;
    var banner = document.createElement('div');
    banner.innerHTML = markup;
    document.body.prepend(banner);
  })
</script>


  </head>

  <body class="govuk-template__body">
    <script>document.body.className += ' js-enabled' + ('noModule' in HTMLScriptElement.prototype ? ' govuk-frontend-supported' : '');</script>

    <div class="app-pane">
      
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <svg
          focusable="false"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 324 60"
          height="30"
          width="162"
          fill="currentcolor"
          class="govuk-header__logotype"
          aria-label="GOV.UK">
          <title>GOV.UK</title>
          <g>
            <circle cx="20" cy="17.6" r="3.7"></circle>
            <circle cx="10.2" cy="23.5" r="3.7"></circle>
            <circle cx="3.7" cy="33.2" r="3.7"></circle>
            <circle cx="31.7" cy="30.6" r="3.7"></circle>
            <circle cx="43.3" cy="17.6" r="3.7"></circle>
            <circle cx="53.2" cy="23.5" r="3.7"></circle>
            <circle cx="59.7" cy="33.2" r="3.7"></circle>
            <circle cx="31.7" cy="30.6" r="3.7"></circle>
            <path d="M33.1,9.8c.2-.1.3-.3.5-.5l4.6,2.4v-6.8l-4.6,1.5c-.1-.2-.3-.3-.5-.5l1.9-5.9h-6.7l1.9,5.9c-.2.1-.3.3-.5.5l-4.6-1.5v6.8l4.6-2.4c.1.2.3.3.5.5l-2.6,8c-.9,2.8,1.2,5.7,4.1,5.7h0c3,0,5.1-2.9,4.1-5.7l-2.6-8ZM37,37.9s-3.4,3.8-4.1,6.1c2.2,0,4.2-.5,6.4-2.8l-.7,8.5c-2-2.8-4.4-4.1-5.7-3.8.1,3.1.5,6.7,5.8,7.2,3.7.3,6.7-1.5,7-3.8.4-2.6-2-4.3-3.7-1.6-1.4-4.5,2.4-6.1,4.9-3.2-1.9-4.5-1.8-7.7,2.4-10.9,3,4,2.6,7.3-1.2,11.1,2.4-1.3,6.2,0,4,4.6-1.2-2.8-3.7-2.2-4.2.2-.3,1.7.7,3.7,3,4.2,1.9.3,4.7-.9,7-5.9-1.3,0-2.4.7-3.9,1.7l2.4-8c.6,2.3,1.4,3.7,2.2,4.5.6-1.6.5-2.8,0-5.3l5,1.8c-2.6,3.6-5.2,8.7-7.3,17.5-7.4-1.1-15.7-1.7-24.5-1.7h0c-8.8,0-17.1.6-24.5,1.7-2.1-8.9-4.7-13.9-7.3-17.5l5-1.8c-.5,2.5-.6,3.7,0,5.3.8-.8,1.6-2.3,2.2-4.5l2.4,8c-1.5-1-2.6-1.7-3.9-1.7,2.3,5,5.2,6.2,7,5.9,2.3-.4,3.3-2.4,3-4.2-.5-2.4-3-3.1-4.2-.2-2.2-4.6,1.6-6,4-4.6-3.7-3.7-4.2-7.1-1.2-11.1,4.2,3.2,4.3,6.4,2.4,10.9,2.5-2.8,6.3-1.3,4.9,3.2-1.8-2.7-4.1-1-3.7,1.6.3,2.3,3.3,4.1,7,3.8,5.4-.5,5.7-4.2,5.8-7.2-1.3-.2-3.7,1-5.7,3.8l-.7-8.5c2.2,2.3,4.2,2.7,6.4,2.8-.7-2.3-4.1-6.1-4.1-6.1h10.6,0Z"></path>
          </g>
          <circle class="govuk-logo-dot" cx="226" cy="36" r="7.3"/>
          <path d="M93.94 41.25c.4 1.81 1.2 3.21 2.21 4.62 1 1.4 2.21 2.41 3.61 3.21s3.21 1.2 5.22 1.2 3.61-.4 4.82-1c1.4-.6 2.41-1.4 3.21-2.41.8-1 1.4-2.01 1.61-3.01s.4-2.01.4-3.01v.14h-10.86v-7.02h20.07v24.08h-8.03v-5.56c-.6.8-1.38 1.61-2.19 2.41-.8.8-1.81 1.2-2.81 1.81-1 .4-2.21.8-3.41 1.2s-2.41.4-3.81.4a18.56 18.56 0 0 1-14.65-6.63c-1.6-2.01-3.01-4.41-3.81-7.02s-1.4-5.62-1.4-8.83.4-6.02 1.4-8.83a20.45 20.45 0 0 1 19.46-13.65c3.21 0 4.01.2 5.82.8 1.81.4 3.61 1.2 5.02 2.01 1.61.8 2.81 2.01 4.01 3.21s2.21 2.61 2.81 4.21l-7.63 4.41c-.4-1-1-1.81-1.61-2.61-.6-.8-1.4-1.4-2.21-2.01-.8-.6-1.81-1-2.81-1.4-1-.4-2.21-.4-3.61-.4-2.01 0-3.81.4-5.22 1.2-1.4.8-2.61 1.81-3.61 3.21s-1.61 2.81-2.21 4.62c-.4 1.81-.6 3.71-.6 5.42s.8 5.22.8 5.22Zm57.8-27.9c3.21 0 6.22.6 8.63 1.81 2.41 1.2 4.82 2.81 6.62 4.82S170.2 24.39 171 27s1.4 5.62 1.4 8.83-.4 6.02-1.4 8.83-2.41 5.02-4.01 7.02-4.01 3.61-6.62 4.82-5.42 1.81-8.63 1.81-6.22-.6-8.63-1.81-4.82-2.81-6.42-4.82-3.21-4.41-4.01-7.02-1.4-5.62-1.4-8.83.4-6.02 1.4-8.83 2.41-5.02 4.01-7.02 4.01-3.61 6.42-4.82 5.42-1.81 8.63-1.81Zm0 36.73c1.81 0 3.61-.4 5.02-1s2.61-1.81 3.61-3.01 1.81-2.81 2.21-4.41c.4-1.81.8-3.61.8-5.62 0-2.21-.2-4.21-.8-6.02s-1.2-3.21-2.21-4.62c-1-1.2-2.21-2.21-3.61-3.01s-3.21-1-5.02-1-3.61.4-5.02 1c-1.4.8-2.61 1.81-3.61 3.01s-1.81 2.81-2.21 4.62c-.4 1.81-.8 3.61-.8 5.62 0 2.41.2 4.21.8 6.02.4 1.81 1.2 3.21 2.21 4.41s2.21 2.21 3.61 3.01c1.4.8 3.21 1 5.02 1Zm36.32 7.96-12.24-44.15h9.83l8.43 32.77h.4l8.23-32.77h9.83L200.3 58.04h-12.24Zm74.14-7.96c2.18 0 3.51-.6 3.51-.6 1.2-.6 2.01-1 2.81-1.81s1.4-1.81 1.81-2.81a13 13 0 0 0 .8-4.01V13.9h8.63v28.15c0 2.41-.4 4.62-1.4 6.62-.8 2.01-2.21 3.61-3.61 5.02s-3.41 2.41-5.62 3.21-4.62 1.2-7.02 1.2-5.02-.4-7.02-1.2c-2.21-.8-4.01-1.81-5.62-3.21s-2.81-3.01-3.61-5.02-1.4-4.21-1.4-6.62V13.9h8.63v26.95c0 1.61.2 3.01.8 4.01.4 1.2 1.2 2.21 2.01 2.81.8.8 1.81 1.4 2.81 1.81 0 0 1.34.6 3.51.6Zm34.22-36.18v18.92l15.65-18.92h10.82l-15.03 17.32 16.03 26.83h-10.21l-11.44-20.21-5.62 6.22v13.99h-8.83V13.9"/>
        </svg>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" hidden>Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/kubernetes/">Kubernetes</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/apps.html" aria-current="page">Apps</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/repos.html">Repos</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/mobile/">Mobile</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1">
              <div class="search" data-module="search" data-path-to-site-root="/">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input
      type="search"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <ul>
    <li>
      <a href="/repos/govuk-infrastructure.html" rel="noopener" class="govuk-link">govuk-infrastructure</a>
    </li>
    <li>
      <ul>
            <li><a href="/repos/govuk-infrastructure/README.html" rel="noopener" class="govuk-link">Introduction to GOV.UK infrastructure</a></li>
    <li><a href="/repos/govuk-infrastructure/cluster-upgrade.html" rel="noopener" class="govuk-link">Upgrading the cluster</a></li>
    <li><a href="/repos/govuk-infrastructure/create-a-new-environment.html" rel="noopener" class="govuk-link">Create a new environment</a></li>
    <li><a href="/repos/govuk-infrastructure/kubernetes-external-secrets.html" rel="noopener" class="govuk-link">Kubernetes external secrets</a></li>
    <li><a href="/repos/govuk-infrastructure/prerequisite-secrets.html" rel="noopener" class="govuk-link">Prerequisite secrets</a></li>
    <li><a href="/repos/govuk-infrastructure/setting-up-content-delivery-network.html" rel="noopener" class="govuk-link">setting-up-content-delivery-network</a></li>
    <li><a href="/repos/govuk-infrastructure/terraform-shared-modules.html" rel="noopener" class="govuk-link">Shared Terraform modules</a></li>
    <li class="subdir__heading">architecture</li>
    <ul class="subdir__menu">
          <li class="subdir__heading">decisions</li>
    <ul class="subdir__menu">
          <li><a href="/repos/govuk-infrastructure/architecture/decisions/0000-TEMPLATE.html" rel="noopener" class="govuk-link">0000-TEMPLATE</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0001-record-architecture-decisions.html" rel="noopener" class="govuk-link">1. Record architecture decisions</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0002-use-aws-eks-terraform-module.html" rel="noopener" class="govuk-link">2. Use `aws-eks` Terraform module</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0003-split-terraform-state-into-separate-aws-cluster-and-kubernetes-resource-phases.html" rel="noopener" class="govuk-link">3. Split Terraform state into separate AWS cluster and Kubernetes resource phases</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0004-use-aws-load-balancer-controller-for-edge-traffic-services.html" rel="noopener" class="govuk-link">0004-use-aws-load-balancer-controller-for-edge-traffic-services</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0005-use-eks-managed-node-groups.html" rel="noopener" class="govuk-link">0005-use-eks-managed-node-groups</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0006-use-helm-for-application-package-management.html" rel="noopener" class="govuk-link">6. Use Helm for application package management</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0007-use-fluentbit-elasticsearch-and-kibana-for-application-logs.html" rel="noopener" class="govuk-link">0007-use-fluentbit-elasticsearch-and-kibana-for-application-logs</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0008-use-external-secrets-for-secrets-storage.html" rel="noopener" class="govuk-link">8. Use external-secrets for secrets storage</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0009-use-external-dns-for-dns-record-management.html" rel="noopener" class="govuk-link">9. Use `external-dns` for DNS record management</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0010-use-dex-idp-for-user-web-authentication.html" rel="noopener" class="govuk-link">10. Use Dex IdP for user web authentication</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0011-use-graviton-for-compute-instances.html" rel="noopener" class="govuk-link">0011-use-graviton-for-compute-instances</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0012-non-govuk-domain-policy.html" rel="noopener" class="govuk-link">0012-non-govuk-domain-policy</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0013-expose-external-metrics-for-hpa.html" rel="noopener" class="govuk-link">0013-expose-external-metrics-for-hpa</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0014-replace-terraform-cloud.html" rel="noopener" class="govuk-link">14. Replace Terraform Cloud backend with AWS S3</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0015-maintain-a-readonly-role.html" rel="noopener" class="govuk-link">15. Maintain a read-only IAM role</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0016-use-iam-roles-for-services.html" rel="noopener" class="govuk-link">16. Use IAM roles for external services and applications</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0017-retire-use-of-github-topics-for-config-management.html" rel="noopener" class="govuk-link">17. Retire use of GitHub topics for configuration management</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0018-use-concourse-ci.html" rel="noopener" class="govuk-link">0018-use-concourse-ci</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0019-restructure-cicd.html" rel="noopener" class="govuk-link">19. Restructure CI/CD</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0020-use-crossplane-for-abstraction.html" rel="noopener" class="govuk-link">20. Use Crossplane for abstraction</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0021-give-fastly-cname-records-a-TTL-of-300.html" rel="noopener" class="govuk-link">21. Give Fastly CNAME records a TTL of 300</a></li>
    <li><a href="/repos/govuk-infrastructure/architecture/decisions/0022-use-pkl-for-configuration.html" rel="noopener" class="govuk-link">22. Use Pkl for configuration</a></li>

    </ul>

    </ul>
    <li class="subdir__heading">logit</li>
    <ul class="subdir__menu">
          <li class="subdir__heading">logit</li>
    <ul class="subdir__menu">
          <li><a href="/repos/govuk-infrastructure/logit/logit/README.html" rel="noopener" class="govuk-link">Intro</a></li>

    </ul>

    </ul>

      </ul>
    </li>
  </ul>

              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled" aria-label="Content">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              
<script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "name": "Home",
        "@id": "http://www.dev.gov.uk/"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "name": "Repos",
        "@id": "http://www.dev.gov.uk/repos.html"
      }
    },
    {
      "@type": "ListItem",
      "position": 3,
      "item": {
        "name": "govuk-infrastructure",
        "@id": "http://www.dev.gov.uk/repos/govuk-infrastructure.html"
      }
    }
  ]
}
</script>

<nav data-module="ga4-link-tracker" aria-label="Breadcrumb" class="gem-c-breadcrumbs govuk-breadcrumbs">
  <ol class="govuk-breadcrumbs__list">
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;1&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/">Home</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;2&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/repos.html">Repos</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;3&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/repos/govuk-infrastructure.html">govuk-infrastructure</a>
        </li>
  </ol>
</nav>
  <div class="govuk-!-font-size-16 govuk-!-margin-top-6">

  Last updated: <a href="https://github.com/alphagov/govuk-infrastructure/commit/ca39e810846c5fbb9c646909fc21f8bb245b9304">14 Jan 2026</a>
</div>

  <h1 class="page-title">govuk-infrastructure: 19. Restructure CI/CD</h1>

  
<p>Date: 2025-10-16</p>
<h2 id="status">Status</h2>
<p>Accepted</p>
<h2 id="context">Context</h2>
<p>This ADR aims to document the Platform Engineering team's goal state for the process applications(and the platform
itself) go through to get from source code to a production system. Most of the thinking and debate over this has
happened between June 2025 and October 2025, in various documents, conversations, and team meetings. The final structure
we are documenting here is the product of team design sessions on 15th October 2025.</p>
<h3 id="the-problem">The problem</h3>
<p>In June 2024 we had an IT Health Check conducted that flagged some critical vulnerabilities in the fundamental
architecture of our CI/CD processes. In April 2025, we also carried out some user research with the application teams,
our senior management team, and ourselves to learn about the pain points involved with our current setup.</p>
<p>The nature of the vulnerabilities and the specific things we learned from the research are out of scope here. However,
between those two data points, our own generalised dissatisfaction, and our decision to <a href="https://github.com/alphagov/govuk-infrastructure/blob/main/docs/architecture/decisions/0014-replace-terraform-cloud.md">replace Terraform Cloud</a>
we felt that a total rework would be the best option.</p>
<h3 id="technology-choice">Technology choice</h3>
<p>In the lead up to making the decisions documented here, we went through a small number of investigations to select
the technologies we wanted to use. We did this knowing from experience that we would be able to solve the problems we
would need to solve using whatever technologies we chose.</p>
<p>The researched culminated in us <a href="https://github.com/alphagov/govuk-infrastructure/blob/main/docs/architecture/decisions/0018-use-concourse-ci.md">deciding to use Concourse CI</a> as our CI/CD tool of choice.</p>
<p>At this time of writing, there is ongoing research into the tool we should select for YAML generation. A subsequent
ADR will cover that choice.</p>
<h2 id="inputs-into-the-decision-making-process">Inputs into the decision-making process</h2>
<p>In the run-up to the team design session on 15th October 2025, we put together a number of documents whose contents
would feed into how we evaluated our options.</p>
<p>Firstly we wrote down what we felt to be our <a href="https://docs.google.com/document/d/1P4ZNrY2N4sq_XtVmPZLFjiYQ6L-dSeNzrr7sONPK6zo/edit?usp=sharing">core principles of secure CI/CD</a>.
These principles describe the properties that any solution we come up with must have. We used them to help us
evaluate the options in front of us, and we intend to use them in the future to evaluate changes and additions.</p>
<p>Second we wrote down what we felt should be <a href="https://docs.google.com/document/d/1PiJmHrmFWI98PydSY2Jq4UWHh3PuwZITkmHnQc-UzjY/edit?tab=t.0#heading=h.jahzhj4gax23">the guiding ideas for what we want the GOV.UK platform to become</a>.
Expressing these ideas in writing and reviewing them together helped us all get on the same page about what it should
be to use our platform at a high level. Consensus on that will in turn guide the decisions we make.</p>
<!-- raw HTML omitted -->
<p>The final document we produced as input showed <a href="https://docs.google.com/document/d/1odUWlmmgVXlb5PlveA7j_jAbwlgsCb8zyKEIP472XvI/edit?tab=t.0">the possible ways we could deploy Concourse</a>.
We used this to focus our discussions, and the options it presented are summarised for posterity in the next section.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="options">Options</h2>
<h3 id="option-1-concourse-on-ec2">Option 1: Concourse on EC2</h3>
<p>Under option 1 we would run Concourse on EC2 instances, either in each environment or as a central management cluster.
This is how the GOV.UK Pay team runs Concourse, and we would be able to crib a lot of code from them to get started.</p>
<p>We immediately dismissed this option because EC2 is not a service we use directly elsewhere. We would have to do a lot
of work to build out and maintain the Concourse infrastructure in comparison to running it in Kubernetes.</p>
<h3 id="option-2-concourse-on-kubernetes-in-a-management-cluster">Option 2: Concourse on Kubernetes in a management cluster</h3>
<p>Under option 2 we would create a new AWS account, and in it a new Kubernetes cluster. That cluster would run the
Concourse web node and a number of worker nodes.</p>
<p>To perform deployments, the workers would require privilege enough to reach into other environments.</p>
<p>Going down this route would give us a single place to run deployments from, which would make it easy to see the state of
any deployment across all environments. It would also give us a convenient place to run the types of jobs that aren't
related to one environment, such as configuring GitHub access.</p>
<p>It would also present all the risks associated with crossing the already established security boundaries around the
existing environments, and its level of privilege would make it an obvious target for attackers.</p>
<p>From a reliability perspective, a management cluster in control of deployments to all environments represents a large
single point of failure.</p>
<h3 id="option-3-concourse-in-each-application-cluster">Option 3: Concourse in each application cluster</h3>
<p>Under option 3 we would run the Concourse web node and its workers directly on the Kubernetes cluster in each
environment. It would be responsible for, and have permission to, deploy to the environment in which it runs.</p>
<p>Choosing option 3 would give us good separation between the environments, but would present additional maintenance
burden. It also does not address the needs of development teams to see the state of their deployments across all
environments in a single place.</p>
<h3 id="option-4-separate-infrastructure-and-application-concourses-per-environment">Option 4: Separate infrastructure and application Concourses per environment</h3>
<p>Option 4 is very similar to option 3, but we would have a separate Concourse deployments for infrastructure changes and
application changes. This would further separate the levels of privilege needed, but would contribute further to the
maintenance burden.</p>
<h3 id="option-5-one-concourse-on-one-cluster-with-all-the-environments">Option 5: One Concourse on one cluster with all the environments</h3>
<!-- raw HTML omitted -->
<p>Option 5 was brought up and discussed briefly on the team day on 15th October 2025. The proposal would be to begin
deploying teams' staging and integration applications into the production cluster, with suitable isolation and security
controls.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>The platform engineering team would maintain integration and staging clusters for the purposes of developing and testing
changes to the platform, but the applications running on them would be synthetic ones.</p>
<p>The effect of this change would be to turn the production cluster into <em>the platform</em>. This is similar to the way that
users of Heroku deploy all of their development, staging, and production code into Heroku's production system.</p>
<h2 id="decision">Decision</h2>
<p>The decision we have landed on is a blend between options 2 and 3. We will have a Concourse deployment in each
environment, with a central Concourse deployment in a "tools" account or similar. The central Concourse will not
have permission to reach into other accounts.</p>
<!-- raw HTML omitted -->
<p>The Concourse deployment in each environment will, as in option 3, be responsible for deployments to the environment
that it lives in.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>The central "tools" Concourse deployment however has a different purpose.</p>
<h3 id="the-role-of-a-central-concourse">The role of a central Concourse</h3>
<p>During the team's discussions, we noted that under option 3 we would need to rebuild any artifacts at the beginning of
each run. Conceptually this should be OK because the artifacts we build are reproducible, and running the build
twice should always result in the same output. However, we noted that we have seen that this is not the case in
practice on a number of occasions, across a number of applications in recent memory.</p>
<p>We believe the cause was Ruby On Rails' asset pre-compilation being flaky. We have observed that in most cases the
built container image correctly includes assets, but in a few unpredictable cases the process that generates them fails,
but the build continues. Therefore, increasing the number of builds taking place during a deployment will increase the
number of instances of bad artifact builds.</p>
<p>As a team we briefly considered bringing the failures up with the relevant team and working with them to fix it. However,
we realised that every team that uses Ruby On Rails can experience the problem, because the issue is with Rails' asset
pre-compilation.</p>
<p>We instead settled on the fact that we must build the artifacts a single time at the beginning of a deployment, verify
them, and reuse them across environments. This is the same behaviour as in our existing system, where we build the
artifacts in GitHub Actions.</p>
<p>We decided we did not want to continue with GitHub Actions building our artifacts because we find it to be too slow and
unreliable for that purpose. We instead decided to introduce a central Concourse deployment, on which the artifact
builds could take place.</p>
<p>Introducing a central Concourse deployment for this purpose has a couple of useful benefits.</p>
<ol>
<li>We can have dedicated machines for fast artifact builds</li>
<li>It provides us a convenient place to run the kinds of jobs that do not relate to a specific environment.</li>
</ol>
<h3 id="versioning-infrastructure-manifests">Versioning infrastructure manifests</h3>
<p>A secondary decision that we made during the team discussions on October 15th 2025 was to begin versioning the manifest
files for application infrastructure, just as we do for application source code.</p>
<p>Currently, we use a Git repository called <code>govuk-helm-charts</code>. It holds our central <code>generic-govuk-app</code> Helm chart
code, and the values for all the applications that make use of it. When a new version of an application container
needs deploying, the process updates the repository to set the value in a file. ArgoCD subsequently detects the change,
renders the manifests, and synchronises the cluster with them. As a result of this, the repository has 190,000+ commits
at the time of writing.</p>
<p>In each environment, our pipelines will render manifest files in each application repository by using whatever technology
we select for YAML generation. We will store the rendered manifest files in a Git repository, which ArgoCD will
synchronise from.</p>
<h3 id="path-to-production">Path to production</h3>
<p>The decisions we have made about how we architect Concourse have a direct impact on how application code reaches
production. We expect that the process now looks like</p>
<ol>
<li>Merge to <code>main</code>
</li>
<li>Build container, tag with Git SHA, push to registry</li>
<li>Detect container tag in pipeline</li>
<li>Fetch source from Git at same SHA as container</li>
<li>Render manifests</li>
<li>Store in Git</li>
<li>Trigger ArgoCD synchronisation</li>
<li>Wait for deploy success/fail</li>
<li>If success, re-tag container image to indicate successful deployment</li>
<li>Go to 3 if there is a higher environment</li>
</ol>
<pre lang="mermaid"><code>flowchart TD
    subgraph Git
        merge["Merge to main"]
    end

    subgraph Central Concourse
        central_build["Build container"]
        central_push["Push to registry"]
        merge --&gt; central_build
        central_build --&gt; central_push
    end


subgraph Environment
central_push --&gt; 
        env_detect["Detect container tag"] --&gt;
env_fetch["Fetch source from Git with same SHA"] --&gt;
env_render["Render manifests"] --&gt;
env_store["Store in Git"] --&gt;
env_wait["Trigger ArgoCD synchronisation"] --&gt;
env_success{"Deployment success?"}
env_retag_image{"Retag container image"}
env_higher_env{"Higher environment?"}

env_success -- No --&gt; env_fail(("Fail"))
env_success -- Yes --&gt; env_retag_image

env_retag_image --&gt; env_higher_env
env_higher_env -- No --&gt; Stop(("Stop"))
env_higher_env -- Yes --&gt; env_detect
end
</code></pre>
<h2 id="consequences">Consequences</h2>
<h3 id="time-and-energy">Time and energy</h3>
<!-- raw HTML omitted -->
<p>To implement the decisions we have made we expect will require a large investment of time and energy, over the course of
at least a year. During that time we expect to have different applications reaching production in different ways, and
there to be some amount of confusion over which application is using which process. We accept this as a cost of doing
the rework.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Because of the long timeline, there is also a risk we will need to shelve the work part way through in favour of a
more urgent piece of work.</p>
<h3 id="technical-debt">Technical debt</h3>
<p>Whilst we rework our CI/CD infrastructure, we know that we will have to make compromises and have messy code in
different parts of the system. This will inevitably pile up as technical debt. We will do our best to prevent this and
pay down debt as we go, but there is very likely to be some left over when we finish.</p>
<h3 id="cost">Cost</h3>
<p>There will be a minor rise in the cost of running each environment, and an additional cost for the new "tools" account.
In each environment we expect to run at least one new node in Kubernetes for Concourse, plus its database. In the new
account the costs will include a new Elastic Kubernetes Service cluster control plane on top of the nodes and database.</p>
<h3 id="better-security-posture">Better security posture</h3>
<p>We believe that the choices we have made regarding CI/CD architecture addresses the most critical of the findings of the
2024 ITHC. Addressing these findings leaves us with a much better security posture, and good base on which to layer
additional security controls at a later date.</p>

  <script>
    /*
      Manually trigger the styling of the 'current page' in the sidebar,
      as it does not happen automatically because we are still technically
      in single page mode.
    */
    (function () {
        'use strict'
        /*
          Cannot use `$(document).ready` on next line as jQuery has not loaded
          yet. But we can use jQuery in the callback.
        */
        window.addEventListener('load', function () {
            try {
                new GOVUK.Modules.InPageNavigation().start($("html"));
            }
            catch (error) {
                /* Fail without causing other JS in the page to break */
                console.log("Error calling GOVUK's InPageNavigation module", error);
            }
        })
    }());
</script>


            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-infrastructure/blob/main/docs/architecture/decisions/0019-restructure-cicd.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?body=Problem+with+%27%27+%28https%3A%2F%2Fdocs.publishing.service.gov.uk%2Frepos%2Fgovuk-infrastructure%2Farchitecture%2Fdecisions%2F0019-restructure-cicd.html%29&amp;labels=bug&amp;title=Re%3A+%27%27">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <svg focusable="false" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 60" height="30" width="32" fill="currentcolor" class="govuk-footer__crown">
    <g>
      <circle cx="20" cy="17.6" r="3.7"></circle>
      <circle cx="10.2" cy="23.5" r="3.7"></circle>
      <circle cx="3.7" cy="33.2" r="3.7"></circle>
      <circle cx="31.7" cy="30.6" r="3.7"></circle>
      <circle cx="43.3" cy="17.6" r="3.7"></circle>
      <circle cx="53.2" cy="23.5" r="3.7"></circle>
      <circle cx="59.7" cy="33.2" r="3.7"></circle>
      <circle cx="31.7" cy="30.6" r="3.7"></circle>
      <path d="M33.1,9.8c.2-.1.3-.3.5-.5l4.6,2.4v-6.8l-4.6,1.5c-.1-.2-.3-.3-.5-.5l1.9-5.9h-6.7l1.9,5.9c-.2.1-.3.3-.5.5l-4.6-1.5v6.8l4.6-2.4c.1.2.3.3.5.5l-2.6,8c-.9,2.8,1.2,5.7,4.1,5.7h0c3,0,5.1-2.9,4.1-5.7l-2.6-8ZM37,37.9s-3.4,3.8-4.1,6.1c2.2,0,4.2-.5,6.4-2.8l-.7,8.5c-2-2.8-4.4-4.1-5.7-3.8.1,3.1.5,6.7,5.8,7.2,3.7.3,6.7-1.5,7-3.8.4-2.6-2-4.3-3.7-1.6-1.4-4.5,2.4-6.1,4.9-3.2-1.9-4.5-1.8-7.7,2.4-10.9,3,4,2.6,7.3-1.2,11.1,2.4-1.3,6.2,0,4,4.6-1.2-2.8-3.7-2.2-4.2.2-.3,1.7.7,3.7,3,4.2,1.9.3,4.7-.9,7-5.9-1.3,0-2.4.7-3.9,1.7l2.4-8c.6,2.3,1.4,3.7,2.2,4.5.6-1.6.5-2.8,0-5.3l5,1.8c-2.6,3.6-5.2,8.7-7.3,17.5-7.4-1.1-15.7-1.7-24.5-1.7h0c-8.8,0-17.1.6-24.5,1.7-2.1-8.9-4.7-13.9-7.3-17.5l5-1.8c-.5,2.5-.6,3.7,0,5.3.8-.8,1.6-2.3,2.2-4.5l2.4,8c-1.5-1-2.6-1.7-3.9-1.7,2.3,5,5.2,6.2,7,5.9,2.3-.4,3.3-2.4,3-4.2-.5-2.4-3-3.1-4.2-.2-2.2-4.6,1.6-6,4-4.6-3.7-3.7-4.2-7.1-1.2-11.1,4.2,3.2,4.3,6.4,2.4,10.9,2.5-2.8,6.3-1.3,4.9,3.2-1.8-2.7-4.1-1-3.7,1.6.3,2.3,3.3,4.1,7,3.8,5.4-.5,5.7-4.2,5.8-7.2-1.3-.2-3.7,1-5.7,3.8l-.7-8.5c2.2,2.3,4.2,2.7,6.4,2.8-.7-2.3-4.1-6.1-4.1-6.1h10.6,0Z"></path>
    </g>
  </svg>
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Accessibility</a>
            </li>
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/cookies.html">Cookies</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/govuk_frontend.js" type="module"></script>
    <script src="/javascripts/application.js"></script>
  </body>
</html>
