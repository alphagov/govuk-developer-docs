

<!doctype html>
<html lang="en" class="govuk-template govuk-template--rebranded no-js">
  <head>
    
    

    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>whitehall: assets - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/repos/whitehall/assets.html">
      <link rel="icon" sizes="48x48" href="/assets/govuk/assets/rebrand/images/favicon.ico">
      <link rel="icon" sizes="any" href="/assets/govuk/assets/rebrand/images/favicon.svg" type="image/svg+xml">
      <link rel="mask-icon" href="/assets/govuk/assets/rebrand/images/govuk-icon-mask.svg" color="#0b0c0c">
      <link rel="apple-touch-icon" href="/assets/govuk/assets/rebrand/images/govuk-icon-180.png">
      <link rel="manifest" href="/assets/govuk/assets/rebrand/manifest.json">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.publishing.service.gov.uk/assets/govuk/assets/rebrand/images/govuk-opengraph-image.png" />
      <meta name="twitter:title" content="whitehall: assets - GOV.UK Developer Documentation" />
      <meta name="twitter:url" content="https://docs.publishing.service.gov.uk/repos/whitehall/assets.html" />

      <meta property="og:image" content="https://docs.publishing.service.gov.uk/assets/govuk/assets/rebrand/images/govuk-opengraph-image.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="whitehall: assets" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/repos/whitehall/assets.html" />

      <script>
  document.addEventListener('DOMContentLoaded', function () {
    var markup = `<div id="global-cookie-message" data-module="cookie-banner" data-nosnippet="" aria-label="Can we store analytics cookies on your device?" class="gem-c-cookie-banner govuk-clearfix govuk-cookie-banner js-banner-wrapper" role="region" hidden="hidden" title="Can we store analytics cookies on your device?"> <div class="govuk-cookie-banner__message govuk-width-container"> <div class="govuk-grid-row"> <div class="govuk-grid-column-two-thirds"> <h2 class="govuk-cookie-banner__heading govuk-heading-m">Can we store analytics cookies on your device?</h2> <div tabindex="-1" class="govuk-cookie-banner__content gem-c-cookie-banner__confirmation"> <div class="gem-c-cookie-banner__content"><p class='govuk-body'>We’d like to set some cookies to understand how you use this site and remember your settings.</p><p class='govuk-body'>We also use cookies set by other sites to help us deliver content from their services.</p></div> <p class="gem-c-cookie-banner__confirmation-message--accepted govuk-body" hidden data-ga4-cookie-banner data-module="ga4-link-tracker" data-ga4-track-links-only data-ga4-set-indexes data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;cookie banner&quot;,&quot;section&quot;:&quot;You have accepted additional cookies&quot;}" >You have accepted additional cookies. <span class="gem-c-cookie-banner__confirmation-message">You can <a class="govuk-link" href="/cookies.html">change your cookie settings</a> at any time.</span></p> <p class="gem-c-cookie-banner__confirmation-message--rejected govuk-body" hidden>You have rejected additional cookies. <span class="gem-c-cookie-banner__confirmation-message">You can <a class="govuk-link" href="/cookies.html">change your cookie settings</a> at any time.</span></p> </div> </div> </div> <div class="js-confirmation-buttons govuk-button-group"> <button class="gem-c-button govuk-button" type="submit" data-accept-cookies="true" data-cookie-types="all">Accept additional cookies</button> <button class="gem-c-button govuk-button" type="submit" data-reject-cookies="true">Reject additional cookies</button> <a class="govuk-link" href="/cookies.html">View cookies</a> </div> <div hidden class="js-hide-button govuk-button-group"> <button class="gem-c-cookie-banner__hide-button govuk-button" data-hide-cookie-banner="true" data-module="ga4-event-tracker" data-ga4-event="{&quot;event_name&quot;:&quot;select_content&quot;,&quot;type&quot;:&quot;cookie banner&quot;,&quot;action&quot;:&quot;closed&quot;,&quot;section&quot;:&quot;You have accepted additional cookies&quot;}" > Hide cookie message </button> </div> </div> </div>`;
    var banner = document.createElement('div');
    banner.innerHTML = markup;
    document.body.prepend(banner);
  })
</script>


  </head>

  <body class="govuk-template__body">
    <script>document.body.className += ' js-enabled' + ('noModule' in HTMLScriptElement.prototype ? ' govuk-frontend-supported' : '');</script>

    <div class="app-pane">
      
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <svg
          focusable="false"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 324 60"
          height="30"
          width="162"
          fill="currentcolor"
          class="govuk-header__logotype"
          aria-label="GOV.UK">
          <title>GOV.UK</title>
          <g>
            <circle cx="20" cy="17.6" r="3.7"></circle>
            <circle cx="10.2" cy="23.5" r="3.7"></circle>
            <circle cx="3.7" cy="33.2" r="3.7"></circle>
            <circle cx="31.7" cy="30.6" r="3.7"></circle>
            <circle cx="43.3" cy="17.6" r="3.7"></circle>
            <circle cx="53.2" cy="23.5" r="3.7"></circle>
            <circle cx="59.7" cy="33.2" r="3.7"></circle>
            <circle cx="31.7" cy="30.6" r="3.7"></circle>
            <path d="M33.1,9.8c.2-.1.3-.3.5-.5l4.6,2.4v-6.8l-4.6,1.5c-.1-.2-.3-.3-.5-.5l1.9-5.9h-6.7l1.9,5.9c-.2.1-.3.3-.5.5l-4.6-1.5v6.8l4.6-2.4c.1.2.3.3.5.5l-2.6,8c-.9,2.8,1.2,5.7,4.1,5.7h0c3,0,5.1-2.9,4.1-5.7l-2.6-8ZM37,37.9s-3.4,3.8-4.1,6.1c2.2,0,4.2-.5,6.4-2.8l-.7,8.5c-2-2.8-4.4-4.1-5.7-3.8.1,3.1.5,6.7,5.8,7.2,3.7.3,6.7-1.5,7-3.8.4-2.6-2-4.3-3.7-1.6-1.4-4.5,2.4-6.1,4.9-3.2-1.9-4.5-1.8-7.7,2.4-10.9,3,4,2.6,7.3-1.2,11.1,2.4-1.3,6.2,0,4,4.6-1.2-2.8-3.7-2.2-4.2.2-.3,1.7.7,3.7,3,4.2,1.9.3,4.7-.9,7-5.9-1.3,0-2.4.7-3.9,1.7l2.4-8c.6,2.3,1.4,3.7,2.2,4.5.6-1.6.5-2.8,0-5.3l5,1.8c-2.6,3.6-5.2,8.7-7.3,17.5-7.4-1.1-15.7-1.7-24.5-1.7h0c-8.8,0-17.1.6-24.5,1.7-2.1-8.9-4.7-13.9-7.3-17.5l5-1.8c-.5,2.5-.6,3.7,0,5.3.8-.8,1.6-2.3,2.2-4.5l2.4,8c-1.5-1-2.6-1.7-3.9-1.7,2.3,5,5.2,6.2,7,5.9,2.3-.4,3.3-2.4,3-4.2-.5-2.4-3-3.1-4.2-.2-2.2-4.6,1.6-6,4-4.6-3.7-3.7-4.2-7.1-1.2-11.1,4.2,3.2,4.3,6.4,2.4,10.9,2.5-2.8,6.3-1.3,4.9,3.2-1.8-2.7-4.1-1-3.7,1.6.3,2.3,3.3,4.1,7,3.8,5.4-.5,5.7-4.2,5.8-7.2-1.3-.2-3.7,1-5.7,3.8l-.7-8.5c2.2,2.3,4.2,2.7,6.4,2.8-.7-2.3-4.1-6.1-4.1-6.1h10.6,0Z"></path>
          </g>
          <circle class="govuk-logo-dot" cx="226" cy="36" r="7.3"/>
          <path d="M93.94 41.25c.4 1.81 1.2 3.21 2.21 4.62 1 1.4 2.21 2.41 3.61 3.21s3.21 1.2 5.22 1.2 3.61-.4 4.82-1c1.4-.6 2.41-1.4 3.21-2.41.8-1 1.4-2.01 1.61-3.01s.4-2.01.4-3.01v.14h-10.86v-7.02h20.07v24.08h-8.03v-5.56c-.6.8-1.38 1.61-2.19 2.41-.8.8-1.81 1.2-2.81 1.81-1 .4-2.21.8-3.41 1.2s-2.41.4-3.81.4a18.56 18.56 0 0 1-14.65-6.63c-1.6-2.01-3.01-4.41-3.81-7.02s-1.4-5.62-1.4-8.83.4-6.02 1.4-8.83a20.45 20.45 0 0 1 19.46-13.65c3.21 0 4.01.2 5.82.8 1.81.4 3.61 1.2 5.02 2.01 1.61.8 2.81 2.01 4.01 3.21s2.21 2.61 2.81 4.21l-7.63 4.41c-.4-1-1-1.81-1.61-2.61-.6-.8-1.4-1.4-2.21-2.01-.8-.6-1.81-1-2.81-1.4-1-.4-2.21-.4-3.61-.4-2.01 0-3.81.4-5.22 1.2-1.4.8-2.61 1.81-3.61 3.21s-1.61 2.81-2.21 4.62c-.4 1.81-.6 3.71-.6 5.42s.8 5.22.8 5.22Zm57.8-27.9c3.21 0 6.22.6 8.63 1.81 2.41 1.2 4.82 2.81 6.62 4.82S170.2 24.39 171 27s1.4 5.62 1.4 8.83-.4 6.02-1.4 8.83-2.41 5.02-4.01 7.02-4.01 3.61-6.62 4.82-5.42 1.81-8.63 1.81-6.22-.6-8.63-1.81-4.82-2.81-6.42-4.82-3.21-4.41-4.01-7.02-1.4-5.62-1.4-8.83.4-6.02 1.4-8.83 2.41-5.02 4.01-7.02 4.01-3.61 6.42-4.82 5.42-1.81 8.63-1.81Zm0 36.73c1.81 0 3.61-.4 5.02-1s2.61-1.81 3.61-3.01 1.81-2.81 2.21-4.41c.4-1.81.8-3.61.8-5.62 0-2.21-.2-4.21-.8-6.02s-1.2-3.21-2.21-4.62c-1-1.2-2.21-2.21-3.61-3.01s-3.21-1-5.02-1-3.61.4-5.02 1c-1.4.8-2.61 1.81-3.61 3.01s-1.81 2.81-2.21 4.62c-.4 1.81-.8 3.61-.8 5.62 0 2.41.2 4.21.8 6.02.4 1.81 1.2 3.21 2.21 4.41s2.21 2.21 3.61 3.01c1.4.8 3.21 1 5.02 1Zm36.32 7.96-12.24-44.15h9.83l8.43 32.77h.4l8.23-32.77h9.83L200.3 58.04h-12.24Zm74.14-7.96c2.18 0 3.51-.6 3.51-.6 1.2-.6 2.01-1 2.81-1.81s1.4-1.81 1.81-2.81a13 13 0 0 0 .8-4.01V13.9h8.63v28.15c0 2.41-.4 4.62-1.4 6.62-.8 2.01-2.21 3.61-3.61 5.02s-3.41 2.41-5.62 3.21-4.62 1.2-7.02 1.2-5.02-.4-7.02-1.2c-2.21-.8-4.01-1.81-5.62-3.21s-2.81-3.01-3.61-5.02-1.4-4.21-1.4-6.62V13.9h8.63v26.95c0 1.61.2 3.01.8 4.01.4 1.2 1.2 2.21 2.01 2.81.8.8 1.81 1.4 2.81 1.81 0 0 1.34.6 3.51.6Zm34.22-36.18v18.92l15.65-18.92h10.82l-15.03 17.32 16.03 26.83h-10.21l-11.44-20.21-5.62 6.22v13.99h-8.83V13.9"/>
        </svg>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" hidden>Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/kubernetes/">Kubernetes</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/apps.html" aria-current="page">Apps</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/repos.html">Repos</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/mobile/">Mobile</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1">
              <div class="search" data-module="search" data-path-to-site-root="/">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input
      type="search"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <ul>
    <li>
      <a href="/repos/whitehall.html" rel="noopener" class="govuk-link">whitehall</a>
    </li>
    <li>
      <ul>
            <li><a href="/repos/whitehall/access_controls.html" rel="noopener" class="govuk-link">Access controls for editions</a></li>
    <li><a href="/repos/whitehall/analytics.html" rel="noopener" class="govuk-link">Analytics</a></li>
    <li><a href="/repos/whitehall/assets.html" rel="noopener" class="govuk-link">assets</a></li>
    <li><a href="/repos/whitehall/auditing.html" rel="noopener" class="govuk-link">Whitehall Content Audit Trail</a></li>
    <li><a href="/repos/whitehall/browser_support.html" rel="noopener" class="govuk-link">Whitehall browser support</a></li>
    <li><a href="/repos/whitehall/configurable_document_types.html" rel="noopener" class="govuk-link">Configurable Document Types</a></li>
    <li><a href="/repos/whitehall/contacts_expansion.html" rel="noopener" class="govuk-link">How does Whitehall handle contact expansion in govspeak?</a></li>
    <li><a href="/repos/whitehall/css.html" rel="noopener" class="govuk-link">Whitehall CSS Styleguide</a></li>
    <li><a href="/repos/whitehall/edition_model.html" rel="noopener" class="govuk-link">Edition Model</a></li>
    <li><a href="/repos/whitehall/edition_workflow.html" rel="noopener" class="govuk-link">Edition Workflow</a></li>
    <li><a href="/repos/whitehall/email_delivery.html" rel="noopener" class="govuk-link">Email delivery</a></li>
    <li><a href="/repos/whitehall/feature_flags.html" rel="noopener" class="govuk-link">Feature Flags</a></li>
    <li><a href="/repos/whitehall/history_mode.html" rel="noopener" class="govuk-link">History Mode</a></li>
    <li><a href="/repos/whitehall/internationalisation_guide.html" rel="noopener" class="govuk-link">Internationalisation guide</a></li>
    <li><a href="/repos/whitehall/javascript.html" rel="noopener" class="govuk-link">Whitehall JavaScript</a></li>
    <li><a href="/repos/whitehall/link_checker_api_integration.html" rel="noopener" class="govuk-link">Link Checker API Integrations</a></li>
    <li><a href="/repos/whitehall/migrating_to_standard_edition.html" rel="noopener" class="govuk-link">Migrating to StandardEdition</a></li>
    <li><a href="/repos/whitehall/pushing_content_to_publishing_api.html" rel="noopener" class="govuk-link">Pushing content to Publishing API</a></li>
    <li><a href="/repos/whitehall/remove_access_limited.html" rel="noopener" class="govuk-link">Access limited</a></li>
    <li><a href="/repos/whitehall/search_indexing.html" rel="noopener" class="govuk-link">Search Indexing</a></li>
    <li><a href="/repos/whitehall/timestamps.html" rel="noopener" class="govuk-link">Timestamps</a></li>
    <li><a href="/repos/whitehall/tips_for_local_development.html" rel="noopener" class="govuk-link">Tips for working on Whitehall locally</a></li>
    <li><a href="/repos/whitehall/troubleshooting.html" rel="noopener" class="govuk-link">Whitehall troubleshooting</a></li>
    <li><a href="/repos/whitehall/view_components.html" rel="noopener" class="govuk-link">View Components</a></li>
    <li class="subdir__heading">adr</li>
    <ul class="subdir__menu">
          <li><a href="/repos/whitehall/adr/0001-add-view-components.html" rel="noopener" class="govuk-link">1. Add View Components</a></li>
    <li><a href="/repos/whitehall/adr/0002-new-asset-model.html" rel="noopener" class="govuk-link">2. New Asset Model</a></li>
    <li><a href="/repos/whitehall/adr/0003-worldwide-organisation-multi-part-content.html" rel="noopener" class="govuk-link">3. Using multi-part content for Worldwide Organisations</a></li>
    <li><a href="/repos/whitehall/adr/0004-content-object-store-added-with-a-rails-engine.html" rel="noopener" class="govuk-link">4. content-object-store-added-with-a-rails-engine</a></li>
    <li><a href="/repos/whitehall/adr/0005-use-json-schema-for-flexible-page-schemas.html" rel="noopener" class="govuk-link">5. Use JSON Schema for configurable document schemas</a></li>
    <li><a href="/repos/whitehall/adr/0006-config-driven-content-types.html" rel="noopener" class="govuk-link">6. Config driven content types</a></li>
    <li><a href="/repos/whitehall/adr/0007-use-rails-validation-for-configurable-documents.html" rel="noopener" class="govuk-link">7. Use Rails validation for configurable documents</a></li>
    <li><a href="/repos/whitehall/adr/0008-drop-json-schema-for-document-configuration.html" rel="noopener" class="govuk-link">8. Drop JSON schema for specifying document properties in favour of our own custom schema definition</a></li>
    <li><a href="/repos/whitehall/adr/0009-configurable-document-forms-and-presenters.html" rel="noopener" class="govuk-link">9. Separate configurable document forms and presenters from attribute schema</a></li>

    </ul>
    <li class="subdir__heading">diagrams</li>
    <ul class="subdir__menu">
          <li><a href="/repos/whitehall/diagrams/README.html" rel="noopener" class="govuk-link">PlantUML Diagrams</a></li>

    </ul>
    <li class="subdir__heading">misc</li>
    <ul class="subdir__menu">
          <li><a href="/repos/whitehall/misc/guidelines-for-translators.html" rel="noopener" class="govuk-link">guidelines-for-translators</a></li>

    </ul>

      </ul>
    </li>
  </ul>

              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled" aria-label="Content">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              
<script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "name": "Home",
        "@id": "http://www.dev.gov.uk/"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "name": "Apps",
        "@id": "http://www.dev.gov.uk/apps.html"
      }
    },
    {
      "@type": "ListItem",
      "position": 3,
      "item": {
        "name": "whitehall",
        "@id": "http://www.dev.gov.uk/repos/whitehall.html"
      }
    }
  ]
}
</script>

<nav data-module="ga4-link-tracker" aria-label="Breadcrumb" class="gem-c-breadcrumbs govuk-breadcrumbs">
  <ol class="govuk-breadcrumbs__list">
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;1&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/">Home</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;2&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/apps.html">Apps</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;3&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/repos/whitehall.html">whitehall</a>
        </li>
  </ol>
</nav>
  <div class="govuk-!-font-size-16 govuk-!-margin-top-6">
    <div class="govuk-warning-text">
      <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
      <strong class="govuk-warning-text__text">
        <span class="govuk-warning-text__assistive">Warning</span>
        This document has not been updated for a while now. It may be out of date.
      </strong>
    </div>

  Last updated: <a href="https://github.com/alphagov/whitehall/commit/61e18f9b45ce56e26351efe2ce1bf29390220f17">4 Apr 2025</a>
</div>

  <h1 class="page-title">whitehall: assets</h1>

  
<p><em>Assets, Attachments, Images, Logos, Featured Image, Lead Image, Response Form</em></p>
<h1 id="what-it-is">What it is</h1>
<p>There are several document types in Whitehall that utilize Images or
File Attachments.</p>
<p>For example, <strong>News Articles</strong> can have a list of attachments that
provide further information about the news, and a <strong>Person</strong> can have a picture
which is shown on the person's page and on any <strong>Speech</strong> page of that person.</p>
<h1 id="how-it-used-to-work">How it used to work</h1>
<p>Historically, Whitehall had all file uploads stored within the Whitehall service.
Carrierwave was used to manage the http-requests and related file storage within
Whitehall.</p>
<p>Later on, a separate service - Asset Manager - became the store for file uploads, taking ownership of every file uploaded.
Carrierwave was still used to mange the http-request in Whitehall and a good amount of configuration was
written for carrierwave in order to make Asset Manager behave as if it was just a file storage.
These configurations rippled throughout the Whitehall codebase, made Whitehall a special case in
Asset Manager, locking asset manager design and increasing the overhead of understanding Whitehall.</p>
<p>An associated concept, "legacy url path", heavily blocked any refactoring attempts. "Legacy url path" was the medium
through which Whitehall defined what the url of an asset should be, even though Asset Manager would actually own the asset.
The "legacy url path" was used as a <em>de facto</em> id, based on Whitehall internal class names and their ids. Unlike Whitehall,
other publishing applications would let Asset Manager define asset-manager-ID-based urls for assets.</p>
<p>The "legacy url path" was eventually removed and asset references in Whitehall became simple rows in the database,
just like with all the other publishing applications. In order to store the data required to talk to Asset Manager,
a new Asset model was proposed. Find the related ADR for the asset model <a href="https://github.com/alphagov/whitehall/blob/main/docs/adr/0002-new-asset-model.md">here</a>.</p>
<h1 id="technical-design">Technical Design</h1>
<h3 id="relationship-between-documents-and-asset-models">Relationship between documents and Asset models</h3>
<p><img src="https://raw.githubusercontent.com/alphagov/whitehall/main/docs/diagrams/asset_models.png" alt="Model diagram"></p>
<h3 id="how-attachments-and-images-are-provided-for-the-user">How attachments and images are provided for the user</h3>
<p><img src="https://raw.githubusercontent.com/alphagov/whitehall/main/docs/diagrams/asset_usage.png" alt="Asset Usage"></p>
<h3 id="file-attachments-change-flows">File attachments change flows</h3>
<h4 id="file-attachment-uploads">File attachment uploads</h4>
<p><em>Editionable Content</em> types such as <strong>News Articles</strong> and <strong>Consultations</strong>, as well as <strong>Policy Groups</strong>, can have attachments.
Uploads and republishing actions are managed asynchronously in the background by a Sidekiq job. Note that the diagram below will look slightly different for non-editionable attachables (Worldwide Organisation Pages, Consultation and Call for Evidence Responses, and Policy Groups) depending on their publishing mechanism.</p>
<p><img src="https://raw.githubusercontent.com/alphagov/whitehall/main/docs/diagrams/asset_attachment_upload_flow.png" alt="Attachment Upload Flow"></p>
<hr>
<h4 id="file-attachment-replacements">File attachment replacements</h4>
<p>Asset Manager supports "replacing" existing assets with a new one. Replacement is essentially a special type of redirect for asset-to-asset redirects (as opposed to the general redirect URL attribute supported by Asset Manager, which redirects assets to non-asset URLs). Replacement is necessary to ensure that bookmarks and links to existing attachment assets still work even if the binary asset file has changed.</p>
<p>When a new asset is uploaded as a replacement for the previous one, the flow is identical to the upload flow, but the <code>AssetManagerAttachmentMetadataWorker</code> also sends a request to Asset Manager to mark the previous asset as replaced based off the handling of replaced_by id when saving <code>AttachmentData</code>. Note that the replacement does not take effect until the new asset is no longer flagged as a draft. This occurs when the edition is published.</p>
<p><img src="https://raw.githubusercontent.com/alphagov/whitehall/main/docs/diagrams/asset_attachment_replacement_flow.png" alt="Attachment Replacement Flow"></p>
<hr>
<h4 id="file-attachment-deletions">File attachment deletions</h4>
<p>Attachment deletions set <code>deleted</code> on the database column for <code>Attachment</code>. <code>AttachmentData</code> derives its deletion state from its attachments as annotated in the diagram.
Note that the deletion does not take effect or go to AssetManager until the edition is published (See edition publishing flow below)</p>
<p><img src="https://raw.githubusercontent.com/alphagov/whitehall/main/docs/diagrams/asset_attachment_deletion_flow.png" alt="Attachment Deletion Flow"></p>
<hr>
<h3 id="edition-with-file-attachment-change-flows">Edition with file attachment change flows</h3>
<h4 id="file-attachments-edition-publishing-flow">File attachments edition publishing flow</h4>
<p>Changes to assets are not applied to Asset Manager until an edition is published, because the previous edition may have attachments that still refer to those assets. Consequently, and somewhat surprisingly, we delete assets associated with deleted attachments at the time of publishing. We also set the draft flag to <code>false</code> for all assets associated with the attachment. That includes setting the draft flag to <code>false</code> for deleted assets because, if the deleted draft asset was a replacement for a previous attachment asset, the replacement will not be applied until the draft flag is set to <code>false</code>.</p>
<p>During publishing, we only publish the asset in AssetManager (updating draft flag) if the attachment has just been created in the edition to be published. No further updates needs to be made to the asset on subsequent publishings.</p>
<p>These actions are performed asynchronously as a Sidekiq job, because some editions have large numbers of attachments which would make sending these requests synchronously unacceptably slow for publishers. Sidekiq also supports automatically retrying any requests that fail, which helps the system to be more robust.</p>
<p><img src="https://raw.githubusercontent.com/alphagov/whitehall/main/docs/diagrams/asset_attachment_edition_publishing_flow.png" alt="Attachment Edition Publishing Flow for Editionable Attachables"></p>
<hr>
<h4 id="file-attachments-edition-unpublishing-flow">File attachments edition unpublishing flow</h4>
<p>Attachments are updated and redirected via EditionServices subscribers on the <code>unpublish</code> event. AttachmentData is updated in AssetManager and RedirectURL is set.</p>
<p><img src="https://raw.githubusercontent.com/alphagov/whitehall/main/docs/diagrams/asset_attachment_edition_unpublishing_flow.png" alt="Attachment Edition Unpublishing Flow for Editionable Attachables"></p>
<hr>
<h4 id="file-attachments-edition-deletion-flow">File attachments edition deletion flow</h4>
<p>Asset is deleted when an Edition is being deleted which results in the AttachmentData no longer being associated with any publicly visible attachables.</p>
<p><img src="https://raw.githubusercontent.com/alphagov/whitehall/main/docs/diagrams/asset_attachment_edition_deletion_flow.png" alt="Attachment Edition Deletion Flow for Editionable Attachables"></p>
<hr>
<h3 id="images-upload-flow">Images upload flow</h3>
<p><em>Editionable Content</em> types such as <strong>News Articles</strong> and <strong>Consultations</strong> can have images that are used within the document.
Images can have various sizes (versions) which are uploaded asynchronously by a background job.</p>
<p><img src="https://raw.githubusercontent.com/alphagov/whitehall/main/docs/diagrams/asset_image_upload_flow.png" alt="Image Upload Flow"></p>
<h3 id="featured-image-upload-flow">Featured Image upload flow</h3>
<p><em>Immediately published content</em> types such as <strong>Person</strong>, <strong>Organisation</strong> or <strong>Topical Event</strong> can have an associated image.
For example, a <strong>Person</strong> has an image which is displayed both on the person's page, and the pages of its associated speeches.
When a new <strong>Person</strong> image finishes uploading, both the Person and related Speeches pages need to be republished.</p>
<p><img src="https://raw.githubusercontent.com/alphagov/whitehall/main/docs/diagrams/asset_featured_image_upload_flow.png" alt="Featured Image Upload Flow"></p>
<hr>
<h1 id="cross-functional-requirements-for-file-attachments">Cross functional requirements for File Attachments</h1>
<p><em>FileAttachments are considered to be important data for the document quality. They can contain detailed
information which is crucial for the containing document.</em></p>
<p><strong>Correctness</strong> over <strong>Maintainability</strong></p>
<blockquote>
<p>An attachment can be configured to redirect the user to a newer version of the attachment.
This helps ensure that anyone who follows an outdated url will be given the correct up-to-date
information. This comes at the cost of complexity in maintaining redirect-urls for attachments.</p>
</blockquote>
<p><strong>Obtainability</strong> over <strong>code simplicity</strong></p>
<blockquote>
<p>An attachment can be replaced by another attachment. These replacements are tracked in the system
so that the user can always be provided with an up-to-date version of the data.</p>
</blockquote>
<p><strong>Recoverability</strong> over <strong>code simplicity</strong></p>
<blockquote>
<p>Attachments are always soft-deleted. This makes it possible to recover the attachments both in Whitehall and
Asset Manager when needed. The cost of soft-deletion is code that is harder to maintain and understand.</p>
</blockquote>
<h1 id="cross-functional-requirements-for-images">Cross functional requirements for Images</h1>
<p><em>Images are considered mainly decorative and visually supportive items
for a document. They should not contain any crucial information required
in order for the document to be understood.</em></p>
<p><strong>Accessibility</strong></p>
<blockquote>
<p>People who use screen readers should be able to gain just as much information
of the document at hand - whether they can see the image or not. Alt texts are always available
to provide descriptive information of an image.</p>
</blockquote>
<p><strong>Code simplicity</strong> over <strong>Recoverability</strong></p>
<blockquote>
<p>Images are not considered crucial information. They are generally hard-deleted from Whitehall database in favor of
having simple and readable code.</p>
</blockquote>
<p><strong>User experience</strong> over <strong>Maintainability</strong></p>
<blockquote>
<p>Different devices require different image sizes in order for the ui to look good.
These image variants need to be created and the code for it needs support and maintenance.</p>
</blockquote>
<h1 id="common-cross-functional-requirements">Common cross functional requirements</h1>
<p><strong>Security and Safety</strong> over <strong>ease of support</strong></p>
<blockquote>
<p>All attachments and images are scanned for potential malware in Asset Manager. This
is done to ensure the safety of the users of gov.uk. The cost of this is that sometimes
2nd line support people have to fix attachments that have false positives from the
virus scanner.</p>
</blockquote>
<p><strong>User experience</strong> over <strong>code simplicity</strong></p>
<blockquote>
<p>File uploads are managed internally with asynchronous background jobs. This helps the publisher-user
have a fast user experience when uploading files. However, it comes at the cost of complicated code flows
that manage the successes and failures of the file uploads.</p>
</blockquote>
<h1 id="business-requirements">Business Requirements</h1>
<h4 id="members-of-the-public-need-to-see-appropriate-image-sizes-depending-on-the-device-they-are-using">
<em>Members of the public</em> need to see appropriate image sizes depending on the device they are using</h4>
<blockquote>
<p>Whitehall creates up to 7 image sizes of each uploaded image. Urls to these images are published as part of the content
so that rendering applications can then show the best image size for the use case.</p>
</blockquote>
<h4 id="members-of-the-public-should-see-document-content-with-working-image-and-attachment-urls">
<em>Members of the public</em> should see document content with working image and attachment urls</h4>
<blockquote>
<p>For <em>Editionable Content</em> types, such as <strong>News Articles</strong> or <strong>Publication</strong> - Publishing is prevented for documents
with images and attachments that have not yet finished uploading.</p>
</blockquote>
<h4 id="publishers-need-to-know-when-publishing-is-blocked-because-file-or-image-attachment-processing-has-not-yet-finished-or-the-processing-has-failed">
<em>Publishers</em> need to know when publishing is blocked because file or image attachment processing has not yet finished or the processing has failed</h4>
<blockquote>
<p>Whitehall UI shows a validation error for <em>Editionable Content</em> types with image or file attachments, when publishing
fails because of unfinished background jobs.</p>
</blockquote>
<h4 id="publishers-need-to-know-when-file-or-image-attachments-are-being-processed-so-that-they-know-to-wait-before-expecting-the-new-image-to-be-live">
<em>Publishers</em> need to know when file or image attachments are being processed so that they know to wait before expecting the new image to be live</h4>
<blockquote>
<p>Whitehall UI shows a "PROCESSING" label next to images and attachments that have not yet finished uploading to Asset Manager.</p>
</blockquote>
<h4 id="members-of-the-public-need-to-be-able-to-see-the-latest-images-on-the-documents-page-as-soon-as-the-attachments-finish-uploading-in-the-background">
<em>Members of the public</em> need to be able to see the latest images on the document's page as soon as the attachments finish uploading in the background</h4>
<blockquote>
<p>Whitehall will republish content and any dependent content when file processing finishes in the background.
For example, when changing a <strong>DefaultNewsImage</strong> for an <strong>Organisation</strong>, once all image variants have finished uploading, the <strong>Organisation</strong> is
republished and any <strong>News Articles</strong> that would use the organisation's image as a lead image are republished as well.</p>
</blockquote>
<h3 id="current-known-bugs">Current known bugs</h3>
<p>Last updated: 3rd April 2025</p>
<h4 id="unable-to-preview-attachments-on-new-draft-from-unpublishing">Unable to preview attachments on new draft from Unpublishing</h4>
<p><strong>How to reproduce:</strong></p>
<ol>
<li>Unpublish an edition that has an attachment</li>
<li>Create a new draft</li>
<li>Preview the attachment</li>
</ol>
<p><strong>What happens:</strong></p>
<ul>
<li>Attachment preview is redirected</li>
</ul>
<p><strong>Expected:</strong></p>
<ul>
<li>Draft Attachment should be previewable</li>
<li>Live attachment should still be redirected</li>
</ul>
<p><strong>Suggested Support Fix:</strong></p>
<ul>
<li>There is currently no fix. If we make the asset state <code>draft</code> in asset-manager, then any previous asset in the replacement chain (if it exists) will become live, which might not be what the user wants.</li>
<li>One thing we can do is to check whether or not the attachment users want to preview is not a replacement of any prior assets. We can do this by double checking in both Asset in Asset Manager and AttachmentData in Whitehall that no other assets are replaced by this  target attachment. If that is the case, we should be able to set the state of the asset to <code>draft</code> in Asset Manager which should enable preview for the user.</li>
</ul>
<p><strong>Suggested Permanent Fix:</strong></p>
<ul>
<li>Having a draft stack for attachments will help. If we duplicate assets for draft, then it won't affect anything live.</li>
</ul>
<hr>
<h4 id="missing-live-attachment-if-document-is-unpublished-new-draft-discarded-and-further-draft-published">Missing live attachment if document is Unpublished, new draft discarded, and further draft published</h4>
<p><strong>How to reproduce:</strong></p>
<ol>
<li>Unpublish an edition with attachment</li>
<li>Create new draft</li>
<li>Discard the draft</li>
<li>Create new draft</li>
<li>Publish the draft</li>
</ol>
<p><strong>What happens:</strong></p>
<ul>
<li>Attachment returns not found</li>
</ul>
<p><strong>Expected:</strong></p>
<ul>
<li>Attachment should be made live again upon publish</li>
</ul>
<p><strong>Suggested Fix:</strong></p>
<ul>
<li>Reset <code>redirect url</code> and / or <code>deleted_at</code> in Asset Manager for the appropriate asset to bring it back</li>
</ul>
<h3 id="current-unsupported-workflows">Current unsupported workflows</h3>
<p>Last updated: 3rd April 2025</p>
<p>We currently don't support official UI workflow for doing the following.</p>
<ul>
<li>Unpublish / Redirect individual attachments
<ul>
<li>For HTML attachments, rake task <code>publishing_api:redirect_html_attachments:by_content_id</code>
</li>
<li>For file attachments, manage in asset manager</li>
</ul>
</li>
<li>Withdraw individual HTML attachments</li>
</ul>

  <script>
    /*
      Manually trigger the styling of the 'current page' in the sidebar,
      as it does not happen automatically because we are still technically
      in single page mode.
    */
    (function () {
        'use strict'
        /*
          Cannot use `$(document).ready` on next line as jQuery has not loaded
          yet. But we can use jQuery in the callback.
        */
        window.addEventListener('load', function () {
            try {
                new GOVUK.Modules.InPageNavigation().start($("html"));
            }
            catch (error) {
                /* Fail without causing other JS in the page to break */
                console.log("Error calling GOVUK's InPageNavigation module", error);
            }
        })
    }());
</script>


            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/whitehall/blob/main/docs/assets.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?body=Problem+with+%27%27+%28https%3A%2F%2Fdocs.publishing.service.gov.uk%2Frepos%2Fwhitehall%2Fassets.html%29&amp;labels=bug&amp;title=Re%3A+%27%27">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <svg focusable="false" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 60" height="30" width="32" fill="currentcolor" class="govuk-footer__crown">
    <g>
      <circle cx="20" cy="17.6" r="3.7"></circle>
      <circle cx="10.2" cy="23.5" r="3.7"></circle>
      <circle cx="3.7" cy="33.2" r="3.7"></circle>
      <circle cx="31.7" cy="30.6" r="3.7"></circle>
      <circle cx="43.3" cy="17.6" r="3.7"></circle>
      <circle cx="53.2" cy="23.5" r="3.7"></circle>
      <circle cx="59.7" cy="33.2" r="3.7"></circle>
      <circle cx="31.7" cy="30.6" r="3.7"></circle>
      <path d="M33.1,9.8c.2-.1.3-.3.5-.5l4.6,2.4v-6.8l-4.6,1.5c-.1-.2-.3-.3-.5-.5l1.9-5.9h-6.7l1.9,5.9c-.2.1-.3.3-.5.5l-4.6-1.5v6.8l4.6-2.4c.1.2.3.3.5.5l-2.6,8c-.9,2.8,1.2,5.7,4.1,5.7h0c3,0,5.1-2.9,4.1-5.7l-2.6-8ZM37,37.9s-3.4,3.8-4.1,6.1c2.2,0,4.2-.5,6.4-2.8l-.7,8.5c-2-2.8-4.4-4.1-5.7-3.8.1,3.1.5,6.7,5.8,7.2,3.7.3,6.7-1.5,7-3.8.4-2.6-2-4.3-3.7-1.6-1.4-4.5,2.4-6.1,4.9-3.2-1.9-4.5-1.8-7.7,2.4-10.9,3,4,2.6,7.3-1.2,11.1,2.4-1.3,6.2,0,4,4.6-1.2-2.8-3.7-2.2-4.2.2-.3,1.7.7,3.7,3,4.2,1.9.3,4.7-.9,7-5.9-1.3,0-2.4.7-3.9,1.7l2.4-8c.6,2.3,1.4,3.7,2.2,4.5.6-1.6.5-2.8,0-5.3l5,1.8c-2.6,3.6-5.2,8.7-7.3,17.5-7.4-1.1-15.7-1.7-24.5-1.7h0c-8.8,0-17.1.6-24.5,1.7-2.1-8.9-4.7-13.9-7.3-17.5l5-1.8c-.5,2.5-.6,3.7,0,5.3.8-.8,1.6-2.3,2.2-4.5l2.4,8c-1.5-1-2.6-1.7-3.9-1.7,2.3,5,5.2,6.2,7,5.9,2.3-.4,3.3-2.4,3-4.2-.5-2.4-3-3.1-4.2-.2-2.2-4.6,1.6-6,4-4.6-3.7-3.7-4.2-7.1-1.2-11.1,4.2,3.2,4.3,6.4,2.4,10.9,2.5-2.8,6.3-1.3,4.9,3.2-1.8-2.7-4.1-1-3.7,1.6.3,2.3,3.3,4.1,7,3.8,5.4-.5,5.7-4.2,5.8-7.2-1.3-.2-3.7,1-5.7,3.8l-.7-8.5c2.2,2.3,4.2,2.7,6.4,2.8-.7-2.3-4.1-6.1-4.1-6.1h10.6,0Z"></path>
    </g>
  </svg>
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Accessibility</a>
            </li>
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/cookies.html">Cookies</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/govuk_frontend.js" type="module"></script>
    <script src="/javascripts/application.js"></script>
  </body>
</html>
