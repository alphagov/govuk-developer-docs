

<!doctype html>
<html lang="en" class="govuk-template govuk-template--rebranded no-js">
  <head>
    

    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>govuk-docker: How Tos - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/repos/govuk-docker/how-tos.html">
      <link rel="icon" sizes="48x48" href="/assets/govuk/assets/rebrand/images/favicon.ico">
      <link rel="icon" sizes="any" href="/assets/govuk/assets/rebrand/images/favicon.svg" type="image/svg+xml">
      <link rel="mask-icon" href="/assets/govuk/assets/rebrand/images/govuk-icon-mask.svg" color="#0b0c0c">
      <link rel="apple-touch-icon" href="/assets/govuk/assets/rebrand/images/govuk-icon-180.png">
      <link rel="manifest" href="/assets/govuk/assets/rebrand/manifest.json">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.publishing.service.gov.uk/assets/govuk/assets/rebrand/images/govuk-opengraph-image.png" />
      <meta name="twitter:title" content="govuk-docker: How Tos - GOV.UK Developer Documentation" />
      <meta name="twitter:url" content="https://docs.publishing.service.gov.uk/repos/govuk-docker/how-tos.html" />

      <meta property="og:image" content="https://docs.publishing.service.gov.uk/assets/govuk/assets/rebrand/images/govuk-opengraph-image.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="govuk-docker: How Tos" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/repos/govuk-docker/how-tos.html" />

      <script>
  document.addEventListener('DOMContentLoaded', function () {
    var markup = `<div id="global-cookie-message" data-module="cookie-banner" data-nosnippet="" aria-label="Can we store analytics cookies on your device?" class="gem-c-cookie-banner govuk-clearfix govuk-cookie-banner js-banner-wrapper" role="region" hidden="hidden" title="Can we store analytics cookies on your device?"> <div class="govuk-cookie-banner__message govuk-width-container"> <div class="govuk-grid-row"> <div class="govuk-grid-column-two-thirds"> <h2 class="govuk-cookie-banner__heading govuk-heading-m">Can we store analytics cookies on your device?</h2> <div tabindex="-1" class="govuk-cookie-banner__content gem-c-cookie-banner__confirmation"> <div class="gem-c-cookie-banner__content"><p class='govuk-body'>Weâ€™d like to set some cookies to understand how you use this site and remember your settings.</p><p class='govuk-body'>We also use cookies set by other sites to help us deliver content from their services.</p></div> <p class="gem-c-cookie-banner__confirmation-message--accepted govuk-body" hidden data-ga4-cookie-banner data-module="ga4-link-tracker" data-ga4-track-links-only data-ga4-set-indexes data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;cookie banner&quot;,&quot;section&quot;:&quot;You have accepted additional cookies&quot;}" >You have accepted additional cookies. <span class="gem-c-cookie-banner__confirmation-message">You can <a class="govuk-link" href="/cookies.html">change your cookie settings</a> at any time.</span></p> <p class="gem-c-cookie-banner__confirmation-message--rejected govuk-body" hidden>You have rejected additional cookies. <span class="gem-c-cookie-banner__confirmation-message">You can <a class="govuk-link" href="/cookies.html">change your cookie settings</a> at any time.</span></p> </div> </div> </div> <div class="js-confirmation-buttons govuk-button-group"> <button class="gem-c-button govuk-button" type="submit" data-accept-cookies="true" data-cookie-types="all">Accept additional cookies</button> <button class="gem-c-button govuk-button" type="submit" data-reject-cookies="true">Reject additional cookies</button> <a class="govuk-link" href="/cookies.html">View cookies</a> </div> <div hidden class="js-hide-button govuk-button-group"> <button class="gem-c-cookie-banner__hide-button govuk-button" data-hide-cookie-banner="true" data-module="ga4-event-tracker" data-ga4-event="{&quot;event_name&quot;:&quot;select_content&quot;,&quot;type&quot;:&quot;cookie banner&quot;,&quot;action&quot;:&quot;closed&quot;,&quot;section&quot;:&quot;You have accepted additional cookies&quot;}" > Hide cookie message </button> </div> </div> </div>`;
    var banner = document.createElement('div');
    banner.innerHTML = markup;
    document.body.prepend(banner);
  })
</script>


  </head>

  <body class="govuk-template__body">
    <script>document.body.className += ' js-enabled' + ('noModule' in HTMLScriptElement.prototype ? ' govuk-frontend-supported' : '');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <svg
          focusable="false"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 324 60"
          height="30"
          width="162"
          fill="currentcolor"
          class="govuk-header__logotype"
          aria-label="GOV.UK">
          <title>GOV.UK</title>
          <g>
            <circle cx="20" cy="17.6" r="3.7"></circle>
            <circle cx="10.2" cy="23.5" r="3.7"></circle>
            <circle cx="3.7" cy="33.2" r="3.7"></circle>
            <circle cx="31.7" cy="30.6" r="3.7"></circle>
            <circle cx="43.3" cy="17.6" r="3.7"></circle>
            <circle cx="53.2" cy="23.5" r="3.7"></circle>
            <circle cx="59.7" cy="33.2" r="3.7"></circle>
            <circle cx="31.7" cy="30.6" r="3.7"></circle>
            <path d="M33.1,9.8c.2-.1.3-.3.5-.5l4.6,2.4v-6.8l-4.6,1.5c-.1-.2-.3-.3-.5-.5l1.9-5.9h-6.7l1.9,5.9c-.2.1-.3.3-.5.5l-4.6-1.5v6.8l4.6-2.4c.1.2.3.3.5.5l-2.6,8c-.9,2.8,1.2,5.7,4.1,5.7h0c3,0,5.1-2.9,4.1-5.7l-2.6-8ZM37,37.9s-3.4,3.8-4.1,6.1c2.2,0,4.2-.5,6.4-2.8l-.7,8.5c-2-2.8-4.4-4.1-5.7-3.8.1,3.1.5,6.7,5.8,7.2,3.7.3,6.7-1.5,7-3.8.4-2.6-2-4.3-3.7-1.6-1.4-4.5,2.4-6.1,4.9-3.2-1.9-4.5-1.8-7.7,2.4-10.9,3,4,2.6,7.3-1.2,11.1,2.4-1.3,6.2,0,4,4.6-1.2-2.8-3.7-2.2-4.2.2-.3,1.7.7,3.7,3,4.2,1.9.3,4.7-.9,7-5.9-1.3,0-2.4.7-3.9,1.7l2.4-8c.6,2.3,1.4,3.7,2.2,4.5.6-1.6.5-2.8,0-5.3l5,1.8c-2.6,3.6-5.2,8.7-7.3,17.5-7.4-1.1-15.7-1.7-24.5-1.7h0c-8.8,0-17.1.6-24.5,1.7-2.1-8.9-4.7-13.9-7.3-17.5l5-1.8c-.5,2.5-.6,3.7,0,5.3.8-.8,1.6-2.3,2.2-4.5l2.4,8c-1.5-1-2.6-1.7-3.9-1.7,2.3,5,5.2,6.2,7,5.9,2.3-.4,3.3-2.4,3-4.2-.5-2.4-3-3.1-4.2-.2-2.2-4.6,1.6-6,4-4.6-3.7-3.7-4.2-7.1-1.2-11.1,4.2,3.2,4.3,6.4,2.4,10.9,2.5-2.8,6.3-1.3,4.9,3.2-1.8-2.7-4.1-1-3.7,1.6.3,2.3,3.3,4.1,7,3.8,5.4-.5,5.7-4.2,5.8-7.2-1.3-.2-3.7,1-5.7,3.8l-.7-8.5c2.2,2.3,4.2,2.7,6.4,2.8-.7-2.3-4.1-6.1-4.1-6.1h10.6,0Z"></path>
          </g>
          <circle class="govuk-logo-dot" cx="226" cy="36" r="7.3"/>
          <path d="M93.94 41.25c.4 1.81 1.2 3.21 2.21 4.62 1 1.4 2.21 2.41 3.61 3.21s3.21 1.2 5.22 1.2 3.61-.4 4.82-1c1.4-.6 2.41-1.4 3.21-2.41.8-1 1.4-2.01 1.61-3.01s.4-2.01.4-3.01v.14h-10.86v-7.02h20.07v24.08h-8.03v-5.56c-.6.8-1.38 1.61-2.19 2.41-.8.8-1.81 1.2-2.81 1.81-1 .4-2.21.8-3.41 1.2s-2.41.4-3.81.4a18.56 18.56 0 0 1-14.65-6.63c-1.6-2.01-3.01-4.41-3.81-7.02s-1.4-5.62-1.4-8.83.4-6.02 1.4-8.83a20.45 20.45 0 0 1 19.46-13.65c3.21 0 4.01.2 5.82.8 1.81.4 3.61 1.2 5.02 2.01 1.61.8 2.81 2.01 4.01 3.21s2.21 2.61 2.81 4.21l-7.63 4.41c-.4-1-1-1.81-1.61-2.61-.6-.8-1.4-1.4-2.21-2.01-.8-.6-1.81-1-2.81-1.4-1-.4-2.21-.4-3.61-.4-2.01 0-3.81.4-5.22 1.2-1.4.8-2.61 1.81-3.61 3.21s-1.61 2.81-2.21 4.62c-.4 1.81-.6 3.71-.6 5.42s.8 5.22.8 5.22Zm57.8-27.9c3.21 0 6.22.6 8.63 1.81 2.41 1.2 4.82 2.81 6.62 4.82S170.2 24.39 171 27s1.4 5.62 1.4 8.83-.4 6.02-1.4 8.83-2.41 5.02-4.01 7.02-4.01 3.61-6.62 4.82-5.42 1.81-8.63 1.81-6.22-.6-8.63-1.81-4.82-2.81-6.42-4.82-3.21-4.41-4.01-7.02-1.4-5.62-1.4-8.83.4-6.02 1.4-8.83 2.41-5.02 4.01-7.02 4.01-3.61 6.42-4.82 5.42-1.81 8.63-1.81Zm0 36.73c1.81 0 3.61-.4 5.02-1s2.61-1.81 3.61-3.01 1.81-2.81 2.21-4.41c.4-1.81.8-3.61.8-5.62 0-2.21-.2-4.21-.8-6.02s-1.2-3.21-2.21-4.62c-1-1.2-2.21-2.21-3.61-3.01s-3.21-1-5.02-1-3.61.4-5.02 1c-1.4.8-2.61 1.81-3.61 3.01s-1.81 2.81-2.21 4.62c-.4 1.81-.8 3.61-.8 5.62 0 2.41.2 4.21.8 6.02.4 1.81 1.2 3.21 2.21 4.41s2.21 2.21 3.61 3.01c1.4.8 3.21 1 5.02 1Zm36.32 7.96-12.24-44.15h9.83l8.43 32.77h.4l8.23-32.77h9.83L200.3 58.04h-12.24Zm74.14-7.96c2.18 0 3.51-.6 3.51-.6 1.2-.6 2.01-1 2.81-1.81s1.4-1.81 1.81-2.81a13 13 0 0 0 .8-4.01V13.9h8.63v28.15c0 2.41-.4 4.62-1.4 6.62-.8 2.01-2.21 3.61-3.61 5.02s-3.41 2.41-5.62 3.21-4.62 1.2-7.02 1.2-5.02-.4-7.02-1.2c-2.21-.8-4.01-1.81-5.62-3.21s-2.81-3.01-3.61-5.02-1.4-4.21-1.4-6.62V13.9h8.63v26.95c0 1.61.2 3.01.8 4.01.4 1.2 1.2 2.21 2.01 2.81.8.8 1.81 1.4 2.81 1.81 0 0 1.34.6 3.51.6Zm34.22-36.18v18.92l15.65-18.92h10.82l-15.03 17.32 16.03 26.83h-10.21l-11.44-20.21-5.62 6.22v13.99h-8.83V13.9"/>
        </svg>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" hidden>Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual.html">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/kubernetes/">Kubernetes</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/apps.html" aria-current="page">Apps</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/repos.html">Repos</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/mobile/">Mobile</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1">
              <div class="search" data-module="search" data-path-to-site-root="/">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input
      type="search"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <ul>
    <li>
      <a href="/repos/govuk-docker.html" rel="noopener" class="govuk-link">govuk-docker</a>
    </li>
    <li>
      <ul>
            <li><a href="/repos/govuk-docker/compatibility.html" rel="noopener" class="govuk-link">Compatibility</a></li>
    <li><a href="/repos/govuk-docker/how-tos.html" rel="noopener" class="govuk-link">How Tos</a></li>
    <li><a href="/repos/govuk-docker/troubleshooting.html" rel="noopener" class="govuk-link">Troubleshooting</a></li>
    <li class="subdir__heading">adr</li>
    <ul class="subdir__menu">
          <li><a href="/repos/govuk-docker/adr/0001-record-architecture-decisions.html" rel="noopener" class="govuk-link">0001-record-architecture-decisions</a></li>
    <li><a href="/repos/govuk-docker/adr/0002-docker-images-for-ruby-applications.html" rel="noopener" class="govuk-link">2. Docker images for Ruby Applications</a></li>
    <li><a href="/repos/govuk-docker/adr/0003-use-docker-volumes-for-improved-macos-performance.html" rel="noopener" class="govuk-link">3. Use Docker volumes for improved macOS performance</a></li>
    <li><a href="/repos/govuk-docker/adr/0004-use-versioned-database-services.html" rel="noopener" class="govuk-link">1. Use versioned database services</a></li>
    <li class="subdir__heading">0001</li>
    <ul class="subdir__menu">
          <li><a href="/repos/govuk-docker/adr/0001/DECISIONS.html" rel="noopener" class="govuk-link">Decisions</a></li>
    <li><a href="/repos/govuk-docker/adr/0001/NEEDS.html" rel="noopener" class="govuk-link">make-1</a></li>

    </ul>

    </ul>
    <li class="subdir__heading">how-tos</li>
    <ul class="subdir__menu">
          <li><a href="/repos/govuk-docker/how-tos/finder-setup.html" rel="noopener" class="govuk-link">How to Publish Content to a Finder in GOV.UK Docker</a></li>
    <li><a href="/repos/govuk-docker/how-tos/publishing-content-on-whitehall.html" rel="noopener" class="govuk-link">Publishing Content from Whitehall for Developing Government Frontend</a></li>

    </ul>

      </ul>
    </li>
  </ul>

              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled" aria-label="Content">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              
<script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "name": "Home",
        "@id": "http://www.dev.gov.uk/"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "name": "Repos",
        "@id": "http://www.dev.gov.uk/repos.html"
      }
    },
    {
      "@type": "ListItem",
      "position": 3,
      "item": {
        "name": "govuk-docker",
        "@id": "http://www.dev.gov.uk/repos/govuk-docker.html"
      }
    }
  ]
}
</script>

<nav data-module="ga4-link-tracker" aria-label="Breadcrumb" class="gem-c-breadcrumbs govuk-breadcrumbs">
  <ol class="govuk-breadcrumbs__list">
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;1&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/">Home</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;2&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/repos.html">Repos</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;3&quot;,&quot;index_total&quot;:&quot;3&quot;}" class="govuk-breadcrumbs__link" href="/repos/govuk-docker.html">govuk-docker</a>
        </li>
  </ol>
</nav>
  <div class="govuk-!-font-size-16 govuk-!-margin-top-6">

  Last updated: <a href="https://github.com/alphagov/govuk-docker/commit/01f524f4bef3e61d9dd8972db27de275a9498afb">27 Oct 2025</a>
</div>

  <h1 class="page-title">govuk-docker: How Tos</h1>

  
<p>ðŸ‘‰ <a href="/repos/govuk-docker/troubleshooting.html">Check the troubleshooting guide if you have a problem.</a></p>
<h2 id="how-to-get-back-to-a-clean-slate">How to: get back to a clean slate</h2>
<p>If you encounter an issue with your Docker setup and you've already exhausted all other ideas, here's a quick one-liner that stops and removes absolutely everything. You can then follow the govuk-docker README instructions for <code>make</code>-ing your app again.</p>
<pre><code>docker stop $(docker ps -a -q) &amp;&amp; docker rm $(docker ps -a -q) &amp;&amp; docker rmi $(docker images -q) -f &amp;&amp; docker volume prune &amp;&amp; docker container prune &amp;&amp; docker image prune &amp;&amp; docker network prune &amp;&amp; docker builder prune -f &amp;&amp; docker system prune --all --volumes
</code></pre>
<h2 id="how-to-reduce-typing-with-shortcuts">How to: reduce typing with shortcuts</h2>
<p>Typing the <a href="https://github.com/alphagov/govuk-docker/blob/main/README.md#usage">full commands</a> is likely to get tiring. We've added a couple of lightweight helper scripts alongside govuk-docker, which figure out the application you're running based on the name of the current directory.</p>
<pre><code># full commands
govuk-docker run collections-publisher-lite bundle exec rake
govuk-docker up collections-publisher-app

# shortcuts
# assuming you're in the collections-publisher directory
govuk-docker-run bundle exec rake
govuk-docker-up
</code></pre>
<p>Here are some suggested aliases that make things even shorter.</p>
<pre><code>alias gd="govuk-docker"
alias gdr="govuk-docker-run"
alias gdu="govuk-docker-up"
alias gdbe="govuk-docker-run bundle exec"
</code></pre>
<h2 id="how-to-work-with-local-gems">How to: work with local gems</h2>
<p>Provide a local gem path relative to the location of the Gemfile you're editing:</p>
<pre lang="ruby"><code>gem "govuk_publishing_components", path: "../govuk_publishing_components"
</code></pre>
<h2 id="how-to-replicate-data-locally">How to: replicate data locally</h2>
<p>There may be times when a full database is required locally.  The following scripts in the <code>bin</code> directory allow replicating data from integration:</p>
<ul>
<li><code>replicate-elasticsearch.sh</code></li>
<li><code>replicate-mongodb.sh APP-NAME</code></li>
<li><code>replicate-mysql.sh APP-NAME</code></li>
<li><code>replicate-postgresql.sh APP-NAME</code></li>
</ul>
<p>You will need to assume-role into AWS using the <a href="https://docs.publishing.service.gov.uk/manual/access-aws-console.html">gds-cli</a> before running the scripts. For example, to replicate data for Collections Publisher, run:</p>
<pre><code>gds aws govuk-integration-developer --assume-role-ttl 3h ./bin/replicate-postgresql.sh collections-publisher
</code></pre>
<blockquote>
<p>The <code>readonly</code> role does not provide access to S3, so cannot be used to replicate data locally.</p>
</blockquote>
<p>All the scripts, other than <code>replicate-elasticsearch.sh</code>, take the name of the app to replicate data for.</p>
<p>Draft data can be replicated with <code>replicate-postgresql.sh draft-content-store</code> and <code>replicate-mongodb.sh draft-router</code>.</p>
<p>If you want to download data without importing it, set the <code>SKIP_IMPORT</code> environment variable (to anything).</p>
<h3 id="troubleshooting">Troubleshooting</h3>
<p>The replication scripts might fail for the following reasons:</p>
<ul>
<li>
<code>pv</code> not being installed. This is used to display a progress bar. On macOS, you can <a href="https://formulae.brew.sh/formula/pv">install pv using Homebrew</a>.</li>
<li>Running out of space in Docker. This might result in an error like <code>ERROR 1114 (HY000) at line 11768: The table 'govspeak_contents' is full</code>. If you see this, you could do either or both of the following:
<ul>
<li>If you're okay with removing some or all of your Docker containers, images, and possibly volumes and other data, run <a href="https://docs.docker.com/reference/cli/docker/system/prune">docker system prune</a>.</li>
<li>If you have enough spare space on your local machine, allocate more space to Docker. Using Docker Desktop, this setting is under Settings &gt; Resources &gt; Advanced &gt; Resource Allocation &gt; Virtual disk limit.</li>
</ul>
</li>
</ul>
<h2 id="how-to-set-environment-variables">How to: set environment variables</h2>
<p>While most environment variables should be set in the config for a project, sometimes it's necessary to set assign one or more variables at the point of running a command, such as a Rake task. This can be done using <code>env</code> e.g.</p>
<pre><code>govuk-docker run collections-publisher-lite env MY_VAR=my_val bundle exec rake my_task
</code></pre>
<h2 id="how-to-debug-a-running-rails-app">How to: debug a running Rails app</h2>
<p>Normally it's enough to run a Rails app using <code>govuk-docker up</code>. To get a <code>debugger</code> console for a specific app or one of its dependencies, we need to attach an interactive terminal to the running container.</p>
<pre><code># find the container name
govuk-docker ps

# attach to the container
docker attach govuk-docker_collections-publisher-app_1

# awesome debugging stuff
...

# detach from the container
CTRL-P CTRL-Q
</code></pre>
<p>Note that many of the apps run using the Puma web server, which by default runs in cluster mode. This causes problems with using the debugger console. Puma routes the stdout from multiple processes back into the main container stdout, so the effect is often that keystrokes appear to be "lost" while output from non-paused processes is prioritised. To fix this, you can set the <code>WEB_CONCURRENCY</code> environment variable on the container to 0. That will force Puma to run in single process mode.</p>
<h2 id="how-to-use-a-custom-working-directory">How to: use a custom working directory</h2>
<p>GOV.UK Docker should respect the following environment variables:</p>
<ul>
<li>
<code>$GOVUK_ROOT_DIR</code> - directory where app repositories live, defaults to <code>$HOME/govuk</code>
</li>
<li>
<code>$GOVUK_DOCKER_DIR</code> - directory where the govuk-docker repository lives, defaults to <code>$GOVUK_ROOT_DIR/govuk-docker</code>
</li>
<li>
<code>$GOVUK_DOCKER</code> - path of the govuk-docker script, defaults to <code>$GOVUK_DOCKER_DIR/bin/govuk-docker</code>
</li>
</ul>
<h2 id="how-to-enable-production-json-logs-in-development">How to: enable production JSON logs in development</h2>
<ul>
<li>Set <code>GOVUK_RAILS_JSON_LOGGING</code> to <code>"true"</code> in <code>docker-compose.yml</code> for the application you would like to enable the logs' behaviour for.</li>
</ul>
<h2 id="how-to-publish-a-finder-and-specialist-documents-to-test-finders-end-to-end-locally">How to: publish a finder and specialist documents to test finders end-to-end locally</h2>
<p>See <a href="https://github.com/alphagov/govuk-docker/blob/main/docs/how-tos/finder-setup.md">How to Publish Content to a Finder in GOV.UK Docker</a></p>
<h2 id="how-to-re-run-make-without-branch-checks">How to: Re-run <code>make</code> without branch checks</h2>
<p>If you have already run <code>make</code> for a project recently, and just want to re-run it without it
checking for updates to all dependent repositories (for example if you do not have a stable internet
connection), you can set the <code>SKIP_BRANCH_CHECKS</code> environment variable:</p>
<pre lang="bash"><code>SKIP_BRANCH_CHECKS=1 make my-app
</code></pre>
<h2 id="how-to-use-podman-instead-of-docker">How to: Use Podman instead of Docker</h2>
<blockquote>
<p>[!WARNING]
GOV.UK Docker was built for Docker (if the name didn't make that obvious!), so when leaving the
"golden path" you may experience unexpected issues that your peers can't help you with.</p>
<p>For now, we recommend you only use another Linux container runtime if you are comfortable with
Linux and container technologies, and able/willing to resolve issues yourself.</p>
</blockquote>
<p>If you prefer to use <a href="https://podman.io/">Podman</a> instead of Docker to run and orchestrate your
containers, you can set <code>GOVUK_DOCKER_CONTAINER_RUNTIME=podman</code> in your environment (for example, in
your <code>.bashrc</code>).</p>
<p>Podman needs an external "compose provider" installed as a backing tool for <code>podman compose</code> (which
itself is just a wrapper), and the ideal option is Docker's v2 Compose CLI plugin rather than the
legacy <code>podman-compose</code> tool. You do not need Docker itself installed, and <code>podman compose</code> will
pick up on the Docker Compose plugin automatically if installed, for example through:</p>
<ul>
<li>Podman Desktop on macOS or Windows</li>
<li>your Linux distribution's package manager or Homebrew on macOS (check to make sure it's &gt;= 2.x)</li>
<li>manually installing a release from <a href="https://github.com/docker/compose">its repository</a>
</li>
</ul>
<p>There are two major gotchas relating to the Nginx proxy:</p>
<ul>
<li>it needs to run on port 80, which under most circumstances requires root privileges to bind to on
Linux, and</li>
<li>it requires a Docker-compatible socket to be mounted into the container, so is not compatible with
daemonless approaches (like Podman's out-of-the-box architecture)</li>
</ul>
<p>The easiest way to work around this is (more advanced approaches are available but left as an
exercise for the reader):</p>
<ul>
<li>on Linux, by setting up a Podman socket as root, and running GOV.UK Docker as root</li>
<li>on Mac, by using Podman Desktop and enabling all Docker Compatibility features</li>
</ul>

  <script>
    /*
      Manually trigger the styling of the 'current page' in the sidebar,
      as it does not happen automatically because we are still technically
      in single page mode.
    */
    (function () {
        'use strict'
        /*
          Cannot use `$(document).ready` on next line as jQuery has not loaded
          yet. But we can use jQuery in the callback.
        */
        window.addEventListener('load', function () {
            try {
                new GOVUK.Modules.InPageNavigation().start($("html"));
            }
            catch (error) {
                /* Fail without causing other JS in the page to break */
                console.log("Error calling GOVUK's InPageNavigation module", error);
            }
        })
    }());
</script>


            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-docker/blob/main/docs/how-tos.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?body=Problem+with+%27%27+%28https%3A%2F%2Fdocs.publishing.service.gov.uk%2Frepos%2Fgovuk-docker%2Fhow-tos.html%29&amp;labels=bug&amp;title=Re%3A+%27%27">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <svg focusable="false" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 60" height="30" width="32" fill="currentcolor" class="govuk-footer__crown">
    <g>
      <circle cx="20" cy="17.6" r="3.7"></circle>
      <circle cx="10.2" cy="23.5" r="3.7"></circle>
      <circle cx="3.7" cy="33.2" r="3.7"></circle>
      <circle cx="31.7" cy="30.6" r="3.7"></circle>
      <circle cx="43.3" cy="17.6" r="3.7"></circle>
      <circle cx="53.2" cy="23.5" r="3.7"></circle>
      <circle cx="59.7" cy="33.2" r="3.7"></circle>
      <circle cx="31.7" cy="30.6" r="3.7"></circle>
      <path d="M33.1,9.8c.2-.1.3-.3.5-.5l4.6,2.4v-6.8l-4.6,1.5c-.1-.2-.3-.3-.5-.5l1.9-5.9h-6.7l1.9,5.9c-.2.1-.3.3-.5.5l-4.6-1.5v6.8l4.6-2.4c.1.2.3.3.5.5l-2.6,8c-.9,2.8,1.2,5.7,4.1,5.7h0c3,0,5.1-2.9,4.1-5.7l-2.6-8ZM37,37.9s-3.4,3.8-4.1,6.1c2.2,0,4.2-.5,6.4-2.8l-.7,8.5c-2-2.8-4.4-4.1-5.7-3.8.1,3.1.5,6.7,5.8,7.2,3.7.3,6.7-1.5,7-3.8.4-2.6-2-4.3-3.7-1.6-1.4-4.5,2.4-6.1,4.9-3.2-1.9-4.5-1.8-7.7,2.4-10.9,3,4,2.6,7.3-1.2,11.1,2.4-1.3,6.2,0,4,4.6-1.2-2.8-3.7-2.2-4.2.2-.3,1.7.7,3.7,3,4.2,1.9.3,4.7-.9,7-5.9-1.3,0-2.4.7-3.9,1.7l2.4-8c.6,2.3,1.4,3.7,2.2,4.5.6-1.6.5-2.8,0-5.3l5,1.8c-2.6,3.6-5.2,8.7-7.3,17.5-7.4-1.1-15.7-1.7-24.5-1.7h0c-8.8,0-17.1.6-24.5,1.7-2.1-8.9-4.7-13.9-7.3-17.5l5-1.8c-.5,2.5-.6,3.7,0,5.3.8-.8,1.6-2.3,2.2-4.5l2.4,8c-1.5-1-2.6-1.7-3.9-1.7,2.3,5,5.2,6.2,7,5.9,2.3-.4,3.3-2.4,3-4.2-.5-2.4-3-3.1-4.2-.2-2.2-4.6,1.6-6,4-4.6-3.7-3.7-4.2-7.1-1.2-11.1,4.2,3.2,4.3,6.4,2.4,10.9,2.5-2.8,6.3-1.3,4.9,3.2-1.8-2.7-4.1-1-3.7,1.6.3,2.3,3.3,4.1,7,3.8,5.4-.5,5.7-4.2,5.8-7.2-1.3-.2-3.7,1-5.7,3.8l-.7-8.5c2.2,2.3,4.2,2.7,6.4,2.8-.7-2.3-4.1-6.1-4.1-6.1h10.6,0Z"></path>
    </g>
  </svg>
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Accessibility</a>
            </li>
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/cookies.html">Cookies</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/govuk_frontend.js" type="module"></script>
    <script src="/javascripts/application.js"></script>
  </body>
</html>
