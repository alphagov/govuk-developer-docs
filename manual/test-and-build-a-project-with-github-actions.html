





<!doctype html>
<html lang="en" class="govuk-template govuk-template--rebranded no-js">
  <head>
    

    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Test & build a project with GitHub Actions - GOV.UK Developer Documentation</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.publishing.service.gov.uk/manual/test-and-build-a-project-with-github-actions.html">
      <link rel="icon" sizes="48x48" href="/assets/govuk/assets/rebrand/images/favicon.ico">
      <link rel="icon" sizes="any" href="/assets/govuk/assets/rebrand/images/favicon.svg" type="image/svg+xml">
      <link rel="mask-icon" href="/assets/govuk/assets/rebrand/images/govuk-icon-mask.svg" color="#0b0c0c">
      <link rel="apple-touch-icon" href="/assets/govuk/assets/rebrand/images/govuk-icon-180.png">
      <link rel="manifest" href="/assets/govuk/assets/rebrand/manifest.json">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.publishing.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.publishing.service.gov.uk/assets/govuk/assets/rebrand/images/govuk-opengraph-image.png" />
      <meta name="twitter:title" content="Test &amp; build a project with GitHub Actions - GOV.UK Developer Documentation" />
      <meta name="twitter:url" content="https://docs.publishing.service.gov.uk/manual/test-and-build-a-project-with-github-actions.html" />

      <meta property="og:image" content="https://docs.publishing.service.gov.uk/assets/govuk/assets/rebrand/images/govuk-opengraph-image.png" />
      <meta property="og:site_name" content="GOV.UK Developer Documentation" />
      <meta property="og:title" content="Test &amp; build a project with GitHub Actions" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.publishing.service.gov.uk/manual/test-and-build-a-project-with-github-actions.html" />

      <script>
  document.addEventListener('DOMContentLoaded', function () {
    var markup = `<div id="global-cookie-message" data-module="cookie-banner" data-nosnippet="" aria-label="Can we store analytics cookies on your device?" class="gem-c-cookie-banner govuk-clearfix govuk-cookie-banner js-banner-wrapper" role="region" hidden="hidden" title="Can we store analytics cookies on your device?"> <div class="govuk-cookie-banner__message govuk-width-container"> <div class="govuk-grid-row"> <div class="govuk-grid-column-two-thirds"> <h2 class="govuk-cookie-banner__heading govuk-heading-m">Can we store analytics cookies on your device?</h2> <div tabindex="-1" class="govuk-cookie-banner__content gem-c-cookie-banner__confirmation"> <div class="gem-c-cookie-banner__content"><p class='govuk-body'>Weâ€™d like to set some cookies to understand how you use this site and remember your settings.</p><p class='govuk-body'>We also use cookies set by other sites to help us deliver content from their services.</p></div> <p class="gem-c-cookie-banner__confirmation-message--accepted govuk-body" hidden data-ga4-cookie-banner data-module="ga4-link-tracker" data-ga4-track-links-only data-ga4-set-indexes data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;cookie banner&quot;,&quot;section&quot;:&quot;You have accepted additional cookies&quot;}" >You have accepted additional cookies. <span class="gem-c-cookie-banner__confirmation-message">You can <a class="govuk-link" href="/cookies.html">change your cookie settings</a> at any time.</span></p> <p class="gem-c-cookie-banner__confirmation-message--rejected govuk-body" hidden>You have rejected additional cookies. <span class="gem-c-cookie-banner__confirmation-message">You can <a class="govuk-link" href="/cookies.html">change your cookie settings</a> at any time.</span></p> </div> </div> </div> <div class="js-confirmation-buttons govuk-button-group"> <button class="gem-c-button govuk-button" type="submit" data-accept-cookies="true" data-cookie-types="all">Accept additional cookies</button> <button class="gem-c-button govuk-button" type="submit" data-reject-cookies="true">Reject additional cookies</button> <a class="govuk-link" href="/cookies.html">View cookies</a> </div> <div hidden class="js-hide-button govuk-button-group"> <button class="gem-c-cookie-banner__hide-button govuk-button" data-hide-cookie-banner="true" data-module="ga4-event-tracker" data-ga4-event="{&quot;event_name&quot;:&quot;select_content&quot;,&quot;type&quot;:&quot;cookie banner&quot;,&quot;action&quot;:&quot;closed&quot;,&quot;section&quot;:&quot;You have accepted additional cookies&quot;}" > Hide cookie message </button> </div> </div> </div>`;
    var banner = document.createElement('div');
    banner.innerHTML = markup;
    document.body.prepend(banner);
  })
</script>


  </head>

  <body class="govuk-template__body">
    <script>document.body.className += ' js-enabled' + ('noModule' in HTMLScriptElement.prototype ? ' govuk-frontend-supported' : '');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <svg
          focusable="false"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 324 60"
          height="30"
          width="162"
          fill="currentcolor"
          class="govuk-header__logotype"
          aria-label="GOV.UK">
          <title>GOV.UK</title>
          <g>
            <circle cx="20" cy="17.6" r="3.7"></circle>
            <circle cx="10.2" cy="23.5" r="3.7"></circle>
            <circle cx="3.7" cy="33.2" r="3.7"></circle>
            <circle cx="31.7" cy="30.6" r="3.7"></circle>
            <circle cx="43.3" cy="17.6" r="3.7"></circle>
            <circle cx="53.2" cy="23.5" r="3.7"></circle>
            <circle cx="59.7" cy="33.2" r="3.7"></circle>
            <circle cx="31.7" cy="30.6" r="3.7"></circle>
            <path d="M33.1,9.8c.2-.1.3-.3.5-.5l4.6,2.4v-6.8l-4.6,1.5c-.1-.2-.3-.3-.5-.5l1.9-5.9h-6.7l1.9,5.9c-.2.1-.3.3-.5.5l-4.6-1.5v6.8l4.6-2.4c.1.2.3.3.5.5l-2.6,8c-.9,2.8,1.2,5.7,4.1,5.7h0c3,0,5.1-2.9,4.1-5.7l-2.6-8ZM37,37.9s-3.4,3.8-4.1,6.1c2.2,0,4.2-.5,6.4-2.8l-.7,8.5c-2-2.8-4.4-4.1-5.7-3.8.1,3.1.5,6.7,5.8,7.2,3.7.3,6.7-1.5,7-3.8.4-2.6-2-4.3-3.7-1.6-1.4-4.5,2.4-6.1,4.9-3.2-1.9-4.5-1.8-7.7,2.4-10.9,3,4,2.6,7.3-1.2,11.1,2.4-1.3,6.2,0,4,4.6-1.2-2.8-3.7-2.2-4.2.2-.3,1.7.7,3.7,3,4.2,1.9.3,4.7-.9,7-5.9-1.3,0-2.4.7-3.9,1.7l2.4-8c.6,2.3,1.4,3.7,2.2,4.5.6-1.6.5-2.8,0-5.3l5,1.8c-2.6,3.6-5.2,8.7-7.3,17.5-7.4-1.1-15.7-1.7-24.5-1.7h0c-8.8,0-17.1.6-24.5,1.7-2.1-8.9-4.7-13.9-7.3-17.5l5-1.8c-.5,2.5-.6,3.7,0,5.3.8-.8,1.6-2.3,2.2-4.5l2.4,8c-1.5-1-2.6-1.7-3.9-1.7,2.3,5,5.2,6.2,7,5.9,2.3-.4,3.3-2.4,3-4.2-.5-2.4-3-3.1-4.2-.2-2.2-4.6,1.6-6,4-4.6-3.7-3.7-4.2-7.1-1.2-11.1,4.2,3.2,4.3,6.4,2.4,10.9,2.5-2.8,6.3-1.3,4.9,3.2-1.8-2.7-4.1-1-3.7,1.6.3,2.3,3.3,4.1,7,3.8,5.4-.5,5.7-4.2,5.8-7.2-1.3-.2-3.7,1-5.7,3.8l-.7-8.5c2.2,2.3,4.2,2.7,6.4,2.8-.7-2.3-4.1-6.1-4.1-6.1h10.6,0Z"></path>
          </g>
          <circle class="govuk-logo-dot" cx="226" cy="36" r="7.3"/>
          <path d="M93.94 41.25c.4 1.81 1.2 3.21 2.21 4.62 1 1.4 2.21 2.41 3.61 3.21s3.21 1.2 5.22 1.2 3.61-.4 4.82-1c1.4-.6 2.41-1.4 3.21-2.41.8-1 1.4-2.01 1.61-3.01s.4-2.01.4-3.01v.14h-10.86v-7.02h20.07v24.08h-8.03v-5.56c-.6.8-1.38 1.61-2.19 2.41-.8.8-1.81 1.2-2.81 1.81-1 .4-2.21.8-3.41 1.2s-2.41.4-3.81.4a18.56 18.56 0 0 1-14.65-6.63c-1.6-2.01-3.01-4.41-3.81-7.02s-1.4-5.62-1.4-8.83.4-6.02 1.4-8.83a20.45 20.45 0 0 1 19.46-13.65c3.21 0 4.01.2 5.82.8 1.81.4 3.61 1.2 5.02 2.01 1.61.8 2.81 2.01 4.01 3.21s2.21 2.61 2.81 4.21l-7.63 4.41c-.4-1-1-1.81-1.61-2.61-.6-.8-1.4-1.4-2.21-2.01-.8-.6-1.81-1-2.81-1.4-1-.4-2.21-.4-3.61-.4-2.01 0-3.81.4-5.22 1.2-1.4.8-2.61 1.81-3.61 3.21s-1.61 2.81-2.21 4.62c-.4 1.81-.6 3.71-.6 5.42s.8 5.22.8 5.22Zm57.8-27.9c3.21 0 6.22.6 8.63 1.81 2.41 1.2 4.82 2.81 6.62 4.82S170.2 24.39 171 27s1.4 5.62 1.4 8.83-.4 6.02-1.4 8.83-2.41 5.02-4.01 7.02-4.01 3.61-6.62 4.82-5.42 1.81-8.63 1.81-6.22-.6-8.63-1.81-4.82-2.81-6.42-4.82-3.21-4.41-4.01-7.02-1.4-5.62-1.4-8.83.4-6.02 1.4-8.83 2.41-5.02 4.01-7.02 4.01-3.61 6.42-4.82 5.42-1.81 8.63-1.81Zm0 36.73c1.81 0 3.61-.4 5.02-1s2.61-1.81 3.61-3.01 1.81-2.81 2.21-4.41c.4-1.81.8-3.61.8-5.62 0-2.21-.2-4.21-.8-6.02s-1.2-3.21-2.21-4.62c-1-1.2-2.21-2.21-3.61-3.01s-3.21-1-5.02-1-3.61.4-5.02 1c-1.4.8-2.61 1.81-3.61 3.01s-1.81 2.81-2.21 4.62c-.4 1.81-.8 3.61-.8 5.62 0 2.41.2 4.21.8 6.02.4 1.81 1.2 3.21 2.21 4.41s2.21 2.21 3.61 3.01c1.4.8 3.21 1 5.02 1Zm36.32 7.96-12.24-44.15h9.83l8.43 32.77h.4l8.23-32.77h9.83L200.3 58.04h-12.24Zm74.14-7.96c2.18 0 3.51-.6 3.51-.6 1.2-.6 2.01-1 2.81-1.81s1.4-1.81 1.81-2.81a13 13 0 0 0 .8-4.01V13.9h8.63v28.15c0 2.41-.4 4.62-1.4 6.62-.8 2.01-2.21 3.61-3.61 5.02s-3.41 2.41-5.62 3.21-4.62 1.2-7.02 1.2-5.02-.4-7.02-1.2c-2.21-.8-4.01-1.81-5.62-3.21s-2.81-3.01-3.61-5.02-1.4-4.21-1.4-6.62V13.9h8.63v26.95c0 1.61.2 3.01.8 4.01.4 1.2 1.2 2.21 2.01 2.81.8.8 1.81 1.4 2.81 1.81 0 0 1.34.6 3.51.6Zm34.22-36.18v18.92l15.65-18.92h10.82l-15.03 17.32 16.03 26.83h-10.21l-11.44-20.21-5.62 6.22v13.99h-8.83V13.9"/>
        </svg>
        <span class="govuk-header__product-name">
          Developer docs
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" hidden>Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/manual/get-started.html">Get started</a>
            </li>
            <li class="govuk-header__navigation-item govuk-header__navigation-item--active">
              <a class="govuk-header__link" href="/manual.html" aria-current="page">Manual</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/kubernetes/">Kubernetes</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/apps.html">Apps</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/repos.html">Repos</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/mobile/">Mobile</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/content-schemas.html">Schemas</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/document-types.html">Document types</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1">
              <div class="search" data-module="search" data-path-to-site-root="/">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://docs.publishing.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input
      type="search"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                  <a href='/manual.html' class="toc__back-link govuk-link">&lsaquo; Manual</a>
  <ul>
  <li>
    <a href="#header"><span>Test & build a project with GitHub Actions</span></a>
    <ul>
      <li>
        <a href="#gov-uk-conventions-for-github-actions"><span>GOV.UK Conventions for GitHub Actions</span></a>
        <ul>
          <li>
            <a href="#name-of-ci-workflow-file"><span>Name of CI workflow file</span></a>
          </li>
          <li>
            <a href="#name-of-ci-workflow-and-jobs"><span>Name of CI workflow and jobs</span></a>
          </li>
          <li>
            <a href="#when-the-ci-workflow-should-run"><span>When the CI workflow should run</span></a>
          </li>
          <li>
            <a href="#branch-protection-rules"><span>Branch protection rules</span></a>
          </li>
          <li>
            <a href="#reuse-workflows-where-possible"><span>Reuse workflows where possible</span></a>
          </li>
          <li>
            <a href="#pin-untrusted-github-actions-to-a-commit-sha"><span>Pin untrusted GitHub Actions to a commit SHA</span></a>
          </li>
          <li>
            <a href="#only-one-workflow-for-a-given-branch-should-run-at-once"><span>Only one workflow for a given branch should run at once</span></a>
          </li>
          <li>
            <a href="#ci-workflow-for-ruby-gems"><span>CI workflow for Ruby gems</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled" aria-label="Content">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
                
<script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "name": "Home",
        "@id": "http://www.dev.gov.uk/"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "name": "Testing",
        "@id": "http://www.dev.gov.uk/manual.html#testing"
      }
    }
  ]
}
</script>

<nav data-module="ga4-link-tracker" aria-label="Breadcrumb" class="gem-c-breadcrumbs govuk-breadcrumbs">
  <ol class="govuk-breadcrumbs__list">
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;1&quot;,&quot;index_total&quot;:&quot;2&quot;}" class="govuk-breadcrumbs__link" href="/">Home</a>
        </li>
        <li class="govuk-breadcrumbs__list-item">
          <a data-ga4-link="{&quot;event_name&quot;:&quot;navigation&quot;,&quot;type&quot;:&quot;breadcrumb&quot;,&quot;index_link&quot;:&quot;2&quot;,&quot;index_total&quot;:&quot;2&quot;}" class="govuk-breadcrumbs__link" href="/manual.html#testing">Testing</a>
        </li>
  </ol>
</nav>
   <div class="govuk-!-font-size-16 govuk-!-margin-top-6">

  Last updated: <a href="https://github.com/alphagov/govuk-developer-docs/commit/b47adbed0fbf39ed6229b807f21a8a6d6da71000">22 Sep 2025</a>
</div>

 <h1 id='header'>Test & build a project with GitHub Actions</h1> <p><a href="https://github.com/features/actions">GitHub Actions</a> is an automated workflow
system that GOV.UK uses for <a href="https://en.wikipedia.org/wiki/Continuous_integration">Continuous Integration (CI)</a>. In
<a href="https://github.com/alphagov/govuk-rfcs/blob/main/rfc-123-github-actions-ci.md">GOV.UK RFC 123</a> we decided that GitHub Actions is the preferred platform for
GOV.UK CI usage where the wider platform integration of Jenkins is not required.</p>
<p><strong>If your workflow requires the use of secrets, please talk to
<a href="/manual/ask-for-help.html#contact-senior-tech">GOV.UK senior tech</a>
before deploying it.</strong> This is to help GOV.UK establish consistent and
effective secret management for GitHub Actions across the wider alphagov
GitHub organisation.</p>
<h2 id='gov-uk-conventions-for-github-actions'>GOV.UK Conventions for GitHub Actions</h2><h3 id='name-of-ci-workflow-file'>Name of CI workflow file</h3><p>You should name the file used for configuring the CI workflow <code>ci.yml</code>.
It should live in the <code>.github/workflows</code> directory.</p>
<h3 id='name-of-ci-workflow-and-jobs'>Name of CI workflow and jobs</h3><p>The CI workflow configured above should have a <code>name</code> property with a
value of <code>CI</code>. The workflow should have a number of self-contained jobs
configured, for actions such as running tests, linting and security scans.
These should <a href="#reuse-workflows-where-possible">use reusable workflows</a> where
possible. For example:</p>
<div class="highlight"><pre class="highlight yaml" tabindex="0"><code><span class="na">jobs</span><span class="pi">:</span>
  <span class="na">security-analysis</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">alphagov/govuk-infrastructure/.github/workflows/brakeman.yml@main</span>

  <span class="na">lint-javascript</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">alphagov/govuk-infrastructure/.github/workflows/standardx.yml@main</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">files</span><span class="pi">:</span> <span class="s2">"</span><span class="s">'app/assets/javascripts/**/*.js'"</span>

  <span class="na">lint-ruby</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">alphagov/govuk-infrastructure/.github/workflows/rubocop.yml@main</span>
</code></pre></div><p>The jobs and steps do not need to be given a <a href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#name">name attribute</a>
as the job/step key should be sufficiently descriptive. In contrast, the
<code>ci.yml</code> <em>must</em> have a <code>name</code> property called <code>CI</code>, as this is
<a href="https://github.com/alphagov/govuk-dependabot-merger/pull/30">relied upon by our automated tooling</a>.</p>
<p>We previously recommended that repos should always define a job called <code>test</code>.
Historically, this job would be responsible for running the repo&rsquo;s tests, linter
and so on, usually via something like <code>bundle exec rake</code>. In January 2023, a
<a href="https://github.com/alphagov/content-data-admin/commit/89a888bf1d9d303cff50ae65ac9c0821c5c17e93">new convention</a>
was established, giving each task its own &lsquo;job&rsquo; (e.g. &lsquo;test-ruby&rsquo; for running
tests and &lsquo;lint-ruby&rsquo; for running the linter), within an overall &lsquo;workflow&rsquo;
called <code>CI</code>. Whilst this decoupling does make it harder to run the entire check suite
locally, it allows us to take advantage of GitHub Action parallelisation, as well
as better code reuse through reusable workflows.</p>
<h3 id='when-the-ci-workflow-should-run'>When the CI workflow should run</h3><p>The workflow should be configured to run when there is a <a href="https://help.github.com/en/actions/reference/events-that-trigger-workflows#push-event-push"><code>push</code></a>
to the default branch (typically &ldquo;main&rdquo;) and when a
<a href="https://help.github.com/en/actions/reference/events-that-trigger-workflows#pull-request-event-pull_request"><code>pull_request</code></a> is opened. This means CI runs when a branch
is merged (the <code>push</code> to main) and it runs against any changes introduced
in a pull request. We prefer to run against a <code>pull_request</code> event to all
<code>push</code> events, as this allows external contributors to have pull requests
tested and because <code>pull_request</code> runs against a version of the codebase
<a href="https://github.com/alphagov/govuk-developer-docs/pull/3961#discussion_r1171071337">that is merged with the repository default branch</a>.</p>
<p>Example configuration:</p>
<div class="highlight"><pre class="highlight yaml" tabindex="0"><code><span class="c1"># ./github/workflows/ci.yml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">CI</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">main</span>
  <span class="na">pull_request</span><span class="pi">:</span>
</code></pre></div><p>We previously recommended CI jobs to run on <code>[push, pull_request]</code> as per
<a href="https://github.com/alphagov/govuk-rfcs/blob/main/rfc-123-github-actions-ci.md#findings-from-some-initial-explorations-into-using-github-actions">RFC-123</a> however this caused duplicate runs of the CI jobs
of a pull request (one for the <code>push</code> another for the <code>pull_request</code>)
which were both superfluous for our testing, a point of confusion and were
depleting our allowance quotas.</p>
<h4 id='running-ci-on-demand'>Running CI on demand</h4><p>To run CI on-demand, outside a pull request, for example before opening a PR,
you may configure a repository to have a <code>workflow_dispatch</code> event so you can
run it from the GitHub Actions user interface. If you do this you will need
to configure the checkout action to reference the appropriate commit.</p>
<p>Example configuration:</p>
<div class="highlight"><pre class="highlight yaml" tabindex="0"><code><span class="na">name</span><span class="pi">:</span> <span class="s">CI</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">main</span>
  <span class="na">pull_request</span><span class="pi">:</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="na">ref</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">The</span><span class="nv"> </span><span class="s">branch,</span><span class="nv"> </span><span class="s">tag</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">SHA</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">checkout'</span>
        <span class="na">default</span><span class="pi">:</span> <span class="s">main</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># for example</span>
  <span class="na">test-ruby</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">ref</span><span class="pi">:</span> <span class="s">${{ inputs.ref || github.ref }}</span>
</code></pre></div><h3 id='branch-protection-rules'>Branch protection rules</h3><p>Pull Requests must not be merged until the jobs defined in the <code>CI</code>
workflow have passed. You should always define a workflow called <code>CI</code>.</p>
<h3 id='reuse-workflows-where-possible'>Reuse workflows where possible</h3><p>We define a number of reusable workflows in the govuk-infrastructure repo.</p>
<p>For example, here&rsquo;s <a href="https://github.com/alphagov/content-publisher/blob/70cafa40a5680a062d31f0e1d14ede3716318600/.github/workflows/ci.yml#L40-L42">how Content Publisher uses a reusable workflow</a> that is <a href="https://github.com/alphagov/govuk-infrastructure/blob/d31a9792f70b3857b83596e6dacc7f6d591c6b0e/.github/workflows/rubocop.yml">defined in govuk-infrastructure</a>:</p>
<div class="highlight"><pre class="highlight yaml" tabindex="0"><code><span class="na">name</span><span class="pi">:</span> <span class="s">CI</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">lint-ruby</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Lint Ruby</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">alphagov/govuk-infrastructure/.github/workflows/rubocop.yml@main</span>
</code></pre></div><h3 id='pin-untrusted-github-actions-to-a-commit-sha'>Pin untrusted GitHub Actions to a commit SHA</h3><p>To reduce security risks such as supply chain attacks and unexpectedly
breaking changes, it is important to pin your versions of untrusted (third-party)
GitHub Actions to a commit SHA rather than using a floating version or tag.
GitHubâ€™s <a href="https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions">Security Hardening for GitHub Actions</a> guidance provides
further details. For example:</p>
<div class="highlight"><pre class="highlight yaml" tabindex="0"><code><span class="na">jobs</span><span class="pi">:</span>
  <span class="na">security-analysis</span><span class="pi">:</span>
    <span class="c1"># Instead of: uses: some/action@v2</span>
    <span class="c1"># Pin to a specific commit SHA:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">some/action@c86d0dc2cb1a4ca77a7ba2912c5fd6912bf12a05</span>
    <span class="c1"># ...</span>
</code></pre></div><p>Pins can still be updated periodically (manually or via Dependabot), ensuring
that you are in control of version changes. This is particularly important for
any external or untrusted actions that GOV.UK does not maintain directly.</p>
<p>To find the commit SHA for a given version tag, visit the repository on GitHub
and look at the commit history at that specific tag. The format of the  URL for
this is <code>https://github.com/owner/repository/commits/TAG</code>. The URL for <code>v5</code> of
the <code>setup-node</code> action, for example, is
<code>https://github.com/actions/setup-node/commits/v5/</code>. Choose the SHA hash of the
first commit in the history. This will be the commit to which the tag has been
applied.</p>
<h3 id='only-one-workflow-for-a-given-branch-should-run-at-once'>Only one workflow for a given branch should run at once</h3><p>Under certain conditions, the deployment system can number releases in the
incorrect order if two pull requests are merged in to <code>main</code> at the same time.
This is caused by GitHub sometimes running the CI and release workflows in the wrong order.</p>
<p>To ensure the deployment system numbers releases in the correct order,
you should ensure only one CI run can be active at once for a given branch.
This can be done by adding the following to your CI file:</p>
<div class="highlight"><pre class="highlight yaml" tabindex="0"><code><span class="na">concurrency</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">${{ github.workflow }}-${{ github.repository }}-${{ github.ref_name }}</span>
  <span class="na">cancel-in-progress</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div><h3 id='ci-workflow-for-ruby-gems'>CI workflow for Ruby gems</h3><p>This differs to a simple Ruby application because Ruby gems are not tied to
particular Ruby or Rails versions. Therefore we should test against various
combinations of supported versions.
See <a href="https://github.com/alphagov/govspeak/blob/a42facbbc2365a47f9695b12fdfa6faac46cdb11/.github/workflows/ci.yml">example in govspeak</a>.</p>
<p>To do this, we use a <a href="https://docs.github.com/en/actions/using-workflows/advanced-workflow-features#using-a-build-matrix">build matrix</a>. In this example, we test against three
Ruby versions (<code>2.7</code>, <code>3.0</code>, <code>3.1</code>) and two Rails versions (<code>6</code>, <code>7</code>). Combined,
this results in 6 variations for the workflow to test against.</p>
<div class="highlight"><pre class="highlight yaml" tabindex="0"><code><span class="c1"># .github/workflows/ci.yml</span>
<span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">,</span> <span class="nv">pull_request</span><span class="pi">]</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Run the test suite against multiple Ruby and Rails versions</span>
  <span class="na">test_matrix</span><span class="pi">:</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">fail-fast</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="c1"># Due to https://github.com/actions/runner/issues/849, we have to use quotes for '3.0'</span>
        <span class="na">ruby</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">2.7</span><span class="pi">,</span> <span class="s1">'</span><span class="s">3.0'</span><span class="pi">,</span> <span class="nv">3.1</span><span class="pi">]</span>
        <span class="c1"># Test against multiple Rails versions</span>
        <span class="na">gemfile</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">rails_6</span><span class="pi">,</span> <span class="nv">rails_7</span><span class="pi">]</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">env</span><span class="pi">:</span>
      <span class="na">BUNDLE_GEMFILE</span><span class="pi">:</span> <span class="s">gemfiles/${{ matrix.gemfile }}.gemfile</span>
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">ruby/setup-ruby@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">ruby-version</span><span class="pi">:</span> <span class="s">${{ matrix.ruby }}</span>
        <span class="na">bundler-cache</span><span class="pi">:</span> <span class="no">true</span>
    <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">bundle exec rake</span>

  <span class="c1"># Branch protection rules cannot directly depend on status checks from matrix jobs.</span>
  <span class="c1"># So instead we define `test` as a dummy job which only runs after the preceding `test_matrix` checks have passed.</span>
  <span class="c1"># Solution inspired by: https://github.community/t/status-check-for-a-matrix-jobs/127354/3</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">test_matrix</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">echo "All matrix tests have passed ðŸš€"</span>

  <span class="c1"># We have a shared workflow that can be used for most gem publishing needs. You may have to write</span>
  <span class="c1"># your own if you have a gem that is released in a complex way.</span>
  <span class="na">publish</span><span class="pi">:</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">test</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">${{ github.ref == 'refs/heads/main' }}</span>
    <span class="na">permissions</span><span class="pi">:</span>
      <span class="na">contents</span><span class="pi">:</span> <span class="s">write</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">alphagov/govuk-infrastructure/.github/workflows/publish-rubygem.yaml@main</span>
    <span class="na">secrets</span><span class="pi">:</span>
      <span class="na">GEM_HOST_API_KEY</span><span class="pi">:</span> <span class="s">${{ secrets.ALPHAGOV_RUBYGEMS_API_KEY }}</span>
</code></pre></div><p>For each Rails version, a <code>*.gemfile</code> should exist in a top-level directory called <code>gemfiles</code>.</p>
<div class="highlight"><pre class="highlight ruby" tabindex="0"><code><span class="c1"># gemfiles/rails_7.gemfile</span>
<span class="n">source</span> <span class="s2">"https://rubygems.org"</span>

<span class="n">gem</span> <span class="s2">"rails"</span><span class="p">,</span> <span class="s2">"~&gt; 7"</span>

<span class="n">gemspec</span> <span class="ss">path: </span><span class="s2">"../"</span>
</code></pre></div><p>Notes:</p>

<ul>
<li>Our preference is to test the gems we publish against the latest version of
<a href="https://www.ruby-lang.org/en/downloads/branches/">all currently supported minor versions of Ruby MRI</a>.</li>
<li>For a real world example of this workflow, see <a href="https://github.com/alphagov/govuk_admin_template">govuk_admin_template</a>.</li>
<li>The <code>ALPHAGOV_RUBYGEMS_API_KEY</code> secret is an organisation secret that is added
to individual repositories by a GitHub Admin. Please talk to
<a href="/manual/ask-for-help.html#contact-senior-tech">GOV.UK Senior Tech</a>
for this to be added to a repo.</li>
</ul>

  <div class='related-content'>

    <h3>More in the Testing section</h3>

    <div class='govuk-grid-row'>
        <div class='govuk-grid-column-one-half'>
          <h4>Learn</h4>

          <ul class="govuk-list">
            <li><a href="/manual/brakeman.html">Brakeman</a></li>
            <li><a href="/manual/codeql.html">CodeQL</a></li>
            <li><a href="/manual/dependency-review.html">Dependency Review</a></li>
            <li><a href="/manual/testing.html">How we test GOV.UK</a></li>
            <li><a href="/manual/pact-testing.html">Pact Testing</a></li>
            <li><a href="/manual/security-alerts.html">Security Alerts Guidance</a></li>
          </ul>
        </div>

        <div class='govuk-grid-column-one-half'>
          <h4>How to...</h4>

          <ul class="govuk-list">
            <li><a href="/manual/load-test.html">Run a load test with k6</a></li>
          </ul>
        </div>

    </div>
</div>


            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/govuk-developer-docs/blob/master/source/manual/test-and-build-a-project-with-github-actions.html.md">View source</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs/issues/new?body=Problem+with+%27Test+%26+build+a+project+with+GitHub+Actions%27+%28https%3A%2F%2Fdocs.publishing.service.gov.uk%2Fmanual%2Ftest-and-build-a-project-with-github-actions.html%29&amp;labels=bug&amp;title=Re%3A+%27Test+%26+build+a+project+with+GitHub+Actions%27">Report problem</a></li>
                <li><a href="https://github.com/alphagov/govuk-developer-docs">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <svg focusable="false" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 60" height="30" width="32" fill="currentcolor" class="govuk-footer__crown">
    <g>
      <circle cx="20" cy="17.6" r="3.7"></circle>
      <circle cx="10.2" cy="23.5" r="3.7"></circle>
      <circle cx="3.7" cy="33.2" r="3.7"></circle>
      <circle cx="31.7" cy="30.6" r="3.7"></circle>
      <circle cx="43.3" cy="17.6" r="3.7"></circle>
      <circle cx="53.2" cy="23.5" r="3.7"></circle>
      <circle cx="59.7" cy="33.2" r="3.7"></circle>
      <circle cx="31.7" cy="30.6" r="3.7"></circle>
      <path d="M33.1,9.8c.2-.1.3-.3.5-.5l4.6,2.4v-6.8l-4.6,1.5c-.1-.2-.3-.3-.5-.5l1.9-5.9h-6.7l1.9,5.9c-.2.1-.3.3-.5.5l-4.6-1.5v6.8l4.6-2.4c.1.2.3.3.5.5l-2.6,8c-.9,2.8,1.2,5.7,4.1,5.7h0c3,0,5.1-2.9,4.1-5.7l-2.6-8ZM37,37.9s-3.4,3.8-4.1,6.1c2.2,0,4.2-.5,6.4-2.8l-.7,8.5c-2-2.8-4.4-4.1-5.7-3.8.1,3.1.5,6.7,5.8,7.2,3.7.3,6.7-1.5,7-3.8.4-2.6-2-4.3-3.7-1.6-1.4-4.5,2.4-6.1,4.9-3.2-1.9-4.5-1.8-7.7,2.4-10.9,3,4,2.6,7.3-1.2,11.1,2.4-1.3,6.2,0,4,4.6-1.2-2.8-3.7-2.2-4.2.2-.3,1.7.7,3.7,3,4.2,1.9.3,4.7-.9,7-5.9-1.3,0-2.4.7-3.9,1.7l2.4-8c.6,2.3,1.4,3.7,2.2,4.5.6-1.6.5-2.8,0-5.3l5,1.8c-2.6,3.6-5.2,8.7-7.3,17.5-7.4-1.1-15.7-1.7-24.5-1.7h0c-8.8,0-17.1.6-24.5,1.7-2.1-8.9-4.7-13.9-7.3-17.5l5-1.8c-.5,2.5-.6,3.7,0,5.3.8-.8,1.6-2.3,2.2-4.5l2.4,8c-1.5-1-2.6-1.7-3.9-1.7,2.3,5,5.2,6.2,7,5.9,2.3-.4,3.3-2.4,3-4.2-.5-2.4-3-3.1-4.2-.2-2.2-4.6,1.6-6,4-4.6-3.7-3.7-4.2-7.1-1.2-11.1,4.2,3.2,4.3,6.4,2.4,10.9,2.5-2.8,6.3-1.3,4.9,3.2-1.8-2.7-4.1-1-3.7,1.6.3,2.3,3.3,4.1,7,3.8,5.4-.5,5.7-4.2,5.8-7.2-1.3-.2-3.7,1-5.7,3.8l-.7-8.5c2.2,2.3,4.2,2.7,6.4,2.8-.7-2.3-4.1-6.1-4.1-6.1h10.6,0Z"></path>
    </g>
  </svg>
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Accessibility</a>
            </li>
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/cookies.html">Cookies</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/govuk_frontend.js" type="module"></script>
    <script src="/javascripts/application.js"></script>
  </body>
</html>
