---
owner_slack: "#govuk-developers"
title: Run an A/B or multivariate test
parent: "/manual.html"
layout: manual_layout
section: A/B testing
---

Before you run an A/B or multivariate test, you should read the [guidance on how A/B testing works](/manual/ab-testing.html).

## 1. Prepare the A/B test

### Choose a test name

Choose a short test name, and prefix that test name with `ABTest-`. For example, `ABTest-dvlacheck`

You do not need to use the `ABTest-` prefix in [your code](https://github.com/alphagov/collections/blob/54dd7d22567ec932a16c262387ae609e9cc47aae/app/controllers/concerns/taxon_pages_testable.rb#L25) because [this prefix already configured in Fastly](https://github.com/alphagov/govuk-cdn-config/blob/955dd25e6443a8fd7142cebdb60d7bee43a067b7/vcl_templates/www.vcl.erb#L348).

### Consider the load on GOV.UK

You must make sure that GOV.UK can handle the extra load
on origin generated by an A/B test.  Extra load occurs because [A/B tests add `Vary` headers](https://github.com/alphagov/govuk_ab_testing/blob/8284cb2b2e7d504e412bd9184ddd43f874dd9b7c/lib/govuk_ab_testing/requested_variant.rb#L59)
to responses. If you add A/B testing headers to all content, then requests for any
content will tend to miss the cache more often.  This adds load to origin servers.

You can minimise the impact of this by configuring your test to only return A/B
testing headers on pages that you are measuring. See this [example testing navigation on mainstream guides](https://github.com/alphagov/government-frontend/blob/9ba288dd809a2246ec349c708f693ba306c69e7e/app/controllers/concerns/guide_nav_ab_testable.rb#L36) for more information.

You may want to deploy your test at a quieter time of day (such as 9:30am) rather than the middle of the day. Check when a quiet time for your test case is.

Make sure you monitor your test after deployment.

## 2. Set up an A/B test

1. Write the A/B test. Use the information in the [govuk_ab_testing gem][govuk_ab_testing] to understand how to serve different versions to your users.
1. Add your test to the [A/B test register][register].
1. If you want to use Google Analytics to monitor the A/B test, talk to a performance analyst and pick a [GA dimension][analytics-dimensions] to use for your test.
1. Create dictionary and A/B test files in the [govuk-cdn-config repo][govuk-cdn-config]. See an [example for the dictionaries][dictionary-config-example] and an [example for the A/B configuration][cdn-config-example]. For more information, see the [dictionaries README][dictionaries-readme].

## 3. Deploy and activate an A/B test

To deploy and activate an A/B test, you must [set up a personal API token](https://docs.publishing.service.gov.uk/manual/cdn.html#deploying-fastly) in your Fastly account.

1. Deploy the dictionary changes to each environment using the [Update_CDN_Dictionaries Jenkins job][update-cdn-dictionaries]. The API key is in the [govuk-secrets repo][govuk-secrets-fastly]. You must deploy the dictionaries to the `www` vhost.
1. Deploy the Fastly configuration to each environment using the [Deploy_CDN Jenkins job][deploy-cdn]. Use the same parameters as the previous step. You can test the deployment on staging by visiting <https://www.staging.publishing.service.gov.uk>. Changes should appear almost immediately as there is no caching of the CDN config.
1. To activate or deactivate the test, or to change the B percentage, update your test in [the govuk-cdn-config repo][govuk-cdn-config] and deploy the dictionaries.

If you're making a change to Search API, you may also want to test using
the [search performance explorer](https://github.com/alphagov/search-performance-explorer/).
To do this, [add your A/B test to the application](https://github.com/alphagov/search-performance-explorer/commit/01e3d21ceca96951425b5ddc87116f0756411691) and manually deploy the test to Heroku.

[analytics-dimensions]: https://gov-uk.atlassian.net/wiki/display/GOVUK/Analytics+on+GOV.UK
[govuk-secrets-fastly]: https://github.com/alphagov/govuk-secrets/blob/master/pass/2ndline/fastly/2nd_line_api_token.gpg
[dictionaries-readme]: https://github.com/alphagov/govuk-cdn-config#fastly-dictionaries
[dictionary-config-example]: https://github.com/alphagov/govuk-cdn-config-secrets/commit/ba3ec923c0bb5bdf17bdaf02419ff4e049516fda
[govuk_ab_testing]: https://github.com/alphagov/govuk_ab_testing
[cdn-config-example]: https://github.com/alphagov/fastly-configure/pull/29/files

## 4. Remove the A/B test

1. Remove your test from the [ab_tests configuration file][configuration-file] in the [govuk-cdn-config][govuk-cdn-config] repo and remove the dictionary files.
1. Deploy the Fastly configuration to each environment using the [Deploy_CDN Jenkins job][deploy-cdn]. Set the `vhost` to `www`. The credentials are in the [`govuk-secrets` repo](https://github.com/alphagov/govuk-secrets).
1. Deploy the `govuk-cdn-config` changes to each environment using the [Update_CDN_Dictionaries Jenkins job][update-cdn-dictionaries]. Use the same parameters as the previous step.
1. Mark the end date in the [A/B test register][register].

[govuk-cdn-config]: https://github.com/alphagov/govuk-cdn-config
[configuration-file]: https://github.com/alphagov/govuk-cdn-config/blob/master/ab_tests/ab_tests.yaml
[update-cdn-dictionaries]: https://deploy.blue.staging.govuk.digital/job/Update_CDN_Dictionaries/
[deploy-cdn]: https://deploy.blue.staging.govuk.digital/job/Deploy_CDN/
[register]: https://docs.google.com/spreadsheets/d/1voQzdoGAFO9Tnvl7Xq4ahLEAyGtkeAtvTC26SxEP6rE/edit
