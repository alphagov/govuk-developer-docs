---
owner_slack: "#govuk-developers"
title: Run an A/B or multivariate test
parent: "/manual.html"
layout: manual_layout
section: A/B testing
last_reviewed_on: 2020-02-07
review_in: 6 months
---

## 1. Preparation

### Choose your test name

The name should begin with `ABTest-`.  Try to keep it short.

You don't need to use the `ABTest-` prefix
in [your code](https://github.com/alphagov/collections/blob/54dd7d22567ec932a16c262387ae609e9cc47aae/app/controllers/concerns/taxon_pages_testable.rb#L25)
though as [it's already configured in Fastly](https://github.com/alphagov/govuk-cdn-config/blob/955dd25e6443a8fd7142cebdb60d7bee43a067b7/vcl_templates/www.vcl.erb#L348).

### Consider load

You will need to take steps to ensure that GOV.UK can cope with the extra load
on origin generated by an AB test.  Extra load occurs because [AB tests add `Vary` headers](https://github.com/alphagov/govuk_ab_testing/blob/8284cb2b2e7d504e412bd9184ddd43f874dd9b7c/lib/govuk_ab_testing/requested_variant.rb#L59)
to responses. If you add AB testing headers to all content, then requests for any
content will tend to miss the cache more often.  This adds load to origin servers.

You can minimise the impact of this by configuring your test to only return AB
testing headers on pages that you are measuring.
[Example testing navigation on mainstream guides](https://github.com/alphagov/government-frontend/blob/9ba288dd809a2246ec349c708f693ba306c69e7e/app/controllers/concerns/guide_nav_ab_testable.rb#L36).

You may want to deploy your test at a quieter time of day (such as 9:30am) rather
than the middle of the day.  This allows CDN caches to warm up in a slightly more
graceful way.  Check when a quiet time for your test case is.

Make sure you monitor your test for some time after deployment to ensure that
everything is working OK.

### Decide how the variants should be split

A higher percentage on your B variant will reduce the time that you need to run
the test.  Your performance analyst can help here.

You may want to start with a small B percentage and ramp up gradually, either for
load reasons, or if there's something a bit controversial in your test that may
perform particularly poorly with users.

### Choose your cookie expiry

The cookie expiry time should be short until you have established traffic across
the desired split between your variants.

Once your variants are at the desired proportions, the cookie expiry time should
be longer than the expected test duration.  This ensures that users are kept in
the same variant for the duration of the test which allows them to get used to
whatever changes you have made.

It's good to have a margin for error, to (for example) correct faulty tracking
at the start, or perhaps run the test for a few more days at the end if you
need more data.

## 2. How to set up an A/B test

1. Add your test to the [A/B test register][register].
1. If you want to use Google Analytics to monitor the A/B test, talk to a performance analyst and pick a [GA dimension][analytics-dimensions] to use for your test.
1. Create dictionary and A/B test files in [the govuk-cdn-config repo][govuk-cdn-config]. See an [example for the dictionaries][dictionary-config-example] and an [example for the A/B configuration][cdn-config-example] (these used to be in a different repo). For more details, see the [dictionaries README][dictionaries-readme].
1. Deploy the dictionary changes to each environment using the [Update_CDN_Dictionaries][update-cdn-dictionaries] Jenkins job. The API key is in the [govuk-secrets repo][govuk-secrets-fastly] and the dictionaries must be deployed to the `www` vhost.
1. Deploy the Fastly configuration to each environment using the [Deploy_CDN][deploy-cdn] Jenkins job. Use the same parameters as in step 4. You can test it on staging by visiting <https://www.staging.publishing.service.gov.uk>. Changes should appear almost immediately - there is no caching of the CDN config.
1. Use the [govuk_ab_testing gem][govuk_ab_testing] to serve different versions to your users. It can be configured with the analytics dimension selected in step 2.
1. To activate or deactivate the test, or to change the B percentage, update your test in [the govuk-cdn-config repo][govuk-cdn-config] and deploy the dictionaries.

If you're making a change to Search API, you may also want to test using
the [search performance explorer](https://github.com/alphagov/search-performance-explorer/).
In which case, you'll need to [add your AB test](https://github.com/alphagov/search-performance-explorer/commit/01e3d21ceca96951425b5ddc87116f0756411691) to the application, and manually
deploy it to Heroku.

[analytics-dimensions]: https://gov-uk.atlassian.net/wiki/display/GOVUK/Analytics+on+GOV.UK
[govuk-secrets-fastly]: https://github.com/alphagov/govuk-secrets/blob/master/pass/2ndline/fastly/2nd_line_api_token.gpg
[dictionaries-readme]: https://github.com/alphagov/govuk-cdn-config#fastly-dictionaries
[dictionary-config-example]: https://github.com/alphagov/govuk-cdn-config-secrets/commit/ba3ec923c0bb5bdf17bdaf02419ff4e049516fda
[govuk_ab_testing]: https://github.com/alphagov/govuk_ab_testing
[cdn-config-example]: https://github.com/alphagov/fastly-configure/pull/29/files

## 3. How to remove your A/B test

Follow these steps:

1. Remove your test from the [ab_tests configuration file][configuration-file] in the [govuk-cdn-config][govuk-cdn-config] repo and remove the dictionary files.
1. Deploy the Fastly configuration to each environment using the [Deploy_CDN][deploy-cdn] Jenkins job. The `vhost` must be set to `www`, and the credentials are in the govuk-secrets repo.
1. Deploy the govuk-cdn-config changes to each environment using the [Update_CDN_Dictionaries][update-cdn-dictionaries] Jenkins job. Use the same parameters as in step 2.
1. Mark the end date in [A/B test register][register].

[govuk-cdn-config]: https://github.com/alphagov/govuk-cdn-config
[configuration-file]: https://github.com/alphagov/govuk-cdn-config/blob/master/ab_tests/ab_tests.yaml
[update-cdn-dictionaries]: https://deploy.staging.publishing.service.gov.uk/job/Update_CDN_Dictionaries/
[deploy-cdn]: https://deploy.staging.publishing.service.gov.uk/job/Deploy_CDN/
[register]: https://docs.google.com/spreadsheets/d/1voQzdoGAFO9Tnvl7Xq4ahLEAyGtkeAtvTC26SxEP6rE/edit
