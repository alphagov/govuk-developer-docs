---
owner_slack: "#govuk-developers"
title: Run an A/B or multivariate test
parent: "/manual.html"
layout: manual_layout
section: A/B testing
---

Before you run an A/B or multivariate test, you should read the [guidance on how A/B testing works](/manual/ab-testing.html).

## 1. Prepare the A/B test

### Choose a test name

Choose a short test name, and prefix that test name with `ABTest-`. For example, `ABTest-dvlacheck`

You do not need to use the `ABTest-` prefix in [your code](https://github.com/alphagov/collections/blob/54dd7d22567ec932a16c262387ae609e9cc47aae/app/controllers/concerns/taxon_pages_testable.rb#L25) because [this prefix is already configured in Fastly](https://github.com/alphagov/govuk-cdn-config/blob/955dd25e6443a8fd7142cebdb60d7bee43a067b7/vcl_templates/www.vcl.erb#L348).

### Consider the load on GOV.UK

You must make sure that GOV.UK can handle the extra load
on origin generated by an A/B test. Extra load occurs because [A/B tests add `Vary` headers](https://github.com/alphagov/govuk_ab_testing/blob/8284cb2b2e7d504e412bd9184ddd43f874dd9b7c/lib/govuk_ab_testing/requested_variant.rb#L59)
to responses. If you add A/B testing headers to all content, then requests for any
content will tend to miss the cache more often. This adds load to origin servers.

You can minimise the impact of this by configuring your test to only return A/B
testing headers on pages that you are measuring. See this [example testing navigation on mainstream guides](https://github.com/alphagov/government-frontend/blob/9ba288dd809a2246ec349c708f693ba306c69e7e/app/controllers/concerns/guide_nav_ab_testable.rb#L36) for more information.

You may want to deploy your test at a quieter time of day. Check when a quiet time for your test case is.

Make sure you monitor your test after deployment.

## 2. Set up an A/B test

1. Write the A/B test. Use the information in the [govuk_ab_testing gem][govuk_ab_testing] to understand how to serve different versions to your users.
1. Add your test to the [A/B test register][register].
1. If you want to use Google Analytics to monitor the A/B test, talk to a performance analyst and pick a [GA dimension][analytics-dimensions] to use for your test. If you wish to run an A/B test in integration or staging you may need to ensure that analytics tracking exists in those environments.
1. Add your test to the [ab_tests configuration file][ab-tests-file] in the [govuk-fastly][govuk-fastly] repo and remove the relevant [dictionary config][dictionary-config]. See [an example pull request updating this config][pull-request-example].

## 3. Deploy and activate an A/B test

1. Deploy the dictionary changes to each environment using [Terraform Cloud][terraform-cloud] (Note that Terraform Cloud's VCL diff display is poor. To see a better diff, check the fastly-vcl-diff post-plan task on your run page)
1. To activate or deactivate the test, or to change the percentages, update your test in [the govuk-fastly repo][govuk-fastly] and deploy the terraform.

[analytics-dimensions]: https://gov-uk.atlassian.net/wiki/display/GOVUK/Analytics+on+GOV.UK
[pull-request-example]: https://github.com/alphagov/govuk-fastly/pull/22
[govuk_ab_testing]: https://github.com/alphagov/govuk_ab_testing

## 4. Remove the A/B test

1. Remove your test from the [ab_tests configuration file][ab-tests-file] in the [govuk-fastly][govuk-fastly] repo and remove the relevant [dictionary config][dictionary-config].
1. Deploy the Fastly configuration using [Terraform Cloud][terraform-cloud] (Note that Terraform Cloud's VCL diff display is poor. To see a better diff, check the fastly-vcl-diff post-plan task on your run page)
1. Mark the end date in the [A/B test register][register].

[govuk-fastly]: https://github.com/alphagov/govuk-fastly
[terraform-cloud]: https://app.terraform.io/app/govuk/workspaces/govuk-fastly
[ab-tests-file]: https://github.com/alphagov/govuk-fastly/blob/main/ab_tests.yaml
[dictionary-config]: https://github.com/alphagov/govuk-fastly/blob/main/dictionaries.yaml
[register]: https://docs.google.com/spreadsheets/d/1h4vGXzIbhOWwUzourPLIc8WM-iU1b6WYOVDOZxmU1Uo/edit
