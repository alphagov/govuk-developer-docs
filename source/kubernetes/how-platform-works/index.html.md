---
title: How the platform works
weight: 60
layout: multipage_layout
---

# How the platform works

## Introduction

The GOV.UK Kubernetes platform is an AWS-hosted [Kubernetes](https://kubernetes.io) cluster built using Amazon's [Elastic Kubernetes Service (EKS)](https://aws.amazon.com/eks/). It provides a standardised environment for running containerised applications that power GOV.UK services.

The platform is designed to:
- Enable consistent application deployments across staging, integration, and production environments.
- Automate tasks like scaling, load balancing, and secret management.
- Centralise key infrastructure components, such as monitoring and alerting.

To meet GOV.UKâ€™s operational requirements, the platform integrates Kubernetes with AWS tools and additional Kubernetes add-ons. These include features for:
- Managing secrets securely.
- Automatically scaling the cluster based on workloads.
- Routing traffic through managed load balancers.

This document outlines the core components of the platform, including the add-ons, authentication methods, and other services that support its operation.

## High-Level Architecture

![High level overview of internal platform](images/internal-platform-high-level.png)

> Note: Source for the above model can be found [here](https://drive.google.com/file/d/1iYblqBbGXlkOScOBRlg8hqtFvVaA9CXp/view?usp=drive_link).

The platform is designed to manage and deploy applications reliably and efficiently across multiple environments, including staging, integration, and production. The architecture integrates several components to handle deployment, monitoring, alerting, and logging:

- **Infrastructure Deployment**: Terraform Cloud and the AWS API are used to manage and provision infrastructure, including Kubernetes clusters hosted on AWS Elastic Kubernetes Service (EKS).
- **Application Deployment**: Developers push code to GitHub, which triggers GitHub Actions to build and deploy applications using Helm charts via Argo workflows.  
- **Monitoring and Alerting**: Prometheus scrapes metrics from applications and infrastructure, with alerts routed through AlertManager to PagerDuty, Slack, and other channels. Grafana provides observability dashboards for performance monitoring.  
- **Secret Management**: External-secrets fetches secrets from AWS Secrets Manager, making them available as Kubernetes Secrets for applications.  
- **Logging**: Application and cluster logs are centralised in ELK/LogIt for analysis and debugging.  
- **Operational Support**: Tools like Sentry capture exceptions, while monitoring systems like CloudWatch and Pingdom enhance reliability and alerting for both applications and infrastructure.

This setup enables automated, scalable, and secure management of the platform while providing observability and operational insights for application teams.

### Application Deployment

You can read more about how applications are deployed here [here](kubernetes/manage-app/access-ci-cd/index.html.md).

### Monitoring and Alerting

![Model of the monitoring and alerting setup](images/internal-platform-monitoring-alerting.png)

> Note: Source for the above model can be found [here](https://drive.google.com/file/d/1pB3acw7CFtqTJe1nSyV391B8iPLrKYgC/view?usp=sharing).

Monitoring and alerting in the GOV.UK Kubernetes platform ensure the stability, performance, and reliability of applications and infrastructure. The following diagram provides a high-level overview of the monitoring and alerting workflow:

![Monitoring and Alerting Model](path/to/uploaded/image.png)  
*Figure 1: Monitoring and Alerting Workflow*

#### Key Components

1. **Prometheus**  
   Prometheus collects metrics from applications (e.g., App1, App2) and infrastructure components. It serves as the central hub for scraping and storing performance and operational data.

2. **AlertManager**  
   AlertManager processes alerts generated by Prometheus based on predefined rules. It routes alerts to various notification channels, including:
   - **Slack**: Sends alerts to team channels for real-time awareness.
   - **PagerDuty**: Escalates critical alerts to on-call operators.
   - **Email**: Distributes alerts for broader notification.
   - **Zendesk**: Creates support tickets for tracking issues.

3. **Grafana**  
   Grafana integrates with Prometheus to provide visualisations and dashboards for observing performance metrics and trends. It allows teams to monitor the health of applications and systems effectively.

4. **Sentry**  
   Sentry captures exceptions and error logs from applications, feeding them into the monitoring pipeline for analysis and resolution.

5. **Pingdom and AWS CloudWatch**  
   - **Pingdom** monitors external service uptime and latency, providing an additional layer of visibility into application availability.
   - **AWS CloudWatch** provides monitoring for AWS-managed resources, complementing Prometheus's metrics collection.

6. **Seal and Dependabot**  
   - **Dependabot** ensures dependency updates are monitored.
   - **Seal** provides alert consolidation and actionable insights for smoother incident response.

#### Workflow Summary

- Applications emit metrics and logs to Prometheus and Sentry. Prometheus evaluates metrics against alerting rules and forwards alerts to AlertManager. AlertManager routes alerts to appropriate channels based on their severity and urgency.
- Teams use Grafana dashboards to analyse metrics and trends for ongoing operational insights.
- External monitoring tools (Pingdom, CloudWatch) augment observability, while Seal and Dependabot contribute to a streamlined response to issues.

## Platform cluster add-ons

The GOV.UK Kubernetes platform cluster uses the following add-ons in its implementation of Kubernetes:

- External secrets
- ExternalDNS
- AWS load balancer controller
- Cluster autoscaler
- Dex OpenID connect provider
- AWS EBS CSI driver

### External secrets

The [External-secrets add-on](https://github.com/alphagov/govuk-infrastructure/blob/main/terraform/deployments/cluster-services/external_secrets.tf):

- retrieves secrets from [AWS Secrets Manager](https://aws.amazon.com/secrets-manager/)
- makes those secrets available to GOV.UK applications as standard [Kubernetes Secret objects](https://kubernetes.io/docs/concepts/configuration/secret/)

For more information, see the [External secrets documentation](https://external-secrets.io/).

### ExternalDNS

The [ExternalDNS add-on](https://github.com/alphagov/govuk-infrastructure/blob/main/terraform/deployments/cluster-services/external_dns.tf) creates and manages [Domain Name System (DNS)](https://aws.amazon.com/route53/what-is-dns/) records in [AWS Route 53](https://aws.amazon.com/route53/) for [exposed (publicly discoverable) Kubernetes services](https://kubernetes.io/docs/tutorials/kubernetes-basics/expose/expose-intro/) in [AWS Route 53](https://aws.amazon.com/route53/).

For more information, see the [External DNS documentation](https://github.com/kubernetes-sigs/external-dns).

### AWS load balancer controller

The [AWS load balancer controller add-on](https://github.com/alphagov/govuk-infrastructure/blob/main/terraform/deployments/cluster-services/aws_lb_controller.tf) creates and manages [AWS load balancers](https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/introduction.html), based on [Kubernetes Ingress objects](https://kubernetes.io/docs/concepts/services-networking/ingress/) in the cluster.

For more information, see the [AWS load balancer controller documentation](https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html).

### Cluster autoscaler

The [Cluster autoscaler add-on](https://github.com/alphagov/govuk-infrastructure/blob/main/terraform/deployments/cluster-services/cluster_autoscaler.tf) automatically adjusts the size of the Kubernetes cluster by:

- adding [worker nodes](https://kubernetes.io/docs/concepts/architecture/nodes/) to the cluster when the cluster is running low on capacity, so that Kubernetes can [schedule](https://kubernetes.io/docs/concepts/scheduling-eviction/kube-scheduler/) all of the requested pods.
- removing worker nodes when the cluster has spare capacity

The add-on adjusts cluster size by controlling the [AWS EC2 auto scaling group](https://docs.aws.amazon.com/autoscaling/ec2/userguide/AutoScalingGroup.html) for the [managed node group](https://docs.aws.amazon.com/eks/latest/userguide/managed-node-groups.html).

For more information, see the [Cluster autoscaler documentation](https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler).

### Dex OpenID connect provider

The [Dex OpenID connect provider](https://github.com/alphagov/govuk-infrastructure/blob/main/terraform/deployments/cluster-services/dex.tf) is a [federated identity provider](https://en.wikipedia.org/wiki/Federated_identity).

The GOV.UK Kubernetes platform cluster uses Dex to manage single sign-on to services in the cluster, for example, [Grafana dashboards](https://docs.publishing.service.gov.uk/manual/grafana.html) and [Argo CD](/get-started/access-eks-cluster/#access-eks-cluster).

Dex acts as an intermediary between apps that are restricted to authorised users, and apps that know how to verify a user's identity.

For more information, see the [Dex OpenID connect provider documentation](https://dexidp.io/docs/).

### AWS EBS CSI Driver

The [AWS Elastic Block Store (EBS) Container Storage Interface (CSI) driver](https://github.com/alphagov/govuk-infrastructure/blob/main/terraform/deployments/cluster-services/aws_ebs_csi_driver.tf) allows Amazon EKS clusters to manage the lifecycle of Amazon EBS volumes for persistent volumes.

For more information, see the [Amazon EBS CSI driver documentation](https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html).

## Platform cluster user authentication

To authenticate users, the GOV.UK Kubernetes platform cluster uses an [`aws-auth` ConfigMap](https://github.com/alphagov/govuk-infrastructure/blob/main/terraform/deployments/cluster-services/aws_auth_configmap.tf) in the `kube-system` [namespace](https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/).

The ConfigMap maps a user's AWS Identity Access Management (IAM) role to the equivalent role in the [Kubernetes role-based access control system](https://kubernetes.io/docs/reference/access-authn-authz/rbac/).

The list of authenticated users for the platformâ€™s different environments is located in the [`govuk-aws-data/data/infra-security/` GitHub repo on alphagov](https://github.com/alphagov/govuk-aws-data/tree/master/data/infra-security).

To make changes to this list, you must be in the [GOV.UK team on alphagov](https://github.com/orgs/alphagov/teams/gov-uk).

For more information, see the [AWS documentation on enabling IAM user and role access to your cluster](https://docs.aws.amazon.com/eks/latest/userguide/add-user-role.html).
