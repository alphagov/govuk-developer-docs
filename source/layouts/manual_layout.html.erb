<% html = "<h1 id='header'>#{current_page.data.title}</h1>#{yield}" %>

<% content_for :page_description, Snippet.generate(html) %>

<% content_for :sidebar do %>
  <a href='/manual.html'>&lsaquo; Manual</a>
  <%= table_of_contents html, max_level: 3 %>
<% end %>

<% wrap_layout :layout_with_sidebar do %>
  <% if current_page.data.section == "Icinga alerts" %>
    <div class="information-callout">
      This page describes what to do in case of an
      <a href='https://docs.publishing.service.gov.uk/manual/tools.html#icinga'>Icinga alert</a>.
      For more information you could
      <a href='https://github.com/alphagov/govuk-puppet/search?utf8=%E2%9C%93&q=<%= File.basename(current_page.path, ".*") %>'>
        search the govuk-puppet repo for the source of the alert
      </a>
    </div>
  <% end %>

  <% if page_review.expired? %>
    <div class='warning'>
      This page was set to be reviewed before <%= page_review.review_by %>
      by the page owner: <%= current_page.data.owner_slack %>. This might mean the
      content is out of date. <%= link_to "Read how to review a page", "/manual/review-page.html" %>
    </div>
  <% end %>

  <%= html %>

  <div class='grid-row'>
    <div class='column-half'>
      <% if current_page.data.related_applications %>
        <h3>Related applications</h3>

        <ul>
        <% current_page.data.related_applications.to_a.each do |app| %>
          <li><%= link_to "#{app} application", "/apps/#{app}.html" %></li>
        <% end %>
        </ul>
      <% end %>
    </div>

    <div class='column-half'>
      <h3>More about <%= current_page.data.section %></h3>

      <ul>
      <% manual_index_page.other_pages_from_section(current_page).each do |page| %>
        <li><%= link_to page.data.title, page.url %></li>
      <% end %>
      </ul>
    </div>
  </div>

  <% if page_review.reviewable? %>
    <div class='review-status'>
      This page is owned by <%= current_page.data.owner_slack %>
      and <%= link_to "needs to be reviewed", "/manual/review-page.html" %>
      <time data-module="datetime-relative" datetime="<%= page_review.review_by %>">
        <%= page_review.review_by %>
      </time>
    </div>
  <% end %>
<% end %>
